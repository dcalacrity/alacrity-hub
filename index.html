<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DC ALACRITY | Production Command System</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700;800;900&family=Bebas+Neue&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* ═══════════════════════════════════════════════════════════════════════
           DC ALACRITY ULTIMATE V6 - COMPLETE PRODUCTION COMMAND SYSTEM
           Futuristic Luxury Minimalist Design with Professional PDF Exports
           ═══════════════════════════════════════════════════════════════════════ */

        :root {
            /* ─── VOID PALETTE ─── */
            --void-pure: #000000;
            --void-deep: #030508;
            --void-soft: #0a0d12;
            --surface-1: #0f1318;
            --surface-2: #151a21;
            --surface-3: #1c222b;
            --surface-4: #242c38;
            
            /* ─── NEON SPECTRUM ─── */
            --neon-cyan: #00f0ff;
            --neon-cyan-dim: #00a8b3;
            --neon-violet: #a855f7;
            --neon-violet-dim: #7c3aed;
            --neon-gold: #fbbf24;
            --neon-emerald: #10b981;
            --neon-rose: #f43f5e;
            --neon-blue: #3b82f6;
            --neon-pink: #ec4899;
            --neon-orange: #f97316;
            
            /* ─── MODE COLORS ─── */
            --mode-demo: #f97316;
            --mode-cloud: #10b981;
            --mode-global: #a855f7;
            --mode-production: #00f0ff;
            
            /* ─── TEXT HIERARCHY ─── */
            --text-100: #ffffff;
            --text-90: #f1f5f9;
            --text-70: #94a3b8;
            --text-50: #64748b;
            --text-30: #475569;
            
            /* ─── BORDERS & EFFECTS ─── */
            --border-subtle: rgba(255, 255, 255, 0.04);
            --border-default: rgba(255, 255, 255, 0.08);
            --border-strong: rgba(255, 255, 255, 0.12);
            --glass-bg: rgba(15, 19, 24, 0.8);
            --glass-border: rgba(255, 255, 255, 0.06);
            
            /* ─── TYPOGRAPHY ─── */
            --font-display: 'Bebas Neue', sans-serif;
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            
            /* ─── SHADOWS ─── */
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
            --shadow-glow-cyan: 0 0 40px rgba(0, 240, 255, 0.15);
            --shadow-glow-rose: 0 0 40px rgba(244, 63, 94, 0.3);
            
            /* ─── TIMING ─── */
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
            
            /* ─── SPACING ─── */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
        }

        /* ═══════════════════════════════════════════════════════════════════════
           RESET & BASE
           ═══════════════════════════════════════════════════════════════════════ */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; -webkit-font-smoothing: antialiased; }
        body {
            font-family: var(--font-sans);
            background: var(--void-pure);
            color: var(--text-90);
            line-height: 1.5;
            overflow: hidden;
            height: 100vh;
        }
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(0, 240, 255, 0.03), transparent),
                radial-gradient(ellipse 60% 40% at 100% 100%, rgba(168, 85, 247, 0.02), transparent);
            pointer-events: none;
            z-index: 0;
        }
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.01) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.01) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        /* ═══════════════════════════════════════════════════════════════════════
           LOGIN OVERLAY
           ═══════════════════════════════════════════════════════════════════════ */
        .mode-banner {
            position: fixed;
            top: 0;
            left: 280px;
            right: 0;
            height: 36px;
            background: linear-gradient(90deg, var(--surface-2), var(--void-deep));
            border-bottom: 2px solid var(--border-strong);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 var(--space-lg);
            z-index: 100;
            font-family: var(--font-mono);
            font-size: 10px;
            letter-spacing: 2px;
        }
        .mode-banner.demo-mode {
            border-bottom-color: var(--mode-demo);
            background: linear-gradient(90deg, rgba(249, 115, 22, 0.08), var(--void-deep));
        }
        .mode-banner.cloud-mode {
            border-bottom-color: var(--mode-cloud);
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.08), var(--void-deep));
        }
        .mode-status {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        .mode-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 9px;
        }
        .mode-badge.demo {
            background: rgba(249, 115, 22, 0.15);
            color: var(--mode-demo);
            border: 1px solid rgba(249, 115, 22, 0.3);
        }
        .mode-badge.cloud {
            background: rgba(16, 185, 129, 0.15);
            color: var(--mode-cloud);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .mode-badge::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s ease-in-out infinite;
        }
        .view-indicator {
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 9px;
        }
        .view-indicator.global {
            background: rgba(168, 85, 247, 0.15);
            color: var(--mode-global);
            border: 1px solid rgba(168, 85, 247, 0.3);
        }
        .view-indicator.production {
            background: rgba(0, 240, 255, 0.15);
            color: var(--mode-production);
            border: 1px solid rgba(0, 240, 255, 0.3);
        }
        .login-overlay {
            position: fixed;
            inset: 0;
            background: var(--void-pure);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
            overflow: hidden;
        }
        .login-overlay::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(circle at 30% 20%, rgba(0, 240, 255, 0.08), transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(168, 85, 247, 0.06), transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(251, 191, 36, 0.03), transparent 70%);
            animation: pulseGlow 8s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }
        .login-overlay.hidden { opacity: 0; pointer-events: none; }
        .login-brand {
            font-family: var(--font-display);
            font-size: 96px;
            letter-spacing: 16px;
            margin-bottom: var(--space-md);
            position: relative;
            z-index: 1;
            text-shadow: 0 0 80px rgba(0, 240, 255, 0.5);
        }
        .login-brand span:first-child { 
            color: var(--neon-cyan);
            animation: glowCyan 3s ease-in-out infinite;
        }
        .login-brand span:last-child { 
            color: var(--text-100);
            text-shadow: 0 0 40px rgba(255, 255, 255, 0.3);
        }
        @keyframes glowCyan {
            0%, 100% { filter: brightness(1); text-shadow: 0 0 80px rgba(0, 240, 255, 0.5); }
            50% { filter: brightness(1.3); text-shadow: 0 0 120px rgba(0, 240, 255, 0.8); }
        }
        .login-tagline {
            font-family: var(--font-mono);
            font-size: 12px;
            color: var(--text-70);
            letter-spacing: 6px;
            margin-bottom: var(--space-2xl);
            position: relative;
            z-index: 1;
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.3);
        }
        .login-tagline::before,
        .login-tagline::after {
            content: '━━━━━';
            color: var(--neon-cyan);
            margin: 0 var(--space-lg);
            opacity: 0.3;
        }
        .login-options {
            display: flex;
            gap: var(--space-2xl);
            margin-bottom: var(--space-lg);
            position: relative;
            z-index: 1;
        }
        .login-btn {
            padding: var(--space-xl) var(--space-2xl);
            border: 2px solid;
            border-radius: 16px;
            font-family: var(--font-mono);
            font-size: 14px;
            font-weight: 800;
            letter-spacing: 3px;
            cursor: pointer;
            transition: all 0.4s var(--ease-out-expo);
            min-width: 280px;
            text-align: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        .login-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        .login-btn:hover::before {
            transform: translateX(100%);
        }
        .login-btn:hover {
            transform: translateY(-8px) scale(1.02);
        }
        .login-btn.demo {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.15), rgba(249, 115, 22, 0.05));
            border-color: var(--mode-demo);
            color: var(--mode-demo);
            box-shadow: 0 8px 32px rgba(249, 115, 22, 0.2);
        }
        .login-btn.demo:hover {
            background: linear-gradient(135deg, var(--mode-demo), #ea580c);
            color: var(--void-pure);
            box-shadow: 0 16px 64px rgba(249, 115, 22, 0.5), 0 0 80px rgba(249, 115, 22, 0.3);
            border-color: transparent;
        }
        .login-btn.cloud {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
            border-color: var(--mode-cloud);
            color: var(--mode-cloud);
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.2);
        }
        .login-btn.cloud:hover {
            background: linear-gradient(135deg, var(--mode-cloud), #059669);
            color: var(--void-pure);
            box-shadow: 0 16px 64px rgba(16, 185, 129, 0.5), 0 0 80px rgba(16, 185, 129, 0.3);
            border-color: transparent;
        }
        .login-btn-subtitle {
            font-size: 10px;
            font-weight: 500;
            letter-spacing: 2px;
            margin-top: var(--space-sm);
            opacity: 0.7;
        }
        .login-info {
            max-width: 700px;
            text-align: center;
            margin-top: var(--space-xl);
            font-family: var(--font-mono);
            font-size: 13px;
            color: var(--text-50);
            line-height: 1.8;
            padding: var(--space-xl);
            background: rgba(15, 19, 24, 0.6);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            position: relative;
            z-index: 1;
        }
        .login-info strong {
            color: var(--text-90);
            font-weight: 700;
            letter-spacing: 1px;
        }
        .login-status {
            margin-top: var(--space-lg);
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-50);
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }
        .login-status.error { 
            color: var(--neon-rose);
            text-shadow: 0 0 20px rgba(244, 63, 94, 0.5);
        }
        .login-status.success { 
            color: var(--neon-emerald);
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        /* ═══════════════════════════════════════════════════════════════════════
           LAYOUT
           ═══════════════════════════════════════════════════════════════════════ */
        .app {
            display: grid;
            grid-template-columns: 280px 1fr;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* ═══════════════════════════════════════════════════════════════════════
           SIDEBAR
           ═══════════════════════════════════════════════════════════════════════ */
        .sidebar {
            background: linear-gradient(180deg, var(--surface-1) 0%, var(--void-deep) 100%);
            border-right: 1px solid var(--border-default);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        .sidebar::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, transparent 0%, var(--neon-cyan) 20%, var(--neon-violet) 50%, var(--neon-cyan) 80%, transparent 100%);
            opacity: 0.4;
            animation: sidebarPulse 8s ease-in-out infinite;
        }
        @keyframes sidebarPulse { 0%, 100% { opacity: 0.2; } 50% { opacity: 0.6; } }

        .brand {
            padding: var(--space-xl) var(--space-lg);
            border-bottom: 1px solid var(--border-subtle);
        }
        .brand-logo {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xs);
        }
        .brand-mark {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-violet));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-display);
            font-size: 18px;
            color: var(--void-pure);
            box-shadow: var(--shadow-glow-cyan);
        }
        .brand-name {
            font-family: var(--font-display);
            font-size: 24px;
            letter-spacing: 3px;
            color: var(--text-100);
        }
        .brand-tagline {
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-50);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .nav {
            flex: 1;
            padding: var(--space-lg) 0;
            overflow-y: auto;
        }
        .nav-section { margin-bottom: var(--space-lg); }
        .nav-label {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-30);
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 0 var(--space-lg) var(--space-sm);
            transition: all 0.3s ease;
        }
        .nav-label.crm-global {
            color: var(--neon-gold);
            text-shadow: 0 0 20px rgba(251, 191, 36, 0.5), 0 0 30px rgba(168, 85, 247, 0.3);
            font-weight: 800;
            position: relative;
        }
        .nav-label.crm-global::after {
            content: '';
            position: absolute;
            left: var(--space-lg);
            bottom: 0;
            width: calc(100% - calc(var(--space-lg) * 2));
            height: 2px;
            background: linear-gradient(90deg, var(--neon-gold), var(--neon-violet));
            opacity: 0.5;
        }
        .nav-label.standard {
            color: var(--neon-cyan);
            text-shadow: 0 0 20px rgba(0, 240, 255, 0.6), 0 0 30px rgba(0, 240, 255, 0.3);
            font-weight: 700;
        }
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            color: var(--text-50);
            cursor: pointer;
            position: relative;
            transition: all 0.3s var(--ease-out-expo);
            border-left: 2px solid transparent;
        }
        .nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, var(--neon-cyan), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .nav-item:hover { color: var(--text-90); background: rgba(255, 255, 255, 0.02); }
        .nav-item:hover::before { opacity: 0.05; }
        .nav-item.active {
            color: var(--neon-cyan);
            background: rgba(0, 240, 255, 0.05);
            border-left-color: var(--neon-cyan);
        }
        .nav-item.active::before { opacity: 0.08; }
        .nav-item.business-crm-item.active {
            color: var(--neon-gold);
            background: rgba(251, 191, 36, 0.05);
            border-left-color: var(--neon-gold);
        }
        .nav-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
            position: relative;
            z-index: 1;
        }
        .nav-text {
            font-size: 13px;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .project-selector {
            padding: var(--space-lg);
            background: var(--surface-2);
            border-top: 1px solid var(--border-subtle);
        }
        .project-label {
            font-size: 9px;
            font-weight: 600;
            color: var(--text-30);
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-bottom: var(--space-sm);
        }
        .project-dropdown {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--surface-3);
            border: 1px solid var(--border-default);
            border-radius: 6px;
            color: var(--text-100);
            font-family: var(--font-sans);
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 8px center;
        }
        .project-dropdown:hover { border-color: var(--neon-cyan); }
        .project-actions {
            display: flex;
            gap: var(--space-sm);
            margin-top: var(--space-sm);
        }
        .project-btn {
            flex: 1;
            padding: var(--space-sm);
            background: var(--surface-3);
            border: 1px solid var(--border-default);
            border-radius: 6px;
            color: var(--text-70);
            font-family: var(--font-mono);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .project-btn:hover { background: var(--surface-4); color: var(--text-100); }
        .project-btn.danger:hover { background: rgba(244, 63, 94, 0.2); color: var(--neon-rose); border-color: var(--neon-rose); }

        /* ═══════════════════════════════════════════════════════════════════════
           MAIN CONTENT
           ═══════════════════════════════════════════════════════════════════════ */
        .main {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-top: 36px; /* Account for mode banner */
        }
        .command-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg) var(--space-xl);
            background: var(--surface-1);
            border-bottom: 1px solid var(--border-subtle);
        }
        .page-title {
            font-family: var(--font-display);
            font-size: 28px;
            letter-spacing: 4px;
            color: var(--text-100);
            text-shadow: 
                0 0 30px rgba(0, 240, 255, 0.6),
                0 0 50px rgba(168, 85, 247, 0.4),
                0 0 70px rgba(0, 240, 255, 0.3);
            animation: titleGlow 4s ease-in-out infinite;
        }
        @keyframes titleGlow {
            0%, 100% { 
                text-shadow: 
                    0 0 30px rgba(0, 240, 255, 0.6),
                    0 0 50px rgba(168, 85, 247, 0.4),
                    0 0 70px rgba(0, 240, 255, 0.3);
            }
            50% { 
                text-shadow: 
                    0 0 40px rgba(0, 240, 255, 0.8),
                    0 0 60px rgba(168, 85, 247, 0.6),
                    0 0 80px rgba(0, 240, 255, 0.4);
            }
        }
        .status-group { display: flex; gap: var(--space-md); }
        .status-pill {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--surface-2);
            border: 1px solid var(--border-default);
            border-radius: 20px;
            font-family: var(--font-mono);
            font-size: 10px;
            color: var(--text-70);
        }
        .status-pill .dot {
            width: 6px;
            height: 6px;
            background: var(--neon-emerald);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .status-pill.warning .dot { background: var(--neon-rose); animation: warningPulse 1s ease-in-out infinite; }
        @keyframes warningPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .workspace {
            flex: 1;
            padding: var(--space-xl);
            overflow-y: auto;
        }

        /* ═══════════════════════════════════════════════════════════════════════
           VIEWS
           ═══════════════════════════════════════════════════════════════════════ */
        .view { display: none; }
        .view.active { display: block; }

        /* ═══════════════════════════════════════════════════════════════════════
           CARDS
           ═══════════════════════════════════════════════════════════════════════ */
        .card {
            background: var(--surface-1);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            overflow: hidden;
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-subtle);
        }
        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-100);
        }
        .card-body { padding: var(--space-lg); }
        .card-footer {
            padding: var(--space-md) var(--space-lg);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            gap: var(--space-sm);
        }

        .stat-card {
            padding: var(--space-lg);
            position: relative;
            overflow: hidden;
        }
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
        }
        .stat-card.cyan::before { background: var(--neon-cyan); }
        .stat-card.violet::before { background: var(--neon-violet); }
        .stat-card.emerald::before { background: var(--neon-emerald); }
        .stat-card.gold::before { background: var(--neon-gold); }
        .stat-card.rose::before { background: var(--neon-rose); }
        .stat-card.pink::before { background: var(--neon-pink); }
        .stat-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-50);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: var(--space-xs);
        }
        .stat-value {
            font-family: var(--font-mono);
            font-size: 32px;
            font-weight: 700;
            color: var(--text-100);
        }
        .stat-sub {
            font-size: 11px;
            color: var(--text-50);
            margin-top: var(--space-xs);
        }

        /* ═══════════════════════════════════════════════════════════════════════
           GRID SYSTEM
           ═══════════════════════════════════════════════════════════════════════ */
        .grid { display: grid; gap: var(--space-lg); }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-6 { grid-template-columns: repeat(6, 1fr); }
        .mb-lg { margin-bottom: var(--space-lg); }
        .mb-md { margin-bottom: var(--space-md); }
        .mt-md { margin-top: var(--space-md); }
        .ml-md { margin-left: var(--space-md); }
        .hidden { display: none !important; }

        /* ═══════════════════════════════════════════════════════════════════════
           FORMS
           ═══════════════════════════════════════════════════════════════════════ */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: var(--space-md);
        }
        .form-group { margin-bottom: var(--space-md); }
        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-50);
            letter-spacing: 0.5px;
            margin-bottom: var(--space-xs);
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--surface-2);
            border: 1px solid var(--border-default);
            border-radius: 6px;
            color: var(--text-100);
            font-family: var(--font-sans);
            font-size: 13px;
            transition: border-color 0.2s ease;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--neon-cyan);
        }
        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* ═══════════════════════════════════════════════════════════════════════
           BUTTONS
           ═══════════════════════════════════════════════════════════════════════ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--surface-3);
            border: 1px solid var(--border-default);
            border-radius: 6px;
            color: var(--text-90);
            font-family: var(--font-sans);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn:hover { background: var(--surface-4); border-color: var(--border-strong); }
        .btn-primary {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-cyan-dim));
            border-color: var(--neon-cyan);
            color: var(--void-pure);
            font-weight: 600;
        }
        .btn-primary:hover { box-shadow: var(--shadow-glow-cyan); }
        .btn-gold {
            background: linear-gradient(135deg, var(--neon-gold), #d97706);
            border-color: var(--neon-gold);
            color: var(--void-pure);
            font-weight: 600;
        }
        .btn-sm { padding: var(--space-xs) var(--space-sm); font-size: 11px; }
        .btn-export {
            background: linear-gradient(135deg, var(--neon-violet), var(--neon-violet-dim));
            border-color: var(--neon-violet);
            color: var(--text-100);
        }

        /* ═══════════════════════════════════════════════════════════════════════
           TABLES
           ═══════════════════════════════════════════════════════════════════════ */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td {
            padding: var(--space-md) var(--space-lg);
            text-align: left;
            border-bottom: 1px solid var(--border-subtle);
        }
        th {
            font-size: 10px;
            font-weight: 700;
            color: var(--text-50);
            letter-spacing: 1px;
            text-transform: uppercase;
            background: var(--surface-2);
        }
        td { font-size: 13px; color: var(--text-90); }
        tr:hover td { background: rgba(255, 255, 255, 0.02); }
        .table-empty {
            text-align: center;
            color: var(--text-50);
            padding: var(--space-2xl) !important;
        }

        .tag {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .tag-cyan { background: rgba(0, 240, 255, 0.15); color: var(--neon-cyan); }
        .tag-violet { background: rgba(168, 85, 247, 0.15); color: var(--neon-violet); }
        .tag-emerald { background: rgba(16, 185, 129, 0.15); color: var(--neon-emerald); }
        .tag-gold { background: rgba(251, 191, 36, 0.15); color: var(--neon-gold); }
        .tag-rose { background: rgba(244, 63, 94, 0.15); color: var(--neon-rose); }
        .tag-pink { background: rgba(236, 72, 153, 0.15); color: var(--neon-pink); }

        .delete-btn {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border-default);
            border-radius: 6px;
            color: var(--text-50);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }
        .delete-btn:hover { background: rgba(244, 63, 94, 0.1); border-color: var(--neon-rose); color: var(--neon-rose); }

        .cast-badge {
            cursor: pointer;
            background: var(--neon-cyan);
            color: var(--void-pure);
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 4px;
            font-family: var(--font-mono);
            font-size: 10px;
            display: inline-block;
            font-weight: 700;
            transition: all 0.2s var(--ease-out-expo);
            border: 1px solid transparent;
        }
        .cast-badge:hover {
            background: var(--void-pure);
            color: var(--neon-cyan);
            border-color: var(--neon-cyan);
        }

        /* ═══════════════════════════════════════════════════════════════════════
           UTILITY CLASSES
           ═══════════════════════════════════════════════════════════════════════ */
        .font-mono { font-family: var(--font-mono); }
        .font-bold { font-weight: 700; }
        .text-muted { color: var(--text-50); }
        .text-cyan { color: var(--neon-cyan); }
        .text-gold { color: var(--neon-gold); }
        .text-emerald { color: var(--neon-emerald); }
        .text-violet { color: var(--neon-violet); }
        .text-rose { color: var(--neon-rose); }

        /* ═══════════════════════════════════════════════════════════════════════
           RESULT BOX
           ═══════════════════════════════════════════════════════════════════════ */
        .result-box {
            background: var(--surface-2);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            padding: var(--space-xl);
            font-family: var(--font-mono);
            font-size: 13px;
            line-height: 1.8;
            white-space: pre-wrap;
            color: var(--text-70);
            min-height: 200px;
        }
        .result-box.success { border-color: var(--neon-emerald); background: rgba(16, 185, 129, 0.05); }

        /* ═══════════════════════════════════════════════════════════════════════
           ACTIVITY LOG
           ═══════════════════════════════════════════════════════════════════════ */
        .log-container { max-height: 300px; overflow-y: auto; }
        .log-entry {
            display: flex;
            gap: var(--space-md);
            padding: var(--space-sm) 0;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 12px;
        }
        .log-time { font-family: var(--font-mono); color: var(--text-50); flex-shrink: 0; }
        .log-msg { color: var(--text-70); }

        /* ═══════════════════════════════════════════════════════════════════════
           MODALS
           ═══════════════════════════════════════════════════════════════════════ */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal {
            background: var(--surface-1);
            border: 1px solid var(--border-default);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: transform 0.3s var(--ease-out-expo);
        }
        .modal-overlay.active .modal { transform: translateY(0); }
        .modal-header {
            padding: var(--space-lg) var(--space-xl);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .modal-title { font-size: 16px; font-weight: 700; color: var(--text-100); }
        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--border-default);
            border-radius: 8px;
            color: var(--text-50);
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s ease;
        }
        .modal-close:hover { background: rgba(244, 63, 94, 0.1); border-color: var(--neon-rose); color: var(--neon-rose); }
        .modal-body { padding: var(--space-xl); }
        .modal-footer {
            padding: var(--space-lg) var(--space-xl);
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
        }

        /* ═══════════════════════════════════════════════════════════════════════
           SCHEDULE / STRIPBOARD
           ═══════════════════════════════════════════════════════════════════════ */
        .stripboard { display: flex; flex-direction: column; gap: 2px; }
        .strip {
            display: flex;
            flex-direction: column;
            background: var(--surface-2);
            border-radius: 6px;
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: grab;
        }
        .strip:active { cursor: grabbing; }
        .strip.dragging { opacity: 0.5; }
        .strip-main {
            display: grid;
            grid-template-columns: 60px 50px 50px 1fr 2fr 1fr 60px 80px;
            align-items: center;
            padding: var(--space-sm) var(--space-md);
            gap: var(--space-sm);
        }
        .strip-scene { font-family: var(--font-mono); font-weight: 700; font-size: 14px; }
        .strip-intext, .strip-daynight { font-family: var(--font-mono); font-size: 11px; text-align: center; }
        .strip-location { font-weight: 600; font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .strip-description { font-size: 11px; color: var(--text-70); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .strip-cast { font-size: 10px; }
        .strip-pages { font-family: var(--font-mono); font-size: 11px; text-align: center; }
        .strip-actions { display: flex; gap: var(--space-xs); justify-content: flex-end; }
        .strip-handle { cursor: pointer; padding: 4px; opacity: 0.5; transition: opacity 0.2s ease; }
        .strip-handle:hover { opacity: 1; }

        /* Strip Colors */
        .strip.day-int { border-left: 4px solid #ffffff; background: rgba(255, 255, 255, 0.05); }
        .strip.day-ext { border-left: 4px solid #fbbf24; background: rgba(251, 191, 36, 0.05); }
        .strip.night-int { border-left: 4px solid #3b82f6; background: rgba(59, 130, 246, 0.05); }
        .strip.night-ext { border-left: 4px solid #10b981; background: rgba(16, 185, 129, 0.05); }
        .strip.daybreak { 
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-violet)); 
            color: var(--void-pure); 
            font-weight: 700;
            border-left: none;
        }
        .strip.banner { 
            background: var(--surface-3); 
            border-left: 4px solid var(--neon-orange);
            font-style: italic;
        }

        .strip-breakdown {
            padding: var(--space-md);
            background: var(--surface-3);
            border-top: 1px solid var(--border-subtle);
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
        }
        .strip-breakdown-category { font-size: 11px; }
        .strip-breakdown-label { font-weight: 700; color: var(--text-50); margin-bottom: var(--space-xs); }
        .strip-breakdown-items { color: var(--text-70); }

        /* ═══════════════════════════════════════════════════════════════════════
           BREAKDOWN SHEET
           ═══════════════════════════════════════════════════════════════════════ */
        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--space-md);
        }
        .breakdown-category {
            background: var(--surface-2);
            border-radius: 8px;
            padding: var(--space-md);
            border: 1px solid var(--border-default);
        }
        .breakdown-category.cast { border-color: var(--neon-cyan); }
        .breakdown-category.extras { border-color: var(--neon-violet); }
        .breakdown-category.stunts { border-color: var(--neon-rose); }
        .breakdown-category.vehicles { border-color: var(--neon-gold); }
        .breakdown-category.props { border-color: var(--neon-emerald); }
        .breakdown-category.sfx { border-color: var(--neon-orange); }
        .breakdown-category.costumes { border-color: var(--neon-pink); }
        .breakdown-category.makeup { border-color: var(--neon-blue); }
        .breakdown-category-header { display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm); }
        .breakdown-category-icon { font-size: 16px; }
        .breakdown-category-name { font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }
        .breakdown-elements { min-height: 40px; }
        .breakdown-element {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            background: var(--surface-3);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
        }
        .breakdown-element-del {
            background: none;
            border: none;
            color: var(--text-50);
            cursor: pointer;
            font-size: 14px;
            padding: 0;
            line-height: 1;
        }
        .breakdown-element-del:hover { color: var(--neon-rose); }
        .breakdown-add {
            display: flex;
            gap: var(--space-xs);
            margin-top: var(--space-sm);
        }
        .breakdown-add-input {
            flex: 1;
            padding: var(--space-xs) var(--space-sm);
            background: var(--surface-3);
            border: 1px solid var(--border-default);
            border-radius: 4px;
            color: var(--text-100);
            font-size: 12px;
        }
        .breakdown-add-btn {
            padding: var(--space-xs) var(--space-sm);
            background: var(--surface-4);
            border: 1px solid var(--border-default);
            border-radius: 4px;
            color: var(--text-70);
            cursor: pointer;
        }
        .breakdown-add-btn:hover { background: var(--neon-cyan); color: var(--void-pure); }

        /* ═══════════════════════════════════════════════════════════════════════
           KANBAN BOARD
           ═══════════════════════════════════════════════════════════════════════ */
        .kanban-wrapper {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-md);
            min-height: 500px;
        }
        .kanban-column {
            background: var(--surface-2);
            border-radius: 12px;
            padding: var(--space-md);
            display: flex;
            flex-direction: column;
        }
        .kanban-header {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-50);
            letter-spacing: 1px;
            text-transform: uppercase;
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--border-subtle);
            margin-bottom: var(--space-md);
        }
        .kanban-cards { flex: 1; display: flex; flex-direction: column; gap: var(--space-sm); min-height: 100px; }
        .kanban-card {
            background: var(--surface-3);
            border-radius: 8px;
            padding: var(--space-md);
            cursor: grab;
            transition: all 0.2s ease;
            position: relative;
        }
        .kanban-card:hover { background: var(--surface-4); }
        .kanban-card.dragging { opacity: 0.5; }
        .kanban-card-name { font-weight: 700; font-size: 14px; margin-bottom: var(--space-xs); }
        .kanban-card-phone { font-family: var(--font-mono); font-size: 12px; color: var(--text-50); margin-bottom: var(--space-sm); }
        .kanban-card-value { font-family: var(--font-mono); font-size: 13px; color: var(--neon-emerald); font-weight: 700; }
        .kanban-card-actions {
            position: absolute;
            top: var(--space-sm);
            right: var(--space-sm);
            display: flex;
            gap: var(--space-xs);
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .kanban-card:hover .kanban-card-actions { opacity: 1; }
        .kanban-card-btn {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--surface-2);
            border: 1px solid var(--border-default);
            border-radius: 4px;
            color: var(--text-50);
            cursor: pointer;
            font-size: 12px;
        }
        .kanban-card-btn:hover { background: var(--surface-4); color: var(--text-100); }
        .kanban-card-btn.del:hover { background: rgba(244, 63, 94, 0.2); color: var(--neon-rose); }
        .kanban-card-btn.call:hover { background: rgba(16, 185, 129, 0.2); color: var(--neon-emerald); }

        /* ═══════════════════════════════════════════════════════════════════════
           DIALER
           ═══════════════════════════════════════════════════════════════════════ */
        .dialer-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-lg);
            min-height: 400px;
        }
        .dialer-main {
            background: var(--surface-1);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            padding: var(--space-xl);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .dialer-waiting { text-align: center; color: var(--text-50); }
        .dialer-waiting-icon { font-size: 48px; margin-bottom: var(--space-md); }
        .dialer-name { font-size: 28px; font-weight: 700; margin-bottom: var(--space-sm); }
        .dialer-phone { font-family: var(--font-mono); font-size: 24px; color: var(--neon-cyan); margin-bottom: var(--space-lg); }
        .dialer-script {
            background: var(--surface-2);
            border-radius: 8px;
            padding: var(--space-lg);
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
            line-height: 1.8;
            color: var(--text-70);
            white-space: pre-wrap;
            margin-bottom: var(--space-lg);
        }
        .dialer-controls { display: flex; gap: var(--space-md); }
        .dialer-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid var(--border-default);
            background: var(--surface-2);
            color: var(--text-70);
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .dialer-btn:hover { transform: scale(1.1); }
        .dialer-btn.call { background: var(--neon-emerald); border-color: var(--neon-emerald); color: var(--void-pure); }
        .dialer-btn.done { background: var(--neon-cyan); border-color: var(--neon-cyan); color: var(--void-pure); }
        .dialer-btn.skip:hover { background: var(--surface-4); }

        .dialer-queue-panel {
            background: var(--surface-1);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            overflow: hidden;
        }
        .dialer-queue-header {
            padding: var(--space-md) var(--space-lg);
            background: var(--surface-2);
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .dialer-queue { padding: var(--space-md); max-height: 400px; overflow-y: auto; }
        .dialer-queue-item {
            padding: var(--space-md);
            background: var(--surface-2);
            border-radius: 8px;
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .dialer-queue-item:hover { background: var(--surface-3); }
        .dialer-queue-item.active { background: rgba(0, 240, 255, 0.1); border: 1px solid var(--neon-cyan); }

        /* ═══════════════════════════════════════════════════════════════════════
           BUSINESS CRM BADGE & STYLING
           ═══════════════════════════════════════════════════════════════════════ */
        .business-crm-header {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(168, 85, 247, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        .business-crm-badge {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--neon-gold), #d97706);
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 10px;
            font-weight: 700;
            color: var(--void-pure);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* Interest colors for kanban cards */
        .interest-cinema { border-left: 3px solid var(--neon-pink); }
        .interest-vr { border-left: 3px solid var(--neon-cyan); }
        .interest-video { border-left: 3px solid var(--neon-emerald); }
        .interest-cyber { border-left: 3px solid var(--neon-violet); }
        .interest-custom { border-left: 3px solid var(--neon-gold); }
        .interest-talent { border-left: 3px solid var(--neon-pink); }
        .interest-vendor { border-left: 3px solid var(--neon-cyan); }
        .interest-sponsor { border-left: 3px solid var(--neon-gold); }
        .interest-investor { border-left: 3px solid var(--neon-emerald); }
        
        /* ─── KANBAN BOARD ─── */
        .kanban-wrapper {
            display: flex;
            gap: var(--space-lg);
            height: calc(100vh - 250px);
            overflow-x: auto;
            padding-bottom: var(--space-lg);
        }
        .kanban-column {
            min-width: 300px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
        }
        .kanban-column-header {
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .kanban-column-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-100);
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        .kanban-column-count {
            background: var(--surface-3);
            padding: 2px 8px;
            border-radius: 10px;
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-50);
        }
        .kanban-column-body {
            flex: 1;
            padding: var(--space-md);
            overflow-y: auto;
            min-height: 100px;
        }
        .kanban-card {
            background: var(--surface-2);
            border: 1px solid var(--border-default);
            border-radius: 8px;
            padding: var(--space-md);
            margin-bottom: var(--space-sm);
            cursor: grab;
            position: relative;
            transition: all 0.2s ease;
        }
        .kanban-card:active {
            cursor: grabbing;
        }
        .kanban-card:hover { 
            border-color: var(--border-strong); 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .kanban-card.dragging { 
            opacity: 0.5; 
            transform: rotate(2deg);
        }
        .kanban-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            border-radius: 8px 0 0 8px;
        }
        .kanban-card.interest-cinema::before { background: var(--neon-pink); }
        .kanban-card.interest-vr::before { background: var(--neon-cyan); }
        .kanban-card.interest-cyber::before { background: var(--neon-violet); }
        .kanban-card.interest-video::before { background: var(--neon-emerald); }
        .kanban-card.interest-custom::before { background: var(--neon-gold); }
        /* Production CRM interest types */
        .kanban-card.interest-talent::before { background: var(--neon-pink); }
        .kanban-card.interest-vendor::before { background: var(--neon-blue); }
        .kanban-card.interest-sponsor::before { background: var(--neon-gold); }
        .kanban-card.interest-investor::before { background: var(--neon-emerald); }
        .kanban-card-name { font-weight: 600; color: var(--text-100); margin-bottom: 4px; }
        .kanban-card-phone { 
            font-family: var(--font-mono); 
            font-size: 11px; 
            color: var(--text-50); 
            margin-bottom: 8px; 
        }
        .kanban-card-value { 
            font-family: var(--font-mono); 
            font-size: 14px; 
            font-weight: 700; 
            color: var(--neon-emerald); 
        }
        .kanban-card-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .kanban-card:hover .kanban-card-actions { opacity: 1; }
        .kanban-card-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: none;
            background: var(--surface-3);
            color: var(--text-70);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .kanban-card-btn:hover {
            background: var(--surface-4);
            color: var(--text-100);
        }
        .kanban-card-btn.call:hover {
            background: var(--neon-cyan);
            color: var(--void-pure);
        }
        .kanban-card-btn.del:hover {
            background: var(--neon-rose);
            color: var(--text-100);
        }
        
        /* ─── CRM VIEW DISTINCTION ─── */
        #view-biz-pipeline .card,
        #view-biz-dialer .card,
        #view-biz-intel .card {
            border-top: 3px solid var(--mode-global);
            background: linear-gradient(180deg, rgba(168, 85, 247, 0.03) 0%, var(--surface-1) 100%);
        }
        #view-prod-pipeline .card,
        #view-prod-dialer .card,
        #view-prod-intel .card {
            border-top: 3px solid var(--mode-production);
            background: linear-gradient(180deg, rgba(0, 240, 255, 0.03) 0%, var(--surface-1) 100%);
        }
        #view-biz-pipeline .kanban-column,
        #view-biz-dialer .kanban-column {
            border-top: 3px solid var(--mode-global);
        }
        #view-prod-pipeline .kanban-column,
        #view-prod-dialer .kanban-column {
            border-top: 3px solid var(--mode-production);
        }

        /* ═══════════════════════════════════════════════════════════════════════
           PRODUCTION DOCUMENTS
           ═══════════════════════════════════════════════════════════════════════ */
        .doc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-lg);
        }
        .doc-card {
            background: var(--surface-2);
            border: 1px solid var(--border-default);
            border-radius: 12px;
            padding: var(--space-xl);
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .doc-card:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow-cyan);
        }
        .doc-icon { font-size: 48px; margin-bottom: var(--space-md); }
        .doc-title { font-weight: 700; font-size: 16px; margin-bottom: var(--space-xs); }
        .doc-desc { font-size: 12px; color: var(--text-50); }

        /* ═══════════════════════════════════════════════════════════════════════
           GANTT CHART
           ═══════════════════════════════════════════════════════════════════════ */
        .gantt-container { overflow-x: auto; }
        .gantt-table { min-width: 1200px; }
        .gantt-header { display: flex; background: var(--surface-2); border-radius: 8px 8px 0 0; }
        .gantt-task-col { width: 200px; padding: var(--space-md); font-weight: 700; font-size: 11px; text-transform: uppercase; }
        .gantt-owner-col { width: 120px; padding: var(--space-md); font-weight: 700; font-size: 11px; text-transform: uppercase; }
        .gantt-days-col { flex: 1; display: flex; }
        .gantt-day { flex: 1; padding: var(--space-sm); text-align: center; font-size: 10px; font-family: var(--font-mono); border-left: 1px solid var(--border-subtle); }
        .gantt-row { display: flex; border-bottom: 1px solid var(--border-subtle); }
        .gantt-row:hover { background: rgba(255, 255, 255, 0.02); }
        .gantt-task { width: 200px; padding: var(--space-md); font-size: 13px; }
        .gantt-task.phase { font-weight: 700; background: var(--surface-3); }
        .gantt-owner { width: 120px; padding: var(--space-md); font-size: 12px; color: var(--text-50); }
        .gantt-timeline { flex: 1; display: flex; position: relative; }
        .gantt-bar {
            position: absolute;
            height: 24px;
            top: 50%;
            transform: translateY(-50%);
            border-radius: 4px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--void-pure);
            font-weight: 700;
        }
        .gantt-bar.development { background: var(--neon-cyan); }
        .gantt-bar.preproduction { background: var(--neon-violet); }
        .gantt-bar.production { background: var(--neon-emerald); }
        .gantt-bar.postproduction { background: var(--neon-gold); }
        .gantt-bar.distribution { background: var(--neon-pink); }

        /* ═══════════════════════════════════════════════════════════════════════
           WEATHER WIDGET
           ═══════════════════════════════════════════════════════════════════════ */
        .weather-widget {
            background: linear-gradient(135deg, var(--surface-2), var(--surface-3));
            border: 1px solid var(--border-default);
            border-radius: 12px;
            padding: var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }
        .weather-icon { font-size: 48px; }
        .weather-temp { font-family: var(--font-mono); font-size: 36px; font-weight: 700; }
        .weather-details { font-size: 12px; color: var(--text-50); }

        /* ═══════════════════════════════════════════════════════════════════════
           CALENDAR VIEW
           ═══════════════════════════════════════════════════════════════════════ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }
        .calendar-header {
            background: var(--surface-2);
            padding: var(--space-md);
            text-align: center;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
        }
        .calendar-day {
            background: var(--surface-1);
            min-height: 100px;
            padding: var(--space-sm);
            border: 1px solid var(--border-subtle);
        }
        .calendar-day.today { border-color: var(--neon-cyan); }
        .calendar-day.has-event { background: rgba(0, 240, 255, 0.05); }
        .calendar-date { font-family: var(--font-mono); font-size: 12px; font-weight: 700; margin-bottom: var(--space-xs); }
        .calendar-event {
            background: var(--neon-cyan);
            color: var(--void-pure);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ═══════════════════════════════════════════════════════════════════════
           RESPONSIVE
           ═══════════════════════════════════════════════════════════════════════ */
        @media (max-width: 1200px) {
            .grid-6 { grid-template-columns: repeat(3, 1fr); }
            .kanban-wrapper { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 768px) {
            .app { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .grid-2, .grid-3, .grid-4, .grid-6 { grid-template-columns: 1fr; }
            .kanban-wrapper { grid-template-columns: 1fr; }
            .dialer-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- ═══════════════════════════════════════════════════════════════════════
         LOGIN OVERLAY
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="login-overlay" id="login-overlay">
        <div class="login-brand">
            <span>DC</span><span>ALACRITY</span>
        </div>
        <div class="login-tagline">PRODUCTION COMMAND SYSTEM V7</div>
        
        <div class="login-options">
            <button class="login-btn demo" onclick="Auth.demoMode()">
                💾 DEMO MODE
                <div class="login-btn-subtitle">Local Storage Only</div>
            </button>
            <button class="login-btn cloud" onclick="Auth.login()">
                ☁️ SIGN IN
                <div class="login-btn-subtitle">Cloud Sync</div>
            </button>
        </div>
        
        <div class="login-info">
            <strong>DEMO MODE:</strong> All data saved locally in your browser. Perfect for testing and single-device use. Data won't sync across devices.<br><br>
            <strong>CLOUD MODE:</strong> Sign in with Google to sync your data across devices and access from anywhere. Requires authentication.
        </div>
        
        <div class="login-status" id="login-status">Choose your mode to get started</div>
    </div>

    <!-- ═══════════════════════════════════════════════════════════════════════
         MAIN APPLICATION
         ═══════════════════════════════════════════════════════════════════════ -->
    <div class="app" id="app" style="display: none;">
        <!-- MODE BANNER -->
        <div class="mode-banner" id="mode-banner">
            <div class="mode-status">
                <div class="mode-badge" id="mode-badge">💾 DEMO MODE</div>
                <div class="view-indicator" id="view-indicator">🎬 PRODUCTION</div>
            </div>
            <div style="font-size: 10px; color: var(--text-50);">
                <span id="mode-sync-status">Saving locally</span>
            </div>
        </div>
        
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="brand">
                <div class="brand-logo">
                    <div class="brand-mark">DC</div>
                    <div class="brand-name">ALACRITY</div>
                </div>
                <div class="brand-tagline">Production Command v6.0</div>
            </div>

            <nav class="nav">
                <div class="nav-section">
                    <div class="nav-label standard">Command</div>
                    <div class="nav-item active" onclick="Core.navigate('dashboard')">
                        <span class="nav-icon">📊</span>
                        <span class="nav-text">Dashboard</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('calendar')">
                        <span class="nav-icon">📅</span>
                        <span class="nav-text">Calendar</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-label standard">Production</div>
                    <div class="nav-item" onclick="Core.navigate('schedule')">
                        <span class="nav-icon">🎬</span>
                        <span class="nav-text">Schedule / Stripboard</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('breakdown')">
                        <span class="nav-icon">📋</span>
                        <span class="nav-text">Breakdown Sheets</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('cast-crew')">
                        <span class="nav-icon">👥</span>
                        <span class="nav-text">Cast & Crew</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('days')">
                        <span class="nav-icon">🗓️</span>
                        <span class="nav-text">Shoot Days</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('tech')">
                        <span class="nav-icon">🎥</span>
                        <span class="nav-text">Equipment</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('vault')">
                        <span class="nav-icon">💾</span>
                        <span class="nav-text">Media Vault</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-label standard">Documents</div>
                    <div class="nav-item" onclick="Core.navigate('documents')">
                        <span class="nav-icon">📄</span>
                        <span class="nav-text">Production Documents</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('gantt')">
                        <span class="nav-icon">📈</span>
                        <span class="nav-text">Gantt Charts</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-label standard">Production CRM</div>
                    <div class="nav-item" onclick="Core.navigate('prod-pipeline')">
                        <span class="nav-icon">🎯</span>
                        <span class="nav-text">Pipeline</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('prod-dialer')">
                        <span class="nav-icon">📞</span>
                        <span class="nav-text">Dialer</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('prod-intel')">
                        <span class="nav-icon">💰</span>
                        <span class="nav-text">Intel</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-label crm-global">Business CRM</div>
                    <div class="nav-item business-crm-item" onclick="Core.navigate('biz-pipeline')">
                        <span class="nav-icon">🎯</span>
                        <span class="nav-text">Pipeline</span>
                    </div>
                    <div class="nav-item business-crm-item" onclick="Core.navigate('biz-dialer')">
                        <span class="nav-icon">📞</span>
                        <span class="nav-text">Dialer</span>
                    </div>
                    <div class="nav-item business-crm-item" onclick="Core.navigate('biz-intel')">
                        <span class="nav-icon">💰</span>
                        <span class="nav-text">Intel</span>
                    </div>
                </div>

                <div class="nav-section">
                    <div class="nav-label standard">Tools</div>
                    <div class="nav-item" onclick="Core.navigate('script-import')">
                        <span class="nav-icon">📝</span>
                        <span class="nav-text">Script Import</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('weather')">
                        <span class="nav-icon">🌤️</span>
                        <span class="nav-text">Weather</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('notes')">
                        <span class="nav-icon">📓</span>
                        <span class="nav-text">Production Notes</span>
                    </div>
                    
                    <div class="nav-section">NEW FEATURES</div>
                    <div class="nav-item" onclick="Core.navigate('budget')">
                        <span class="nav-icon">💰</span>
                        <span class="nav-text">Budget Tracker</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('shotlist')">
                        <span class="nav-icon">🎬</span>
                        <span class="nav-text">Shot List</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('continuity')">
                        <span class="nav-icon">📷</span>
                        <span class="nav-text">Continuity Log</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('risk')">
                        <span class="nav-icon">⚠️</span>
                        <span class="nav-text">Risk Assessment</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('contacts')">
                        <span class="nav-icon">📒</span>
                        <span class="nav-text">Contact Directory</span>
                    </div>
                    <div class="nav-item" onclick="Core.navigate('milestones')">
                        <span class="nav-icon">🎯</span>
                        <span class="nav-text">Milestones</span>
                    </div>
                    <div class="nav-item" onclick="DataManager.exportAllData()">
                        <span class="nav-icon">📤</span>
                        <span class="nav-text">Export All Data</span>
                    </div>
                </div>
            </nav>

            <div class="project-selector">
                <div class="project-label">Active Production</div>
                <select class="project-dropdown" id="project-select" onchange="Productions.load()"></select>
                <div class="project-actions">
                    <button class="project-btn" onclick="Productions.showNew()">+ New</button>
                    <button class="project-btn" onclick="Productions.rename()">Rename</button>
                    <button class="project-btn danger" onclick="Productions.delete()">Delete</button>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main">
            <div class="command-bar">
                <h1 class="page-title" id="page-title">DASHBOARD</h1>
                <div class="status-group">
                    <div class="status-pill" id="sync-status">
                        <span class="dot"></span>
                        <span id="sync-text">SYNCED</span>
                    </div>
                    <div class="status-pill" id="user-pill">
                        <span id="user-email">Loading...</span>
                    </div>
                </div>
            </div>

            <div class="workspace">
                <!-- DASHBOARD VIEW -->
                <div id="view-dashboard" class="view active">
                    <div class="grid grid-6 mb-lg">
                        <div class="card stat-card cyan">
                            <div class="stat-label">Shoot Days</div>
                            <div class="stat-value" id="stat-days">0</div>
                            <div class="stat-sub">Scheduled</div>
                        </div>
                        <div class="card stat-card violet">
                            <div class="stat-label">Vault Assets</div>
                            <div class="stat-value" id="stat-vault">0</div>
                            <div class="stat-sub">Files Logged</div>
                        </div>
                        <div class="card stat-card emerald">
                            <div class="stat-label">Tech Items</div>
                            <div class="stat-value" id="stat-tech">0</div>
                            <div class="stat-sub">Equipment</div>
                        </div>
                        <div class="card stat-card gold">
                            <div class="stat-label">Budget Left</div>
                            <div class="stat-value" id="stat-budget">$0</div>
                            <div class="stat-sub">Available</div>
                        </div>
                        <div class="card stat-card pink">
                            <div class="stat-label">Prod Pipeline</div>
                            <div class="stat-value" id="stat-prod-pipeline">$0</div>
                            <div class="stat-sub">Potential</div>
                        </div>
                        <div class="card stat-card rose" id="over-budget-card" style="display: none;">
                            <div class="stat-label">Over Budget</div>
                            <div class="stat-value" id="stat-over">$0</div>
                            <div class="stat-sub">Categories</div>
                        </div>
                    </div>

                    <div class="grid grid-2 mb-lg">
                        <div class="card" id="hot-cost-card">
                            <div class="card-header">
                                <div class="card-title">Hot Cost Summary</div>
                                <span id="hot-cost-badge"></span>
                            </div>
                            <div class="card-body">
                                <div class="grid grid-3">
                                    <div>
                                        <div class="stat-label">Total Budget</div>
                                        <div class="stat-value" style="font-size: 24px;" id="hot-budget">$0</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">Spent + Committed</div>
                                        <div class="stat-value text-gold" style="font-size: 24px;" id="hot-spent">$0</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">Payroll Cost</div>
                                        <div class="stat-value text-violet" style="font-size: 24px;" id="hot-payroll">$0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card business-crm-header">
                            <div class="card-header">
                                <div class="card-title">Business CRM <span class="business-crm-badge">GLOBAL</span></div>
                            </div>
                            <div class="card-body">
                                <div class="grid grid-3">
                                    <div>
                                        <div class="stat-label">Pipeline Value</div>
                                        <div class="stat-value text-gold" style="font-size: 24px;" id="biz-pipeline-value">$0</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">Total Revenue</div>
                                        <div class="stat-value text-emerald" style="font-size: 24px;" id="biz-revenue-value">$0</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">Active Leads</div>
                                        <div class="stat-value text-cyan" style="font-size: 24px;" id="biz-leads-count">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Activity Log</div>
                        </div>
                        <div class="card-body">
                            <div class="log-container" id="activity-log">
                                <div class="log-entry">
                                    <span class="log-time">--:--</span>
                                    <span class="log-msg">System initialized</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CALENDAR VIEW -->
                <div id="view-calendar" class="view">
                    <div class="card mb-lg">
                        <div class="card-header">
                            <div class="card-title">Production Calendar</div>
                            <div style="display: flex; gap: var(--space-sm);">
                                <button class="btn btn-sm" onclick="Calendar.prevMonth()">◀ Prev</button>
                                <span id="calendar-month" style="font-weight: 700; min-width: 150px; text-align: center;"></span>
                                <button class="btn btn-sm" onclick="Calendar.nextMonth()">Next ▶</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="calendar-grid" id="calendar-grid"></div>
                        </div>
                    </div>
                </div>

                <!-- SCHEDULE VIEW -->
                <div id="view-schedule" class="view">
                    <div class="mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; gap: var(--space-md); align-items: center;">
                            <span class="tag tag-cyan">INT/DAY</span>
                            <span class="tag tag-gold">EXT/DAY</span>
                            <span class="tag" style="background: rgba(59, 130, 246, 0.15); color: #3b82f6;">INT/NIGHT</span>
                            <span class="tag tag-emerald">EXT/NIGHT</span>
                            <span id="schedule-total-pages" style="font-family: var(--font-mono); color: var(--text-50);">0 pages</span>
                        </div>
                        <div style="display: flex; gap: var(--space-sm);">
                            <button class="btn btn-sm" onclick="Schedule.addScene()">+ Scene</button>
                            <button class="btn btn-sm" onclick="Schedule.addDayBreak()">+ Day Break</button>
                            <button class="btn btn-sm" onclick="Schedule.addBanner()">+ Banner</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.shootingSchedule()">📄 Export PDF</button>
                        </div>
                    </div>
                    <div class="stripboard" id="stripboard"></div>
                </div>

                <!-- BREAKDOWN VIEW -->
                <div id="view-breakdown" class="view">
                    <div class="print-header mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-family: var(--font-display); letter-spacing: 2px;">BREAKDOWN SHEET</h2>
                    </div>
                    <div id="bd-nav-controls"></div>
                    <div class="card mb-lg">
                        <div class="card-body">
                            <div class="form-row mb-md">
                                <div class="form-group">
                                    <label class="form-label">Sheet #</label>
                                    <input type="text" class="form-input" id="bd-sheet" onchange="Breakdown.saveCurrentState()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Pages</label>
                                    <input type="text" class="form-input" id="bd-pages" onchange="Breakdown.saveCurrentState()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="text" class="form-input" id="bd-date" onchange="Breakdown.saveCurrentState()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Project</label>
                                    <input type="text" class="form-input" id="bd-project" onchange="Breakdown.saveCurrentState()">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Scene #</label>
                                    <input type="text" class="form-input" id="bd-scene" onchange="Breakdown.saveCurrentState()">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">INT/EXT</label>
                                    <select class="form-select" id="bd-intext" onchange="Breakdown.saveCurrentState()">
                                        <option value="INT">INT</option>
                                        <option value="EXT">EXT</option>
                                        <option value="INT/EXT">INT/EXT</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">DAY/NIGHT</label>
                                    <select class="form-select" id="bd-daynight" onchange="Breakdown.saveCurrentState()">
                                        <option value="DAY">DAY</option>
                                        <option value="NIGHT">NIGHT</option>
                                        <option value="DAWN">DAWN</option>
                                        <option value="DUSK">DUSK</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-input" id="bd-location" onchange="Breakdown.saveCurrentState()">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Scene Description</label>
                                <textarea class="form-textarea" id="bd-description" onchange="Breakdown.saveCurrentState()"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="breakdown-grid" id="breakdown-categories"></div>
                </div>

                <!-- CAST & CREW VIEW -->
                <div id="view-cast-crew" class="view">
                    <div class="grid grid-2">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Cast</div>
                                <button class="btn btn-sm btn-primary" onclick="CastCrew.addMember('cast')">+ Add Cast</button>
                            </div>
                            <div class="card-body" id="cast-list"></div>
                            <div class="card-footer">
                                <button class="btn btn-sm btn-export" onclick="PDFExport.castAndCrew()">📄 Export Cast & Crew PDF</button>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">Crew</div>
                                <button class="btn btn-sm btn-primary" onclick="CastCrew.addMember('crew')">+ Add Crew</button>
                            </div>
                            <div class="card-body" id="crew-list"></div>
                        </div>
                    </div>
                </div>

                <!-- SHOOT DAYS VIEW -->
                <div id="view-days" class="view">
                    <div class="card mb-lg">
                        <div class="card-header">
                            <div class="card-title">Add Shoot Day</div>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-input" id="day-date">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Call Time</label>
                                    <input type="time" class="form-input" id="day-call" value="06:00">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Wrap Time</label>
                                    <input type="time" class="form-input" id="day-wrap" value="18:00">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-input" id="day-location" placeholder="Shoot location">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <input type="text" class="form-input" id="day-notes" placeholder="Special notes">
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="Days.add()">Add Shoot Day</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Scheduled Days</div>
                            <button class="btn btn-sm" onclick="Days.exportCSV()">Export CSV</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Call</th>
                                        <th>Wrap</th>
                                        <th>Location</th>
                                        <th>Notes</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="table-days"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- EQUIPMENT VIEW -->
                <div id="view-tech" class="view">
                    <div class="card mb-lg">
                        <div class="card-header">
                            <div class="card-title">Add Equipment</div>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Item Name</label>
                                    <input type="text" class="form-input" id="tech-name" placeholder="Equipment name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <select class="form-select" id="tech-category">
                                        <option value="Camera">Camera</option>
                                        <option value="Lens">Lens</option>
                                        <option value="Lighting">Lighting</option>
                                        <option value="Audio">Audio</option>
                                        <option value="Grip">Grip</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Serial #</label>
                                    <input type="text" class="form-input" id="tech-serial" placeholder="Serial number">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Owner</label>
                                    <select class="form-select" id="tech-owner">
                                        <option value="Production">Production</option>
                                        <option value="Rental">Rental</option>
                                        <option value="Personal">Personal</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="Tech.add()">Add Equipment</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Equipment Inventory</div>
                            <button class="btn btn-sm" onclick="Tech.exportCSV()">Export CSV</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Item</th>
                                        <th>Category</th>
                                        <th>Serial</th>
                                        <th>Owner</th>
                                        <th>Status</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="table-tech"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- MEDIA VAULT VIEW -->
                <div id="view-vault" class="view">
                    <div class="card mb-lg">
                        <div class="card-header">
                            <div class="card-title">Log Media Asset</div>
                        </div>
                        <div class="card-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Filename</label>
                                    <input type="text" class="form-input" id="vault-filename" placeholder="A001_C001.mov">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Scene</label>
                                    <input type="text" class="form-input" id="vault-scene" placeholder="Scene number">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Camera</label>
                                    <input type="text" class="form-input" id="vault-camera" placeholder="A-Cam">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Storage</label>
                                    <input type="text" class="form-input" id="vault-storage" placeholder="SSD-01">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notes</label>
                                <input type="text" class="form-input" id="vault-notes" placeholder="Notes about this asset">
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="Vault.add()">Log Asset</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Media Assets</div>
                            <button class="btn btn-sm" onclick="Vault.exportCSV()">Export CSV</button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Filename</th>
                                        <th>Scene</th>
                                        <th>Camera</th>
                                        <th>Storage</th>
                                        <th>Notes</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="table-vault"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- PRODUCTION DOCUMENTS VIEW -->
                <div id="view-documents" class="view">
                    <h2 style="font-family: var(--font-display); letter-spacing: 2px; margin-bottom: var(--space-lg);">PRODUCTION DOCUMENTS</h2>
                    <div class="doc-grid">
                        <div class="doc-card" onclick="PDFExport.scriptBreakdown()">
                            <div class="doc-icon">📋</div>
                            <div class="doc-title">Script Breakdown</div>
                            <div class="doc-desc">Complete scene-by-scene breakdown with all elements</div>
                        </div>
                        <div class="doc-card" onclick="PDFExport.shootingSchedule()">
                            <div class="doc-icon">🎬</div>
                            <div class="doc-title">Shooting Schedule</div>
                            <div class="doc-desc">Full stripboard schedule with day breaks</div>
                        </div>
                        <div class="doc-card" onclick="PDFExport.castAndCrew()">
                            <div class="doc-icon">👥</div>
                            <div class="doc-title">Cast & Crew List</div>
                            <div class="doc-desc">Complete cast and crew contact sheet</div>
                        </div>
                        <div class="doc-card" onclick="PDFExport.callSheet()">
                            <div class="doc-icon">📞</div>
                            <div class="doc-title">Call Sheet</div>
                            <div class="doc-desc">Daily call sheet with all details</div>
                        </div>
                        <div class="doc-card" onclick="PDFExport.talentRelease()">
                            <div class="doc-icon">✍️</div>
                            <div class="doc-title">Talent Release Form</div>
                            <div class="doc-desc">Customized acting release agreement</div>
                        </div>
                        <div class="doc-card" onclick="PDFExport.locationRelease()">
                            <div class="doc-icon">📍</div>
                            <div class="doc-title">Location Release Form</div>
                            <div class="doc-desc">Customized location agreement</div>
                        </div>
                        <div class="doc-card" onclick="Core.navigate('gantt')">
                            <div class="doc-icon">📈</div>
                            <div class="doc-title">Gantt Charts</div>
                            <div class="doc-desc">Production & Global timeline charts</div>
                        </div>
                        <div class="doc-card" onclick="PDFExport.dailyReport()">
                            <div class="doc-icon">📊</div>
                            <div class="doc-title">Daily Production Report</div>
                            <div class="doc-desc">End-of-day summary report</div>
                        </div>
                    </div>
                </div>

                <!-- GANTT CHART VIEW -->
                <div id="view-gantt" class="view">
                    <div class="mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <h2 style="font-family: var(--font-display); letter-spacing: 2px;">GANTT CHARTS</h2>
                        <div style="display: flex; gap: var(--space-sm);">
                            <button class="btn btn-sm" onclick="Gantt.switchView('production')" id="gantt-btn-production">Production Gantt</button>
                            <button class="btn btn-sm" onclick="Gantt.switchView('global')" id="gantt-btn-global">Global Gantt</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.ganttChart()">📄 Export PDF</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title" id="gantt-title">Production Timeline</div>
                            <button class="btn btn-sm" onclick="Gantt.addTask()">+ Add Task</button>
                        </div>
                        <div class="card-body">
                            <div class="gantt-container" id="gantt-container"></div>
                        </div>
                    </div>
                </div>

                <!-- PRODUCTION CRM VIEWS -->
                <div id="view-prod-pipeline" class="view">
                    <div class="mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="tag tag-cyan">PRODUCTION CRM</span>
                            <span class="text-muted ml-md">Talent, Vendors, Sponsors, Investors</span>
                        </div>
                        <button class="btn btn-primary" onclick="ProdCRM.showLeadModal()">+ Add Contact</button>
                    </div>
                    <div class="kanban-wrapper" id="prod-kanban-board"></div>
                </div>

                <div id="view-prod-dialer" class="view">
                    <div class="mb-lg">
                        <span class="tag tag-cyan">PRODUCTION CRM</span>
                        <span class="text-muted ml-md">Dialer HUD</span>
                    </div>
                    <div class="dialer-grid">
                        <div class="dialer-main" id="prod-dialer-main">
                            <div class="dialer-waiting">
                                <div class="dialer-waiting-icon">📞</div>
                                <div>SELECT A CONTACT</div>
                                <div class="text-muted mt-md">Click a contact from the queue to begin</div>
                            </div>
                        </div>
                        <div class="dialer-queue-panel">
                            <div class="dialer-queue-header">Contact Queue</div>
                            <div class="dialer-queue" id="prod-dialer-queue"></div>
                        </div>
                    </div>
                </div>

                <div id="view-prod-intel" class="view">
                    <div class="mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="tag tag-cyan">PRODUCTION CRM</span>
                            <span class="text-muted ml-md">Intel Dashboard</span>
                        </div>
                        <button class="btn btn-primary" onclick="ProdCRM.showIncomeModal()">+ Add Transaction</button>
                    </div>

                    <div class="grid grid-3 mb-lg">
                        <div class="card stat-card gold">
                            <div class="stat-label">Pipeline Value</div>
                            <div class="stat-value" id="prod-intel-pipeline">$0</div>
                            <div class="stat-sub">Potential Revenue</div>
                        </div>
                        <div class="card stat-card emerald">
                            <div class="stat-label">Total Revenue</div>
                            <div class="stat-value" id="prod-intel-revenue">$0</div>
                            <div class="stat-sub">Confirmed</div>
                        </div>
                        <div class="card stat-card violet">
                            <div class="stat-label">Conversion Rate</div>
                            <div class="stat-value" id="prod-intel-conversion">0%</div>
                            <div class="stat-sub">Closed / Total</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Revenue Ledger</div>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Source</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="prod-table-ledger"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- BUSINESS CRM VIEWS -->
                <div id="view-biz-pipeline" class="view">
                    <div class="mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="tag tag-violet">BUSINESS CRM</span>
                            <span class="text-muted ml-md">Cinema, VR, General Video, Cyber</span>
                        </div>
                        <button class="btn btn-primary" onclick="BizCRM.showLeadModal()">+ Add Lead</button>
                    </div>
                    <div class="kanban-wrapper" id="biz-kanban-board"></div>
                </div>

                <div id="view-biz-dialer" class="view">
                    <div class="mb-lg">
                        <span class="business-crm-badge">BUSINESS CRM</span>
                        <span class="text-muted ml-md">Dialer HUD</span>
                    </div>
                    <div class="dialer-grid">
                        <div class="dialer-main" id="biz-dialer-main">
                            <div class="dialer-waiting">
                                <div class="dialer-waiting-icon">📞</div>
                                <div>SELECT A LEAD</div>
                                <div class="text-muted mt-md">Click a lead from the queue to begin</div>
                            </div>
                        </div>
                        <div class="dialer-queue-panel">
                            <div class="dialer-queue-header">Lead Queue</div>
                            <div class="dialer-queue" id="biz-dialer-queue"></div>
                        </div>
                    </div>
                </div>

                <div id="view-biz-intel" class="view">
                    <div class="mb-lg" style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span class="business-crm-badge">BUSINESS CRM</span>
                            <span class="text-muted ml-md">Intel Dashboard</span>
                        </div>
                        <button class="btn btn-gold" onclick="BizCRM.showIncomeModal()">+ Add Transaction</button>
                    </div>

                    <div class="grid grid-3 mb-lg">
                        <div class="card stat-card gold">
                            <div class="stat-label">Pipeline Value</div>
                            <div class="stat-value" id="biz-intel-pipeline">$0</div>
                            <div class="stat-sub">Potential Revenue</div>
                        </div>
                        <div class="card stat-card emerald">
                            <div class="stat-label">Total Revenue</div>
                            <div class="stat-value" id="biz-intel-revenue">$0</div>
                            <div class="stat-sub">Confirmed</div>
                        </div>
                        <div class="card stat-card violet">
                            <div class="stat-label">Conversion Rate</div>
                            <div class="stat-value" id="biz-intel-conversion">0%</div>
                            <div class="stat-sub">Closed / Total</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Revenue Ledger</div>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Source</th>
                                        <th>Type</th>
                                        <th>Amount</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="biz-table-ledger"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- SCRIPT IMPORT VIEW -->
                <div id="view-script-import" class="view">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Script Import Tool</div>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-lg">Paste your screenplay text below. The system will automatically detect scenes using standard screenplay format (INT./EXT. LOCATION - DAY/NIGHT).</p>
                            <div class="form-group">
                                <label class="form-label">Script Text</label>
                                <textarea class="form-textarea" id="script-import-text" style="min-height: 300px;" placeholder="Paste your screenplay here...

Example format:
INT. COFFEE SHOP - DAY

JOHN enters the busy coffee shop and looks around.

JOHN
I need to find her.

EXT. CITY STREET - NIGHT

Rain pours down as SARAH runs through the streets."></textarea>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary" onclick="ScriptImport.run()">Import Script</button>
                            <button class="btn" onclick="ScriptImport.preview()">Preview Detection</button>
                        </div>
                    </div>
                </div>

                <!-- WEATHER VIEW -->
                <div id="view-weather" class="view">
                    <div class="card mb-lg">
                        <div class="card-header">
                            <div class="card-title">Weather Forecast</div>
                        </div>
                        <div class="card-body">
                            <div class="form-row mb-lg">
                                <div class="form-group">
                                    <label class="form-label">Location</label>
                                    <input type="text" class="form-input" id="weather-location" placeholder="Enter city name">
                                </div>
                                <div class="form-group" style="display: flex; align-items: flex-end;">
                                    <button class="btn btn-primary" onclick="Weather.fetch()">Get Weather</button>
                                </div>
                            </div>
                            <div id="weather-display"></div>
                        </div>
                    </div>
                </div>

                <!-- NOTES VIEW -->
                <div id="view-notes" class="view">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Production Notes</div>
                            <button class="btn btn-sm" onclick="Notes.save()">Save Notes</button>
                        </div>
                        <div class="card-body">
                            <textarea class="form-textarea" id="production-notes" style="min-height: 500px;" placeholder="Enter production notes here..."></textarea>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         MODALS
         ═══════════════════════════════════════════════════════════════════════ -->

    <!-- New Production Modal -->
    <div class="modal-overlay" id="modal-new-production">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">New Production</div>
                <button class="modal-close" onclick="Productions.hideModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Production Name</label>
                    <input type="text" class="form-input" id="new-production-name" placeholder="Enter production name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="Productions.hideModal()">Cancel</button>
                <button class="btn btn-primary" onclick="Productions.create()">Create</button>
            </div>
        </div>
    </div>

    <!-- Scene Modal -->
    <div class="modal-overlay" id="modal-scene">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="scene-modal-title">Add Scene</div>
                <button class="modal-close" onclick="Schedule.hideModals()">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="scene-id">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Scene #</label>
                        <input type="text" class="form-input" id="scene-number" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">INT/EXT</label>
                        <select class="form-select" id="scene-intext">
                            <option value="INT">INT</option>
                            <option value="EXT">EXT</option>
                            <option value="INT/EXT">INT/EXT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">DAY/NIGHT</label>
                        <select class="form-select" id="scene-daynight">
                            <option value="DAY">DAY</option>
                            <option value="NIGHT">NIGHT</option>
                            <option value="DAWN">DAWN</option>
                            <option value="DUSK">DUSK</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Script Location</label>
                    <input type="text" class="form-input" id="scene-location" placeholder="COFFEE SHOP">
                </div>
                <div class="form-group">
                    <label class="form-label">Shoot Location</label>
                    <input type="text" class="form-input" id="scene-shoot-location" placeholder="123 Main St">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" id="scene-description" placeholder="Scene description..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Cast (comma separated)</label>
                    <input type="text" class="form-input" id="scene-cast" placeholder="John, Sarah, C001">
                </div>
                <div class="form-group">
                    <label class="form-label">Pages</label>
                    <input type="text" class="form-input" id="scene-pages" placeholder="1 2/8">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="Schedule.hideModals()">Cancel</button>
                <button class="btn btn-primary" onclick="Schedule.saveScene()">Save</button>
            </div>
        </div>
    </div>

    <!-- Banner Modal -->
    <div class="modal-overlay" id="modal-banner">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Banner</div>
                <button class="modal-close" onclick="Schedule.hideModals()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Banner Type</label>
                    <select class="form-select" id="banner-type" onchange="Schedule.toggleCustomBanner()">
                        <option value="COMPANY MOVE">COMPANY MOVE</option>
                        <option value="LUNCH">LUNCH</option>
                        <option value="MEAL BREAK">MEAL BREAK</option>
                        <option value="TURNAROUND">TURNAROUND</option>
                        <option value="TRAVEL">TRAVEL</option>
                        <option value="Custom">Custom...</option>
                    </select>
                </div>
                <div class="form-group hidden" id="banner-custom-group">
                    <label class="form-label">Custom Text</label>
                    <input type="text" class="form-input" id="banner-custom" placeholder="Enter custom banner text">
                </div>
                <div class="form-group">
                    <label class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-input" id="banner-time" value="30">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="Schedule.hideModals()">Cancel</button>
                <button class="btn btn-primary" onclick="Schedule.saveBanner()">Add Banner</button>
            </div>
        </div>
    </div>

    <!-- Production CRM Lead Modal -->
    <div class="modal-overlay" id="modal-prod-lead">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="prod-lead-modal-title">Add Contact</div>
                <button class="modal-close" onclick="ProdCRM.hideModals()">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="prod-lead-id">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="prod-lead-name" placeholder="Contact name">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="tel" class="form-input" id="prod-lead-phone" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="prod-lead-email" placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="prod-lead-interest" onchange="ProdCRM.toggleCustomInterest()">
                        <option value="Talent">Talent</option>
                        <option value="Vendor">Vendor</option>
                        <option value="Sponsor">Sponsor</option>
                        <option value="Investor">Investor</option>
                        <option value="Custom">Custom...</option>
                    </select>
                </div>
                <div class="form-group hidden" id="prod-custom-interest-group">
                    <label class="form-label">Custom Type</label>
                    <input type="text" class="form-input" id="prod-lead-custom-interest" placeholder="Enter custom type">
                </div>
                <div class="form-group">
                    <label class="form-label">Value ($)</label>
                    <input type="number" class="form-input" id="prod-lead-value" placeholder="Potential value">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes / Script</label>
                    <textarea class="form-textarea" id="prod-lead-notes" placeholder="Call script, notes, context..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="ProdCRM.hideModals()">Cancel</button>
                <button class="btn btn-primary" onclick="ProdCRM.saveLead()">Save</button>
            </div>
        </div>
    </div>

    <!-- Production CRM Income Modal -->
    <div class="modal-overlay" id="modal-prod-income">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Transaction</div>
                <button class="modal-close" onclick="ProdCRM.hideModals()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Source</label>
                    <input type="text" class="form-input" id="prod-income-source" placeholder="Client name, project...">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" class="form-input" id="prod-income-amount" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="prod-income-date">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="ProdCRM.hideModals()">Cancel</button>
                <button class="btn btn-primary" onclick="ProdCRM.saveIncome()">Save</button>
            </div>
        </div>
    </div>

    <!-- Business CRM Lead Modal -->
    <div class="modal-overlay" id="modal-biz-lead">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="biz-lead-modal-title">Add Lead</div>
                <button class="modal-close" onclick="BizCRM.hideModals()">×</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="biz-lead-id">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="biz-lead-name" placeholder="Lead name">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <input type="tel" class="form-input" id="biz-lead-phone" placeholder="(555) 123-4567">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="biz-lead-email" placeholder="email@example.com">
                </div>
                <div class="form-group">
                    <label class="form-label">Interest</label>
                    <select class="form-select" id="biz-lead-interest" onchange="BizCRM.toggleCustomInterest()">
                        <option value="Cinema">Cinema</option>
                        <option value="VR">VR</option>
                        <option value="General Video">General Video</option>
                        <option value="Cyber">Cyber</option>
                        <option value="Custom">Custom...</option>
                    </select>
                </div>
                <div class="form-group hidden" id="biz-custom-interest-group">
                    <label class="form-label">Custom Interest</label>
                    <input type="text" class="form-input" id="biz-lead-custom-interest" placeholder="Enter custom interest">
                </div>
                <div class="form-group">
                    <label class="form-label">Value ($)</label>
                    <input type="number" class="form-input" id="biz-lead-value" placeholder="Potential value">
                </div>
                <div class="form-group">
                    <label class="form-label">Notes / Script</label>
                    <textarea class="form-textarea" id="biz-lead-notes" placeholder="Call script, notes, context..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="BizCRM.hideModals()">Cancel</button>
                <button class="btn btn-gold" onclick="BizCRM.saveLead()">Save</button>
            </div>
        </div>
    </div>

    <!-- Business CRM Income Modal -->
    <div class="modal-overlay" id="modal-biz-income">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Transaction</div>
                <button class="modal-close" onclick="BizCRM.hideModals()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Source</label>
                    <input type="text" class="form-input" id="biz-income-source" placeholder="Client name, project...">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount ($)</label>
                    <input type="number" class="form-input" id="biz-income-amount" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="biz-income-date">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="BizCRM.hideModals()">Cancel</button>
                <button class="btn btn-gold" onclick="BizCRM.saveIncome()">Save</button>
            </div>
        </div>
    </div>

    <!-- Call Sheet Modal -->
    <div class="modal-overlay" id="modal-callsheet">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Generate Call Sheet</div>
                <button class="modal-close" onclick="PDFExport.hideCallSheetModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Shoot Day #</label>
                        <input type="number" class="form-input" id="cs-day-number" value="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-input" id="cs-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">General Call Time</label>
                        <input type="time" class="form-input" id="cs-call-time" value="06:00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Director</label>
                        <input type="text" class="form-input" id="cs-director" placeholder="Director name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">1st AD</label>
                        <input type="text" class="form-input" id="cs-ad" placeholder="1st AD name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Producer</label>
                        <input type="text" class="form-input" id="cs-producer" placeholder="Producer name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Location Name</label>
                        <input type="text" class="form-input" id="cs-location" placeholder="Main location">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location Address</label>
                        <input type="text" class="form-input" id="cs-address" placeholder="Full address">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Weather Forecast</label>
                    <input type="text" class="form-input" id="cs-weather" placeholder="Sunny, 72°F">
                </div>
                <div class="form-group">
                    <label class="form-label">Special Notes</label>
                    <textarea class="form-textarea" id="cs-notes" placeholder="Special instructions, safety notes, etc."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="PDFExport.hideCallSheetModal()">Cancel</button>
                <button class="btn btn-primary" onclick="PDFExport.generateCallSheet()">Generate PDF</button>
            </div>
        </div>
    </div>

    <!-- Talent Release Modal -->
    <div class="modal-overlay" id="modal-talent-release">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">Generate Talent Release Form</div>
                <button class="modal-close" onclick="PDFExport.hideTalentReleaseModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Performer Name</label>
                        <input type="text" class="form-input" id="tr-performer-name" placeholder="Full legal name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Role/Character</label>
                        <input type="text" class="form-input" id="tr-role" placeholder="Character name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Production Company</label>
                        <input type="text" class="form-input" id="tr-company" placeholder="Company name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Project Title</label>
                        <input type="text" class="form-input" id="tr-project" placeholder="Film/Project title">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Compensation</label>
                        <input type="text" class="form-input" id="tr-compensation" placeholder="$0.00 or Deferred">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Shoot Date(s)</label>
                        <input type="text" class="form-input" id="tr-dates" placeholder="Date range">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Performer Address</label>
                    <input type="text" class="form-input" id="tr-address" placeholder="Full address">
                </div>
                <div class="form-group">
                    <label class="form-label">Additional Terms</label>
                    <textarea class="form-textarea" id="tr-terms" placeholder="Any additional terms or conditions..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="PDFExport.hideTalentReleaseModal()">Cancel</button>
                <button class="btn btn-primary" onclick="PDFExport.generateTalentRelease()">Generate PDF</button>
            </div>
        </div>
    </div>

    <!-- Location Release Modal -->
    <div class="modal-overlay" id="modal-location-release">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <div class="modal-title">Generate Location Release Form</div>
                <button class="modal-close" onclick="PDFExport.hideLocationReleaseModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Property Owner Name</label>
                        <input type="text" class="form-input" id="lr-owner-name" placeholder="Full legal name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Production Company</label>
                        <input type="text" class="form-input" id="lr-company" placeholder="Company name">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location Address</label>
                    <input type="text" class="form-input" id="lr-address" placeholder="Full property address">
                </div>
                <div class="form-group">
                    <label class="form-label">Location Description</label>
                    <input type="text" class="form-input" id="lr-description" placeholder="Brief description of the location">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Project Title</label>
                        <input type="text" class="form-input" id="lr-project" placeholder="Film/Project title">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fee/Compensation</label>
                        <input type="text" class="form-input" id="lr-fee" placeholder="$0.00 or In-kind">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-input" id="lr-start-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-input" id="lr-end-date">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Access Hours</label>
                        <input type="text" class="form-input" id="lr-hours" placeholder="6:00 AM - 10:00 PM">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Crew Size (approx)</label>
                        <input type="number" class="form-input" id="lr-crew-size" placeholder="25">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Special Conditions</label>
                    <textarea class="form-textarea" id="lr-conditions" placeholder="Parking arrangements, restricted areas, special requirements..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="PDFExport.hideLocationReleaseModal()">Cancel</button>
                <button class="btn btn-primary" onclick="PDFExport.generateLocationRelease()">Generate PDF</button>
            </div>
        </div>
    </div>

    <!-- Gantt Task Modal -->
    <div class="modal-overlay" id="modal-gantt-task">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Add Task</div>
                <button class="modal-close" onclick="Gantt.hideModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Task Name</label>
                    <input type="text" class="form-input" id="gantt-task-name" placeholder="Task name">
                </div>
                <div class="form-group">
                    <label class="form-label">Owner/Assignee</label>
                    <input type="text" class="form-input" id="gantt-task-owner" placeholder="Person responsible">
                </div>
                <div class="form-group">
                    <label class="form-label">Phase</label>
                    <select class="form-select" id="gantt-task-phase">
                        <option value="development">Development</option>
                        <option value="preproduction">Pre-Production</option>
                        <option value="production">Production</option>
                        <option value="postproduction">Post-Production</option>
                        <option value="distribution">Distribution</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-input" id="gantt-task-start">
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-input" id="gantt-task-end">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="Gantt.hideModal()">Cancel</button>
                <button class="btn btn-primary" onclick="Gantt.saveTask()">Add Task</button>
            </div>
        </div>
    </div>

    <!-- Daily Report Modal -->
    <div class="modal-overlay" id="modal-daily-report">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Generate Daily Production Report</div>
                <button class="modal-close" onclick="PDFExport.hideDailyReportModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Report Date</label>
                        <input type="date" class="form-input" id="dr-date">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Day # of #</label>
                        <input type="text" class="form-input" id="dr-day-of" placeholder="1 of 20">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Call Time</label>
                        <input type="time" class="form-input" id="dr-call">
                    </div>
                    <div class="form-group">
                        <label class="form-label">First Shot</label>
                        <input type="time" class="form-input" id="dr-first-shot">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lunch</label>
                        <input type="text" class="form-input" id="dr-lunch" placeholder="12:00-12:30">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Wrap</label>
                        <input type="time" class="form-input" id="dr-wrap">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Scenes Shot Today</label>
                        <input type="text" class="form-input" id="dr-scenes" placeholder="1, 2, 3A">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pages Shot Today</label>
                        <input type="text" class="form-input" id="dr-pages" placeholder="3 2/8">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes / Issues</label>
                    <textarea class="form-textarea" id="dr-notes" placeholder="Any issues, delays, or notable events..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="PDFExport.hideDailyReportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="PDFExport.generateDailyReport()">Generate PDF</button>
            </div>
        </div>
    </div>

    <!-- Cast Info Popup -->
    <div class="modal-overlay" id="modal-cast-info">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <div class="modal-title">Cast Member Info</div>
                <button class="modal-close" onclick="Schedule.hideCastInfo()">×</button>
            </div>
            <div class="modal-body" id="cast-info-content"></div>
        </div>
    </div>


    <!-- ═══════════════════════════════════════════════════════════════════════
         FIREBASE SDK - Using Realtime Database
         ═══════════════════════════════════════════════════════════════════════ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC80xtHEQ1rDd9meozTsPQTm-MuLA7eRkc",
            authDomain: "alacrity-hub.firebaseapp.com",
            databaseURL: "https://alacrity-hub-default-rtdb.firebaseio.com",
            projectId: "alacrity-hub",
            storageBucket: "alacrity-hub.firebasestorage.app",
            messagingSenderId: "17649437105",
            appId: "1:17649437105:web:ed206fa2f2de373ac1d590"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        // Expose to global scope
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseProvider = provider;
        window.firebaseSignInWithPopup = signInWithPopup;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseSignOut = signOut;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;

        // Signal that Firebase is ready
        window.firebaseReady = true;
        document.dispatchEvent(new Event('firebaseReady'));
    </script>

    <!-- ═══════════════════════════════════════════════════════════════════════
         MAIN APPLICATION JAVASCRIPT
         ═══════════════════════════════════════════════════════════════════════ -->
    <script>
        /* ═══════════════════════════════════════════════════════════════════════
           BREAKDOWN CATEGORIES CONFIGURATION
           ═══════════════════════════════════════════════════════════════════════ */
        const BREAKDOWN_CATEGORIES = [
            { id: 'cast', name: 'Cast', icon: '👤', color: 'cast' },
            { id: 'extras', name: 'Extras', icon: '👥', color: 'extras' },
            { id: 'stunts', name: 'Stunts', icon: '🎭', color: 'stunts' },
            { id: 'vehicles', name: 'Vehicles', icon: '🚗', color: 'vehicles' },
            { id: 'props', name: 'Props', icon: '🎬', color: 'props' },
            { id: 'sfx', name: 'Special Effects', icon: '✨', color: 'sfx' },
            { id: 'costumes', name: 'Wardrobe', icon: '👔', color: 'costumes' },
            { id: 'makeup', name: 'Makeup/Hair', icon: '💄', color: 'makeup' },
            { id: 'animals', name: 'Animals', icon: '🐕', color: 'cast' },
            { id: 'greenery', name: 'Greenery', icon: '🌿', color: 'extras' },
            { id: 'security', name: 'Security', icon: '🔒', color: 'stunts' },
            { id: 'notes', name: 'Notes', icon: '📝', color: 'vehicles' }
        ];

        /* ═══════════════════════════════════════════════════════════════════════
           CRM STAGES CONFIGURATION
           ═══════════════════════════════════════════════════════════════════════ */
        const CRM_STAGES = [
            { id: 'new', name: 'New' },
            { id: 'contacted', name: 'Contacted' },
            { id: 'pitched', name: 'Pitched' },
            { id: 'negotiating', name: 'Negotiating' },
            { id: 'done', name: 'Closed' }
        ];

        /* ═══════════════════════════════════════════════════════════════════════
           AUTHENTICATION MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Auth = {
            user: null,
            unsubscribe: null,
            isDemoMode: false,

            async init() {
                const statusEl = document.getElementById('login-status');
                statusEl.textContent = 'Ready to start...';

                // Wait for Firebase to be ready
                if (!window.firebaseReady) {
                    await new Promise(resolve => {
                        document.addEventListener('firebaseReady', resolve, { once: true });
                    });
                }

                statusEl.textContent = 'Choose your mode';

                // Listen for auth state changes
                window.firebaseOnAuthStateChanged(window.firebaseAuth, async (user) => {
                    if (user && !this.isDemoMode) {
                        this.user = user;
                        statusEl.textContent = 'Authenticated. Loading...';
                        statusEl.className = 'login-status success';
                        
                        // Initialize app
                        await this.onLogin();
                    } else if (!this.isDemoMode) {
                        statusEl.textContent = 'Choose Demo Mode or Sign In';
                        statusEl.className = 'login-status';
                    }
                });
            },

            async login() {
                const statusEl = document.getElementById('login-status');
                const btn = document.querySelector('.login-btn.cloud');
                
                try {
                    if (btn) btn.disabled = true;
                    statusEl.textContent = 'Opening authentication...';
                    statusEl.className = 'login-status';
                    
                    const result = await window.firebaseSignInWithPopup(window.firebaseAuth, window.firebaseProvider);
                    this.user = result.user;
                    this.isDemoMode = false;
                    
                } catch (error) {
                    console.error('Login error:', error);
                    statusEl.textContent = 'Authentication failed: ' + error.message;
                    statusEl.className = 'login-status error';
                    if (btn) btn.disabled = false;
                }
            },

            async onLogin() {
                // Hide login overlay, show app
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('app').style.display = 'grid';
                
                // Update user display
                document.getElementById('user-email').textContent = this.user.email || this.user.displayName;
                
                // Update mode banner
                this.updateModeBanner();
                
                // Initialize Core with user data
                await Core.init();
            },

            updateModeBanner() {
                const banner = document.getElementById('mode-banner');
                const badge = document.getElementById('mode-badge');
                const syncStatus = document.getElementById('mode-sync-status');
                
                if (this.isDemoMode) {
                    banner.className = 'mode-banner demo-mode';
                    badge.className = 'mode-badge demo';
                    badge.innerHTML = '💾 DEMO MODE';
                    if (syncStatus) syncStatus.textContent = 'Saving locally';
                } else {
                    banner.className = 'mode-banner cloud-mode';
                    badge.className = 'mode-badge cloud';
                    badge.innerHTML = '☁️ CLOUD MODE';
                    if (syncStatus) syncStatus.textContent = 'Synced to cloud';
                }
            },

            async logout() {
                if (this.unsubscribe) {
                    this.unsubscribe();
                }
                if (!this.isDemoMode) {
                    await window.firebaseSignOut(window.firebaseAuth);
                }
                this.isDemoMode = false;
                location.reload();
            },

            demoMode() {
                // Enter demo mode without authentication
                this.isDemoMode = true;
                this.user = {
                    uid: 'demo_user',
                    email: 'demo@local',
                    displayName: 'Demo User'
                };
                
                const statusEl = document.getElementById('login-status');
                statusEl.textContent = 'Entering Demo Mode - All data saved locally';
                statusEl.className = 'login-status success';
                
                setTimeout(() => {
                    this.onLogin();
                }, 500);
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           CORE MODULE - Data Management & Navigation
           ═══════════════════════════════════════════════════════════════════════ */
        const Core = {
            currentProduction: 'Default Production',
            data: {},
            bizData: { leads: [], ledger: [] },
            activityLog: [],
            syncTimeout: null,

            async init() {
                // Load productions list
                this.renderProductionDropdown();
                
                // Load current production data
                await this.loadProduction(this.currentProduction);
                
                // Load business CRM data (global, not per-production)
                await this.loadBizData();
                
                // Render all views
                this.renderAll();
                
                // Setup real-time sync
                this.setupRealtimeSync();
                
                this.log('System initialized');
            },

            getProductions() {
                const stored = localStorage.getItem('dc_alacrity_productions');
                return stored ? JSON.parse(stored) : ['Default Production'];
            },

            createProduction(name) {
                const productions = this.getProductions();
                if (!productions.includes(name)) {
                    productions.push(name);
                    localStorage.setItem('dc_alacrity_productions', JSON.stringify(productions));
                }
            },

            async loadProduction(name) {
                this.currentProduction = name;
                
                // Try to load from Firebase Realtime Database first (skip in demo mode)
                if (Auth.user && !Auth.isDemoMode) {
                    try {
                        const dbRef = window.firebaseRef(window.firebaseDb, `users/${Auth.user.uid}/productions/${name}`);
                        const snapshot = await window.firebaseGet(dbRef);
                        if (snapshot.exists()) {
                            this.data = snapshot.val();
                            this.log(`Loaded "${name}" from cloud`);
                            return;
                        }
                    } catch (e) {
                        console.warn('Firebase load failed, using localStorage:', e);
                    }
                }
                
                // Fall back to localStorage
                const stored = localStorage.getItem('dc_alacrity_prod_' + name);
                this.data = stored ? JSON.parse(stored) : this.getDefaultData();
                
                // Ensure productions list includes this one
                this.createProduction(name);
            },

            async loadBizData() {
                if (Auth.user && !Auth.isDemoMode) {
                    try {
                        const dbRef = window.firebaseRef(window.firebaseDb, `users/${Auth.user.uid}/business/crm`);
                        const snapshot = await window.firebaseGet(dbRef);
                        if (snapshot.exists()) {
                            this.bizData = snapshot.val();
                            return;
                        }
                    } catch (e) {
                        console.warn('Firebase biz load failed:', e);
                    }
                }
                
                const stored = localStorage.getItem('dc_alacrity_biz');
                this.bizData = stored ? JSON.parse(stored) : { leads: [], ledger: [] };
            },

            getDefaultData() {
                return {
                    days: [],
                    tech: [],
                    vault: [],
                    schedule: { strips: [] },
                    breakdowns: [],
                    cast: {},
                    crew: {},
                    crm: { leads: [], ledger: [] },
                    gantt: { production: [], global: [] },
                    notes: ''
                };
            },

            getDefaultBreakdown() {
                return {
                    sheet: '1',
                    pages: '1',
                    date: new Date().toLocaleDateString(),
                    project: this.currentProduction,
                    scene: '1',
                    intext: 'INT',
                    daynight: 'DAY',
                    location: '',
                    description: '',
                    elements: {}
                };
            },

            save() {
                // Save to localStorage immediately
                localStorage.setItem('dc_alacrity_prod_' + this.currentProduction, JSON.stringify(this.data));
                
                // Debounce cloud sync
                clearTimeout(this.syncTimeout);
                this.syncTimeout = setTimeout(() => this.syncToCloud(), 2000);
                
                this.updateSyncStatus('saving');
            },

            saveBizData() {
                localStorage.setItem('dc_alacrity_biz', JSON.stringify(this.bizData));
                
                clearTimeout(this.syncTimeout);
                this.syncTimeout = setTimeout(() => this.syncBizToCloud(), 2000);
            },

            async syncToCloud() {
                if (!Auth.user || Auth.isDemoMode) return;
                
                try {
                    const dbRef = window.firebaseRef(window.firebaseDb, `users/${Auth.user.uid}/productions/${this.currentProduction}`);
                    await window.firebaseSet(dbRef, this.data);
                    this.updateSyncStatus('synced');
                    this.log('Synced to cloud');
                } catch (e) {
                    console.error('Sync failed:', e);
                    this.updateSyncStatus('error');
                }
            },

            async syncBizToCloud() {
                if (!Auth.user || Auth.isDemoMode) return;
                
                try {
                    const dbRef = window.firebaseRef(window.firebaseDb, `users/${Auth.user.uid}/business/crm`);
                    await window.firebaseSet(dbRef, this.bizData);
                } catch (e) {
                    console.error('Biz sync failed:', e);
                }
            },

            setupRealtimeSync() {
                if (!Auth.user || Auth.isDemoMode) return;
                
                // Listen for changes to current production using Realtime Database
                const dbRef = window.firebaseRef(window.firebaseDb, `users/${Auth.user.uid}/productions/${this.currentProduction}`);
                Auth.unsubscribe = window.firebaseOnValue(dbRef, (snapshot) => {
                    if (snapshot.exists()) {
                        this.data = snapshot.val();
                        this.renderAll();
                    }
                });
            },

            updateSyncStatus(status) {
                const pill = document.getElementById('sync-status');
                const modeSyncStatus = document.getElementById('mode-sync-status');
                const text = document.getElementById('sync-text');
                const dot = pill ? pill.querySelector('.dot') : null;
                
                switch(status) {
                    case 'saving':
                        if (text) text.textContent = 'SAVING...';
                        if (modeSyncStatus) modeSyncStatus.textContent = Auth.isDemoMode ? 'Saving locally...' : 'Syncing to cloud...';
                        if (pill) pill.classList.add('warning');
                        break;
                    case 'synced':
                        if (text) text.textContent = 'SYNCED';
                        if (modeSyncStatus) modeSyncStatus.textContent = Auth.isDemoMode ? 'Saved locally' : 'Synced to cloud';
                        if (pill) pill.classList.remove('warning');
                        break;
                    case 'error':
                        if (text) text.textContent = 'SYNC ERROR';
                        if (modeSyncStatus) modeSyncStatus.textContent = 'Sync failed - saved locally';
                        if (pill) pill.classList.add('warning');
                        break;
                }
            },

            renderProductionDropdown() {
                const select = document.getElementById('project-select');
                const productions = this.getProductions();
                select.innerHTML = productions.map(p => 
                    `<option value="${p}" ${p === this.currentProduction ? 'selected' : ''}>${p}</option>`
                ).join('');
            },

            renderAll() {
                this.renderDashboard();
                Days.render();
                Tech.render();
                Vault.render();
                Schedule.render();
                Breakdown.render();
                CastCrew.render();
                ProdCRM.renderPipeline();
                ProdCRM.renderDialer();
                ProdCRM.renderIntel();
                BizCRM.renderPipeline();
                BizCRM.renderDialer();
                BizCRM.renderIntel();
                Gantt.render();
                Calendar.render();
                Notes.load();
            },

            renderDashboard() {
                document.getElementById('stat-days').textContent = (this.data.days || []).length;
                document.getElementById('stat-tech').textContent = (this.data.tech || []).length;
                document.getElementById('stat-vault').textContent = (this.data.vault || []).length;
                
                // Budget stats
                const totalBudget = parseFloat(this.data.budget?.total || 0);
                const categories = this.data.budget?.categories || [];
                let totalSpent = 0;
                categories.forEach(cat => {
                    totalSpent += parseFloat(cat.spent || 0);
                });
                const budgetLeft = totalBudget - totalSpent;
                document.getElementById('stat-budget').textContent = '$' + budgetLeft.toLocaleString();
                document.getElementById('hot-budget').textContent = '$' + totalBudget.toLocaleString();
                document.getElementById('hot-spent').textContent = '$' + totalSpent.toLocaleString();
                document.getElementById('hot-payroll').textContent = '$0'; // Placeholder
                
                // Production CRM pipeline value
                const prodLeads = this.data.crm?.leads || [];
                const prodPipelineValue = prodLeads.reduce((sum, lead) => sum + parseFloat(lead.value || 0), 0);
                document.getElementById('stat-prod-pipeline').textContent = '$' + prodPipelineValue.toLocaleString();
                
                // Business CRM stats (global)
                const bizLeads = this.bizData?.leads || [];
                const bizPipelineValue = bizLeads.reduce((sum, lead) => sum + parseFloat(lead.value || 0), 0);
                const bizRevenue = this.bizData?.income?.reduce((sum, inc) => sum + parseFloat(inc.amount || 0), 0) || 0;
                document.getElementById('biz-pipeline-value').textContent = '$' + bizPipelineValue.toLocaleString();
                document.getElementById('biz-revenue-value').textContent = '$' + bizRevenue.toLocaleString();
                document.getElementById('biz-leads-count').textContent = bizLeads.length;
            },

            navigate(viewId) {
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                const navItem = document.querySelector(`.nav-item[onclick*="${viewId}"]`);
                if (navItem) navItem.classList.add('active');
                
                // Update page title
                const titles = {
                    'dashboard': 'DASHBOARD',
                    'calendar': 'CALENDAR',
                    'schedule': 'SHOOTING SCHEDULE',
                    'breakdown': 'BREAKDOWN SHEETS',
                    'cast-crew': 'CAST & CREW',
                    'days': 'SHOOT DAYS',
                    'tech': 'EQUIPMENT',
                    'vault': 'MEDIA VAULT',
                    'documents': 'PRODUCTION DOCUMENTS',
                    'gantt': 'GANTT CHARTS',
                    'prod-pipeline': 'PRODUCTION CRM - PIPELINE',
                    'prod-dialer': 'PRODUCTION CRM - DIALER',
                    'prod-intel': 'PRODUCTION CRM - INTEL',
                    'biz-pipeline': 'BUSINESS CRM - PIPELINE',
                    'biz-dialer': 'BUSINESS CRM - DIALER',
                    'biz-intel': 'BUSINESS CRM - INTEL',
                    'script-import': 'SCRIPT IMPORT',
                    'weather': 'WEATHER',
                    'notes': 'PRODUCTION NOTES'
                };
                document.getElementById('page-title').textContent = titles[viewId] || viewId.toUpperCase();
                
                // Update view indicator (Global vs Production)
                const viewIndicator = document.getElementById('view-indicator');
                if (viewIndicator) {
                    if (viewId.startsWith('biz-')) {
                        viewIndicator.className = 'view-indicator global';
                        viewIndicator.textContent = '🌐 GLOBAL BUSINESS';
                    } else {
                        viewIndicator.className = 'view-indicator production';
                        viewIndicator.textContent = '🎬 ' + (this.currentProduction || 'PRODUCTION');
                    }
                }
                
                // Show/hide views
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                const view = document.getElementById('view-' + viewId);
                if (view) view.classList.add('active');
            },

            log(message) {
                const time = new Date().toLocaleTimeString('en-US', { hour12: false });
                this.activityLog.unshift({ time, message });
                if (this.activityLog.length > 50) this.activityLog.pop();
                
                const container = document.getElementById('activity-log');
                if (container) {
                    container.innerHTML = this.activityLog.slice(0, 10).map(entry => `
                        <div class="log-entry">
                            <span class="log-time">${entry.time}</span>
                            <span class="log-msg">${entry.message}</span>
                        </div>
                    `).join('');
                }
            },

            download(content, filename) {
                const blob = new Blob([content], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }
        };


        /* ═══════════════════════════════════════════════════════════════════════
           PRODUCTIONS MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Productions = {
            load() {
                const select = document.getElementById('project-select');
                Core.loadProduction(select.value);
                Core.renderAll();
            },
            showNew() {
                document.getElementById('modal-new-production').classList.add('active');
                document.getElementById('new-production-name').value = '';
                document.getElementById('new-production-name').focus();
            },
            hideModal() {
                document.getElementById('modal-new-production').classList.remove('active');
            },
            create() {
                const name = document.getElementById('new-production-name').value.trim();
                if (!name) { alert('Please enter a production name'); return; }
                const productions = Core.getProductions();
                if (productions.includes(name)) { alert('Production already exists'); return; }
                Core.createProduction(name);
                Core.loadProduction(name);
                Core.renderProductionDropdown();
                Core.renderAll();
                this.hideModal();
                Core.log(`Created production: ${name}`);
            },
            rename() {
                const newName = prompt('Enter new name:', Core.currentProduction);
                if (!newName || newName === Core.currentProduction) return;
                const productions = Core.getProductions();
                if (productions.includes(newName)) { alert('Production already exists'); return; }
                
                const data = localStorage.getItem('dc_alacrity_prod_' + Core.currentProduction);
                localStorage.setItem('dc_alacrity_prod_' + newName, data);
                localStorage.removeItem('dc_alacrity_prod_' + Core.currentProduction);
                
                const idx = productions.indexOf(Core.currentProduction);
                productions[idx] = newName;
                localStorage.setItem('dc_alacrity_productions', JSON.stringify(productions));
                
                Core.currentProduction = newName;
                Core.renderProductionDropdown();
                Core.log(`Renamed production to: ${newName}`);
            },
            delete() {
                const productions = Core.getProductions();
                if (productions.length <= 1) { alert('Cannot delete the only production'); return; }
                if (!confirm(`Delete "${Core.currentProduction}"? This cannot be undone.`)) return;
                
                localStorage.removeItem('dc_alacrity_prod_' + Core.currentProduction);
                const idx = productions.indexOf(Core.currentProduction);
                productions.splice(idx, 1);
                localStorage.setItem('dc_alacrity_productions', JSON.stringify(productions));
                
                Core.loadProduction(productions[0]);
                Core.renderProductionDropdown();
                Core.renderAll();
                Core.log('Production deleted');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           DAYS MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Days = {
            add() {
                const date = document.getElementById('day-date').value;
                const call = document.getElementById('day-call').value;
                const wrap = document.getElementById('day-wrap').value;
                const location = document.getElementById('day-location').value;
                const notes = document.getElementById('day-notes').value;
                if (!date) { alert('Date is required'); return; }
                Core.data.days.unshift({ id: Date.now(), date, call, wrap, location, notes });
                Core.save();
                Core.log(`Shoot day added: ${date}`);
                this.render();
                Core.renderDashboard();
                document.getElementById('day-date').value = '';
                document.getElementById('day-location').value = '';
                document.getElementById('day-notes').value = '';
            },
            delete(id) {
                if (confirm('Delete this shoot day?')) {
                    Core.data.days = Core.data.days.filter(d => d.id !== id);
                    Core.save();
                    this.render();
                    Core.renderDashboard();
                    Core.log('Shoot day deleted');
                }
            },
            render() {
                const tbody = document.getElementById('table-days');
                if (!Core.data.days?.length) {
                    tbody.innerHTML = '<tr><td colspan="6" class="table-empty">No shoot days scheduled</td></tr>';
                    return;
                }
                tbody.innerHTML = Core.data.days.map(d => `
                    <tr>
                        <td class="font-mono font-bold">${d.date}</td>
                        <td class="font-mono">${d.call || '-'}</td>
                        <td class="font-mono">${d.wrap || '-'}</td>
                        <td>${d.location || '-'}</td>
                        <td class="text-muted">${d.notes || '-'}</td>
                        <td><button class="delete-btn" onclick="Days.delete(${d.id})">×</button></td>
                    </tr>
                `).join('');
            },
            exportCSV() {
                let csv = 'Date,Call,Wrap,Location,Notes\n';
                Core.data.days.forEach(d => csv += `"${d.date}","${d.call}","${d.wrap}","${d.location}","${d.notes}"\n`);
                Core.download(csv, 'shoot_days.csv');
                Core.log('Shoot days exported');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           TECH MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Tech = {
            add() {
                const name = document.getElementById('tech-name').value;
                const category = document.getElementById('tech-category').value;
                const serial = document.getElementById('tech-serial').value;
                const owner = document.getElementById('tech-owner').value;
                if (!name) { alert('Item name is required'); return; }
                Core.data.tech.unshift({ id: Date.now(), name, category, serial, owner, status: 'Available' });
                Core.save();
                Core.log(`Equipment added: ${name}`);
                this.render();
                Core.renderDashboard();
                document.getElementById('tech-name').value = '';
                document.getElementById('tech-serial').value = '';
            },
            delete(id) {
                if (confirm('Delete this equipment?')) {
                    Core.data.tech = Core.data.tech.filter(t => t.id !== id);
                    Core.save();
                    this.render();
                    Core.renderDashboard();
                    Core.log('Equipment deleted');
                }
            },
            render() {
                const tbody = document.getElementById('table-tech');
                if (!Core.data.tech?.length) {
                    tbody.innerHTML = '<tr><td colspan="6" class="table-empty">No equipment logged</td></tr>';
                    return;
                }
                tbody.innerHTML = Core.data.tech.map(t => `
                    <tr>
                        <td class="font-bold">${t.name}</td>
                        <td><span class="tag tag-cyan">${t.category}</span></td>
                        <td class="font-mono">${t.serial || '-'}</td>
                        <td>${t.owner}</td>
                        <td><span class="tag tag-emerald">${t.status}</span></td>
                        <td><button class="delete-btn" onclick="Tech.delete(${t.id})">×</button></td>
                    </tr>
                `).join('');
            },
            exportCSV() {
                let csv = 'Name,Category,Serial,Owner,Status\n';
                Core.data.tech.forEach(t => csv += `"${t.name}","${t.category}","${t.serial}","${t.owner}","${t.status}"\n`);
                Core.download(csv, 'tech_inventory.csv');
                Core.log('Tech inventory exported');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           VAULT MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Vault = {
            add() {
                const filename = document.getElementById('vault-filename').value;
                const scene = document.getElementById('vault-scene').value;
                const camera = document.getElementById('vault-camera').value;
                const storage = document.getElementById('vault-storage').value;
                const notes = document.getElementById('vault-notes').value;
                if (!filename) { alert('Filename is required'); return; }
                Core.data.vault.unshift({ id: Date.now(), filename, scene, camera, storage, notes });
                Core.save();
                Core.log(`Asset logged: ${filename}`);
                this.render();
                Core.renderDashboard();
                document.getElementById('vault-filename').value = '';
                document.getElementById('vault-scene').value = '';
                document.getElementById('vault-camera').value = '';
                document.getElementById('vault-storage').value = '';
                document.getElementById('vault-notes').value = '';
            },
            delete(id) {
                if (confirm('Delete this asset?')) {
                    Core.data.vault = Core.data.vault.filter(v => v.id !== id);
                    Core.save();
                    this.render();
                    Core.renderDashboard();
                    Core.log('Asset deleted');
                }
            },
            render() {
                const tbody = document.getElementById('table-vault');
                if (!Core.data.vault?.length) {
                    tbody.innerHTML = '<tr><td colspan="6" class="table-empty">No media assets logged</td></tr>';
                    return;
                }
                tbody.innerHTML = Core.data.vault.map(v => `
                    <tr>
                        <td class="font-mono font-bold">${v.filename}</td>
                        <td>${v.scene || '-'}</td>
                        <td>${v.camera || '-'}</td>
                        <td><span class="tag tag-violet">${v.storage || '-'}</span></td>
                        <td class="text-muted">${v.notes || '-'}</td>
                        <td><button class="delete-btn" onclick="Vault.delete(${v.id})">×</button></td>
                    </tr>
                `).join('');
            },
            exportCSV() {
                let csv = 'Filename,Scene,Camera,Storage,Notes\n';
                Core.data.vault.forEach(v => csv += `"${v.filename}","${v.scene}","${v.camera}","${v.storage}","${v.notes}"\n`);
                Core.download(csv, 'media_vault.csv');
                Core.log('Media vault exported');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           CAST & CREW MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const CastCrew = {
            render() {
                if (!Core.data.cast) Core.data.cast = {};
                if (!Core.data.crew) Core.data.crew = {};
                this.renderList('cast');
                this.renderList('crew');
            },
            
            renderList(type) {
                const list = document.getElementById(`${type}-list`);
                const members = Core.data[type] || {};
                const entries = Object.entries(members).sort((a, b) => {
                    const numA = parseInt(a[1].id.replace(/\D/g, ''));
                    const numB = parseInt(b[1].id.replace(/\D/g, ''));
                    return numA - numB;
                });
                
                if (entries.length === 0) {
                    list.innerHTML = `<p class="text-muted">No ${type} members yet</p>`;
                    return;
                }
                
                list.innerHTML = entries.map(([key, member]) => `
                    <div style="background: var(--surface-3); padding: var(--space-md); border-radius: 6px; margin-bottom: var(--space-sm); display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-xs);">
                                <span style="background: var(--neon-cyan); color: var(--void-pure); padding: 2px 8px; border-radius: 4px; font-family: var(--font-mono); font-size: 10px; font-weight: 700;">${member.id}</span>
                                <span style="font-weight: 700; color: var(--text-100);">${member.name}</span>
                            </div>
                            <div style="font-size: 12px; color: var(--text-50);">${member.role || member.position || 'No role specified'}</div>
                            ${member.phone ? `<div style="font-size: 11px; color: var(--text-50); font-family: var(--font-mono);">${member.phone}</div>` : ''}
                            ${member.email ? `<div style="font-size: 11px; color: var(--neon-cyan);">${member.email}</div>` : ''}
                        </div>
                        <div style="display: flex; gap: var(--space-xs);">
                            <button class="btn btn-sm" onclick="CastCrew.edit('${type}', '${key}')">✎</button>
                            <button class="delete-btn" onclick="CastCrew.remove('${type}', '${key}')">×</button>
                        </div>
                    </div>
                `).join('');
            },

            syncFromImport(names) {
                if (!Core.data.cast) Core.data.cast = {};
                let addedCount = 0;
                
                const existingNames = Object.values(Core.data.cast).map(m => m.name.toLowerCase());
                
                const existingIds = Object.values(Core.data.cast).map(m => {
                    const num = parseInt(m.id.replace(/\D/g, ''));
                    return isNaN(num) ? 0 : num;
                });
                let nextNum = existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1;

                names.forEach(name => {
                    const cleanName = name.trim();
                    if (cleanName && !existingNames.includes(cleanName.toLowerCase())) {
                        const id = 'C' + nextNum.toString().padStart(3, '0');
                        const key = Date.now().toString() + Math.random().toString().slice(2, 5);
                        
                        Core.data.cast[key] = {
                            id,
                            name: cleanName,
                            role: 'Script Character' 
                        };
                        existingNames.push(cleanName.toLowerCase());
                        nextNum++;
                        addedCount++;
                    }
                });
                
                if (addedCount > 0) {
                    Core.save();
                    this.render();
                    Core.log(`Imported ${addedCount} new cast members from script`);
                }
            },

            getCastOptionsHTML() {
                if (!Core.data.cast) return '';
                return Object.values(Core.data.cast)
                    .sort((a, b) => a.name.localeCompare(b.name))
                    .map(c => `<option value="${c.name}">${c.id}</option>`)
                    .join('');
            },
            
            addMember(type) {
                const name = prompt(`Enter ${type} member name:`);
                if (!name) return;
                
                const existing = Object.values(Core.data[type] || {});
                if (existing.some(m => m.name.toLowerCase() === name.toLowerCase())) {
                    alert(`A ${type} member named "${name}" already exists!`);
                    return;
                }
                
                const roleLabel = type === 'cast' ? 'Enter character/role:' : 'Enter position/department:';
                const role = prompt(roleLabel);
                
                const phone = prompt('Enter phone number (optional):');
                const email = prompt('Enter email (optional):');
                
                const existingIds = Object.values(Core.data[type] || {}).map(m => {
                    const num = parseInt(m.id.replace(/\D/g, ''));
                    return isNaN(num) ? 0 : num;
                });
                const nextNum = existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1;
                const prefix = type === 'cast' ? 'C' : 'CR';
                const id = prefix + nextNum.toString().padStart(3, '0');
                
                const key = Date.now().toString();
                if (!Core.data[type]) Core.data[type] = {};
                
                Core.data[type][key] = {
                    id,
                    name,
                    [type === 'cast' ? 'role' : 'position']: role,
                    phone: phone || '',
                    email: email || ''
                };
                
                Core.save();
                this.render();
                Core.log(`Added ${type}: ${name} (${id})`);
            },

            edit(type, key) {
                const member = Core.data[type][key];
                if (!member) return;
                
                const name = prompt('Edit name:', member.name);
                if (!name) return;
                
                const roleLabel = type === 'cast' ? 'Edit character/role:' : 'Edit position/department:';
                const role = prompt(roleLabel, member.role || member.position || '');
                const phone = prompt('Edit phone:', member.phone || '');
                const email = prompt('Edit email:', member.email || '');
                
                member.name = name;
                member[type === 'cast' ? 'role' : 'position'] = role;
                member.phone = phone;
                member.email = email;
                
                Core.save();
                this.render();
                Core.log(`Updated ${type}: ${name}`);
            },
            
            remove(type, key) {
                if (confirm(`Remove this ${type} member?`)) {
                    delete Core.data[type][key];
                    Core.save();
                    this.render();
                }
            },
            
            findByName(name) {
                const cast = Core.data.cast || {};
                for (let [key, member] of Object.entries(cast)) {
                    if (member.name.toLowerCase() === name.toLowerCase()) {
                        return member;
                    }
                }
                return null;
            },
            
            findById(id) {
                const cast = Core.data.cast || {};
                for (let [key, member] of Object.entries(cast)) {
                    if (member.id === id) {
                        return member;
                    }
                }
                return null;
            },
            
            getCastList() {
                return Object.values(Core.data.cast || {}).sort((a, b) => {
                    const numA = parseInt(a.id.replace(/\D/g, ''));
                    const numB = parseInt(b.id.replace(/\D/g, ''));
                    return numA - numB;
                });
            },
            
            parseCastString(castStr) {
                if (!castStr) return [];
                const parts = castStr.split(',').map(s => s.trim()).filter(s => s);
                const result = [];
                
                for (let part of parts) {
                    if (/^C\d{3}$/.test(part)) {
                        const member = this.findById(part);
                        if (member) {
                            result.push({ id: member.id, name: member.name });
                        }
                    } else {
                        const member = this.findByName(part);
                        if (member) {
                            result.push({ id: member.id, name: member.name });
                        } else {
                            result.push({ id: null, name: part });
                        }
                    }
                }
                return result;
            },
            
            formatCastForDisplay(castArray) {
                return castArray.map(c => c.id || c.name).join(', ');
            }
        };


        /* ═══════════════════════════════════════════════════════════════════════
           SCHEDULE MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Schedule = {
            draggedIndex: null,

            render() {
                if (!Core.data.schedule) Core.data.schedule = { strips: [] };
                const container = document.getElementById('stripboard');
                
                if (Core.data.schedule.strips.length === 0) {
                    container.innerHTML = '<div class="text-muted" style="text-align: center; padding: var(--space-2xl);">No scenes in schedule. Add scenes or import a script.</div>';
                    return;
                }

                container.innerHTML = Core.data.schedule.strips.map((strip, index) => {
                    if (strip.type === 'daybreak') {
                        return `
                            <div class="strip daybreak" style="padding: var(--space-md); text-align: center;">
                                <strong>END OF DAY ${strip.dayNumber}</strong> — ${strip.scenes || 0} scenes, ${strip.totalPages || 0} pages
                                <span style="margin-left: var(--space-md); cursor: pointer;" onclick="Schedule.deleteStrip(${index})">×</span>
                            </div>
                        `;
                    } else if (strip.type === 'banner') {
                        return `
                            <div class="strip banner" style="padding: var(--space-md);">
                                <span style="flex: 1;">${strip.text}</span>
                                ${strip.duration ? `<span class="font-mono">${strip.duration} min</span>` : ''}
                                <span style="cursor: pointer; margin-left: var(--space-md);" onclick="Schedule.deleteStrip(${index})">×</span>
                            </div>
                        `;
                    } else {
                        const colorClass = this.getStripColorClass(strip.intext, strip.daynight);
                        const hasBreakdown = strip.elements && Object.keys(strip.elements).some(key => strip.elements[key]?.length > 0);
                        const isExpanded = strip.expanded || false;
                        
                        let breakdownHTML = '';
                        if (hasBreakdown && isExpanded) {
                            breakdownHTML = '<div class="strip-breakdown">';
                            BREAKDOWN_CATEGORIES.forEach(cat => {
                                const items = strip.elements?.[cat.id] || [];
                                if (items.length > 0) {
                                    breakdownHTML += `
                                        <div class="strip-breakdown-category">
                                            <div class="strip-breakdown-label">${cat.icon} ${cat.name}</div>
                                            <div class="strip-breakdown-items">${items.join(', ')}</div>
                                        </div>
                                    `;
                                }
                            });
                            breakdownHTML += '</div>';
                        }
                        
                        return `
                            <div class="strip ${colorClass} ${isExpanded ? 'expanded' : ''}" draggable="true" ondragstart="Schedule.dragStart(event, ${index})" ondragover="Schedule.allowDrop(event)" ondrop="Schedule.drop(event, ${index})">
                                <div class="strip-main">
                                    <div class="strip-scene">${strip.scene || '?'}</div>
                                    <div class="strip-intext">${strip.intext || 'INT'}</div>
                                    <div class="strip-daynight">${strip.daynight || 'DAY'}</div>
                                    <div class="strip-location">${strip.location || 'LOCATION TBD'}</div>
                                    <div class="strip-description">${strip.description || ''}</div>
                                    <div class="strip-cast">
                                        ${strip.cast ? strip.cast.split(',').map(id => {
                                            const castId = id.trim();
                                            return `<span class="cast-badge" onclick="event.stopPropagation(); Schedule.showCastInfo('${castId}')" title="Click for info">${castId}</span>`;
                                        }).join('') : '<span style="opacity: 0.5;">No cast</span>'}
                                    </div>
                                    <div class="strip-pages">${strip.pages || '0'}</div>
                                    <div class="strip-actions">
                                        ${hasBreakdown ? `<div class="strip-handle" onclick="event.stopPropagation(); Schedule.toggleExpand(${index})" title="Show breakdown">${isExpanded ? '▼' : '▶'}</div>` : ''}
                                        <div class="strip-handle" onclick="event.stopPropagation(); Schedule.editScene(${index})" title="Edit">✎</div>
                                        <div class="strip-handle" onclick="event.stopPropagation(); Schedule.deleteStrip(${index})" title="Delete">×</div>
                                    </div>
                                </div>
                                ${breakdownHTML}
                            </div>
                        `;
                    }
                }).join('');

                this.updateStats();
            },

            getStripColorClass(intext, daynight) {
                const int = (intext || 'INT').includes('INT');
                const day = (daynight || 'DAY').includes('DAY') || (daynight || 'DAY').includes('DAWN');
                if (day && int) return 'day-int';
                if (day && !int) return 'day-ext';
                if (!day && int) return 'night-int';
                return 'night-ext';
            },

            updateStats() {
                const strips = Core.data.schedule?.strips || [];
                const scenes = strips.filter(s => s.type === 'scene');
                const totalPages = scenes.reduce((sum, s) => {
                    const pages = this.parsePages(s.pages);
                    return sum + pages;
                }, 0);
                document.getElementById('schedule-total-pages').textContent = totalPages.toFixed(2) + ' pages';
            },

            parsePages(pageStr) {
                if (!pageStr) return 0;
                const parts = pageStr.toString().trim().split(/\s+/);
                let total = 0;
                for (const part of parts) {
                    if (part.includes('/')) {
                        const [num, denom] = part.split('/').map(Number);
                        total += num / denom;
                    } else {
                        total += Number(part) || 0;
                    }
                }
                return total;
            },

            dragStart(e, index) {
                this.draggedIndex = index;
                e.target.classList.add('dragging');
            },

            allowDrop(e) {
                e.preventDefault();
            },

            drop(e, targetIndex) {
                e.preventDefault();
                if (this.draggedIndex === null || this.draggedIndex === targetIndex) return;

                const strips = Core.data.schedule.strips;
                const draggedStrip = strips[this.draggedIndex];
                
                strips.splice(this.draggedIndex, 1);
                
                const newIndex = this.draggedIndex < targetIndex ? targetIndex - 1 : targetIndex;
                strips.splice(newIndex, 0, draggedStrip);
                
                this.draggedIndex = null;
                Core.save();
                this.render();
                Core.log('Strip reordered');
            },

            toggleExpand(index) {
                const strip = Core.data.schedule.strips[index];
                strip.expanded = !strip.expanded;
                Core.save();
                this.render();
            },

            showCastInfo(castId) {
                const member = CastCrew.findById(castId) || CastCrew.findByName(castId);
                const content = document.getElementById('cast-info-content');
                
                if (member) {
                    content.innerHTML = `
                        <div style="text-align: center; margin-bottom: var(--space-lg);">
                            <div style="font-size: 48px; margin-bottom: var(--space-sm);">👤</div>
                            <div style="font-family: var(--font-mono); background: var(--neon-cyan); color: var(--void-pure); padding: 4px 12px; border-radius: 4px; display: inline-block; margin-bottom: var(--space-sm);">${member.id}</div>
                            <div style="font-size: 20px; font-weight: 700;">${member.name}</div>
                            <div style="color: var(--text-50);">${member.role || 'No role specified'}</div>
                        </div>
                        ${member.phone ? `<div style="margin-bottom: var(--space-sm);"><strong>Phone:</strong> <a href="tel:${member.phone}" style="color: var(--neon-cyan);">${member.phone}</a></div>` : ''}
                        ${member.email ? `<div><strong>Email:</strong> <a href="mailto:${member.email}" style="color: var(--neon-cyan);">${member.email}</a></div>` : ''}
                    `;
                } else {
                    content.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: var(--space-sm);">❓</div>
                            <div style="font-size: 20px; font-weight: 700;">${castId}</div>
                            <div style="color: var(--text-50);">Not in cast database</div>
                        </div>
                    `;
                }
                
                document.getElementById('modal-cast-info').classList.add('active');
            },

            hideCastInfo() {
                document.getElementById('modal-cast-info').classList.remove('active');
            },

            addScene() {
                document.getElementById('modal-scene').classList.add('active');
                document.getElementById('scene-modal-title').textContent = 'Add Scene';
                document.getElementById('scene-id').value = '';
                document.getElementById('scene-number').value = '';
                document.getElementById('scene-intext').value = 'INT';
                document.getElementById('scene-daynight').value = 'DAY';
                document.getElementById('scene-location').value = '';
                document.getElementById('scene-shoot-location').value = '';
                document.getElementById('scene-description').value = '';
                document.getElementById('scene-cast').value = '';
                document.getElementById('scene-pages').value = '';
            },

            editScene(index) {
                const strip = Core.data.schedule.strips[index];
                document.getElementById('modal-scene').classList.add('active');
                document.getElementById('scene-modal-title').textContent = 'Edit Scene';
                document.getElementById('scene-id').value = index;
                document.getElementById('scene-number').value = strip.scene || '';
                document.getElementById('scene-intext').value = strip.intext || 'INT';
                document.getElementById('scene-daynight').value = strip.daynight || 'DAY';
                document.getElementById('scene-location').value = strip.location || '';
                document.getElementById('scene-shoot-location').value = strip.shootLocation || '';
                document.getElementById('scene-description').value = strip.description || '';
                document.getElementById('scene-cast').value = strip.cast || '';
                document.getElementById('scene-pages').value = strip.pages || '';
            },

            saveScene() {
                const sceneIndex = document.getElementById('scene-id').value;
                const sceneData = {
                    type: 'scene',
                    scene: document.getElementById('scene-number').value.trim(),
                    intext: document.getElementById('scene-intext').value,
                    daynight: document.getElementById('scene-daynight').value,
                    location: document.getElementById('scene-location').value.trim(),
                    shootLocation: document.getElementById('scene-shoot-location').value.trim(),
                    description: document.getElementById('scene-description').value.trim(),
                    cast: document.getElementById('scene-cast').value.trim(),
                    pages: document.getElementById('scene-pages').value.trim()
                };

                if (!sceneData.scene) {
                    alert('Scene number is required');
                    return;
                }

                if (sceneData.cast) {
                    const parsedCast = CastCrew.parseCastString(sceneData.cast);
                    sceneData.cast = CastCrew.formatCastForDisplay(parsedCast);
                }

                if (!Core.data.schedule) Core.data.schedule = { strips: [] };
                
                if (sceneIndex !== '') {
                    const index = parseInt(sceneIndex);
                    Core.data.schedule.strips[index] = { ...Core.data.schedule.strips[index], ...sceneData };
                    Core.log(`Scene ${sceneData.scene} updated`);
                } else {
                    Core.data.schedule.strips.push(sceneData);
                    Core.log(`Scene ${sceneData.scene} added to schedule`);
                }
                
                Core.save();
                this.hideModals();
                this.render();
            },

            addDayBreak() {
                if (!Core.data.schedule) Core.data.schedule = { strips: [] };
                
                const dayBreaks = Core.data.schedule.strips.filter(s => s.type === 'daybreak');
                const dayNumber = dayBreaks.length + 1;
                
                let scenesSinceLastBreak = 0;
                let pagesSinceLastBreak = 0;
                for (let i = Core.data.schedule.strips.length - 1; i >= 0; i--) {
                    const strip = Core.data.schedule.strips[i];
                    if (strip.type === 'daybreak') break;
                    if (strip.type === 'scene') {
                        scenesSinceLastBreak++;
                        pagesSinceLastBreak += this.parsePages(strip.pages);
                    }
                }

                Core.data.schedule.strips.push({
                    type: 'daybreak',
                    dayNumber: dayNumber,
                    date: new Date().toLocaleDateString(),
                    scenes: scenesSinceLastBreak,
                    totalPages: pagesSinceLastBreak.toFixed(2)
                });
                
                Core.save();
                this.render();
                Core.log(`Day break added: Day ${dayNumber}`);
            },

            addBanner() {
                document.getElementById('modal-banner').classList.add('active');
                document.getElementById('banner-type').value = 'COMPANY MOVE';
                document.getElementById('banner-custom').value = '';
                document.getElementById('banner-time').value = '30';
                document.getElementById('banner-custom-group').classList.add('hidden');
            },

            toggleCustomBanner() {
                const type = document.getElementById('banner-type').value;
                const customGroup = document.getElementById('banner-custom-group');
                if (type === 'Custom') {
                    customGroup.classList.remove('hidden');
                } else {
                    customGroup.classList.add('hidden');
                }
            },

            saveBanner() {
                let text = document.getElementById('banner-type').value;
                if (text === 'Custom') {
                    text = document.getElementById('banner-custom').value.trim() || 'CUSTOM';
                }
                const duration = document.getElementById('banner-time').value;

                if (!Core.data.schedule) Core.data.schedule = { strips: [] };
                Core.data.schedule.strips.push({
                    type: 'banner',
                    text: text,
                    duration: duration
                });
                
                Core.save();
                this.hideModals();
                this.render();
                Core.log(`Banner added: ${text}`);
            },

            deleteStrip(index) {
                if (confirm('Delete this strip?')) {
                    Core.data.schedule.strips.splice(index, 1);
                    Core.save();
                    this.render();
                    Core.log('Strip deleted');
                }
            },

            editCast(index) {
                const strip = Core.data.schedule.strips[index];
                const newCast = prompt('Edit cast (comma separated):', strip.cast || '');
                if (newCast !== null) {
                    strip.cast = newCast;
                    Core.save();
                    this.render();
                }
            },

            hideModals() {
                document.getElementById('modal-scene').classList.remove('active');
                document.getElementById('modal-banner').classList.remove('active');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           BREAKDOWN MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Breakdown = {
            currentIdx: 0,

            render() {
                if (!Core.data.breakdowns) Core.data.breakdowns = [];
                if (Core.data.breakdowns.length === 0) this.createNew();

                const bd = Core.data.breakdowns[this.currentIdx];
                
                let navHtml = `
                    <div class="card mb-lg" style="background: var(--surface-3); border-color: var(--neon-cyan);">
                        <div class="card-body" style="display: flex; justify-content: space-between; align-items: center; padding: var(--space-md);">
                            <button class="btn btn-sm" onclick="Breakdown.prev()">◀ Prev Scene</button>
                            <div style="text-align: center;">
                                <div style="font-weight: bold; color: var(--neon-cyan);">SCENE ${bd.scene}</div>
                                <div style="font-size: 10px; color: var(--text-50);">Sheet ${this.currentIdx + 1} of ${Core.data.breakdowns.length}</div>
                            </div>
                            <button class="btn btn-sm" onclick="Breakdown.next()">Next Scene ▶</button>
                            <button class="btn btn-sm btn-primary" onclick="Breakdown.createNew()">+ New Sheet</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.scriptBreakdown()">📄 Export All PDF</button>
                        </div>
                    </div>
                    <datalist id="cast-autocomplete">
                        ${CastCrew.getCastOptionsHTML()}
                    </datalist>
                `;

                document.getElementById('bd-sheet').value = bd.sheet || '';
                document.getElementById('bd-pages').value = bd.pages || '';
                document.getElementById('bd-date').value = bd.date || '';
                document.getElementById('bd-project').value = bd.project || '';
                document.getElementById('bd-scene').value = bd.scene || '';
                document.getElementById('bd-intext').value = bd.intext || 'INT';
                document.getElementById('bd-daynight').value = bd.daynight || 'DAY';
                document.getElementById('bd-location').value = bd.location || '';
                document.getElementById('bd-description').value = bd.description || '';

                const catContainer = document.getElementById('breakdown-categories');
                catContainer.innerHTML = BREAKDOWN_CATEGORIES.map(cat => {
                    const listAttr = cat.id === 'cast' ? 'list="cast-autocomplete"' : '';
                    
                    return `
                    <div class="breakdown-category ${cat.color}">
                        <div class="breakdown-category-header">
                            <div class="breakdown-category-title">
                                <span class="breakdown-category-icon">${cat.icon}</span>
                                <span class="breakdown-category-name">${cat.name}</span>
                            </div>
                        </div>
                        <div class="breakdown-elements" id="bd-elements-${cat.id}">
                            ${(bd.elements[cat.id] || []).map((el, i) => `
                                <div class="breakdown-element">
                                    <span>${el}</span>
                                    <button class="breakdown-element-del" onclick="Breakdown.removeElement('${cat.id}', ${i})">×</button>
                                </div>
                            `).join('')}
                        </div>
                        <div class="breakdown-add">
                            <input type="text" class="breakdown-add-input" id="bd-input-${cat.id}" ${listAttr}
                                   onkeydown="if(event.key==='Enter')Breakdown.addElement('${cat.id}')">
                            <button class="breakdown-add-btn" onclick="Breakdown.addElement('${cat.id}')">+</button>
                        </div>
                    </div>
                `}).join('');

                const navContainer = document.getElementById('bd-nav-controls');
                navContainer.innerHTML = navHtml;
            },

            createNew() {
                const newSheet = Core.getDefaultBreakdown();
                newSheet.scene = (Core.data.breakdowns.length + 1).toString();
                Core.data.breakdowns.push(newSheet);
                this.currentIdx = Core.data.breakdowns.length - 1;
                this.render();
            },

            saveCurrentState() {
                const bd = Core.data.breakdowns[this.currentIdx];
                bd.sheet = document.getElementById('bd-sheet').value;
                bd.pages = document.getElementById('bd-pages').value;
                bd.scene = document.getElementById('bd-scene').value;
                bd.intext = document.getElementById('bd-intext').value;
                bd.daynight = document.getElementById('bd-daynight').value;
                bd.location = document.getElementById('bd-location').value;
                bd.description = document.getElementById('bd-description').value;
                Core.save();
            },

            next() {
                this.saveCurrentState();
                if (this.currentIdx < Core.data.breakdowns.length - 1) {
                    this.currentIdx++;
                    this.render();
                }
            },

            prev() {
                this.saveCurrentState();
                if (this.currentIdx > 0) {
                    this.currentIdx--;
                    this.render();
                }
            },

            addElement(catId) {
                const input = document.getElementById('bd-input-' + catId);
                const val = input.value.trim();
                if (!val) return;
                
                const bd = Core.data.breakdowns[this.currentIdx];
                if (!bd.elements[catId]) bd.elements[catId] = [];
                bd.elements[catId].push(val);
                
                Core.save();
                this.render(); 
                input.value = '';
                input.focus();
            },

            removeElement(catId, elIdx) {
                const bd = Core.data.breakdowns[this.currentIdx];
                bd.elements[catId].splice(elIdx, 1);
                Core.save();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           SCRIPT IMPORT MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const ScriptImport = {
            parse(text) {
                const lines = text.split('\n');
                const scenes = [];
                let currentScene = null;
                const sceneHeaderRegex = /^(INT\.|EXT\.|INT\/EXT\.|I\/E\.)\s*(.+?)\s*[-–—]\s*(DAY|NIGHT|DAWN|DUSK|MORNING|EVENING|CONTINUOUS|LATER)/i;
                const characterRegex = /^([A-Z][A-Z\s\.]+)(\s*\(.*\))?$/;

                lines.forEach(line => {
                    const trimmed = line.trim();
                    const match = trimmed.match(sceneHeaderRegex);
                    
                    if (match) {
                        if (currentScene) scenes.push(currentScene);
                        currentScene = {
                            scene: (scenes.length + 1).toString(),
                            intext: match[1].replace('.', '').replace('/', '').includes('INT') ? 'INT' : 'EXT',
                            location: match[2].trim(),
                            daynight: match[3].toUpperCase().includes('NIGHT') ? 'NIGHT' : 
                                      match[3].toUpperCase().includes('DAWN') ? 'DAWN' :
                                      match[3].toUpperCase().includes('DUSK') ? 'DUSK' : 'DAY',
                            description: '',
                            cast: [],
                            elements: {}
                        };
                    } else if (currentScene) {
                        const charMatch = trimmed.match(characterRegex);
                        if (charMatch && trimmed.length < 40 && !trimmed.includes(':')) {
                            const name = charMatch[1].trim();
                            if (!currentScene.cast.includes(name) && 
                                !['FADE IN', 'FADE OUT', 'CUT TO', 'DISSOLVE TO', 'THE END', 'CONTINUED'].includes(name)) {
                                currentScene.cast.push(name);
                            }
                        } else if (trimmed && !currentScene.description && trimmed.length > 10) {
                            currentScene.description = trimmed.substring(0, 100);
                        }
                    }
                });
                if (currentScene) scenes.push(currentScene);
                return scenes;
            },

            preview() {
                const text = document.getElementById('script-import-text').value;
                if (!text) { alert('Please paste script text first'); return; }
                
                const scenes = this.parse(text);
                if (scenes.length === 0) {
                    alert('No scenes detected. Ensure headers match format: INT. LOCATION - DAY');
                    return;
                }
                
                let preview = `Detected ${scenes.length} scenes:\n\n`;
                scenes.slice(0, 10).forEach(s => {
                    preview += `Scene ${s.scene}: ${s.intext}. ${s.location} - ${s.daynight}\n`;
                    preview += `  Cast: ${s.cast.join(', ') || 'None detected'}\n\n`;
                });
                if (scenes.length > 10) preview += `... and ${scenes.length - 10} more scenes`;
                
                alert(preview);
            },

            run() {
                const text = document.getElementById('script-import-text').value;
                if (!text) { alert('Please paste script text first'); return; }

                const scenes = this.parse(text);
                if (scenes.length === 0) {
                    alert('No scenes detected. Ensure headers match format: INT. LOCATION - DAY');
                    return;
                }

                if (confirm(`Detected ${scenes.length} scenes. Import will overwrite current schedule/breakdowns. Proceed?`)) {
                    
                    const allCast = new Set();
                    scenes.forEach(s => s.cast.forEach(c => allCast.add(c)));
                    CastCrew.syncFromImport(Array.from(allCast));

                    Core.data.breakdowns = scenes.map(s => ({
                        sheet: s.scene,
                        pages: '1',
                        date: new Date().toLocaleDateString(),
                        project: Core.currentProduction,
                        scene: s.scene,
                        intext: s.intext,
                        daynight: s.daynight,
                        location: s.location,
                        description: s.description,
                        elements: { cast: s.cast, ...s.elements }
                    }));

                    Core.data.schedule.strips = scenes.map(s => ({
                        type: 'scene',
                        scene: s.scene,
                        intext: s.intext,
                        daynight: s.daynight,
                        location: s.location,
                        description: s.description,
                        cast: s.cast.join(', '), 
                        pages: '1',
                        elements: { cast: s.cast, ...s.elements }
                    }));

                    Core.save();
                    Schedule.render();
                    Breakdown.currentIdx = 0;
                    Breakdown.render();
                    alert("Script imported successfully! Cast members have been added to the database.");
                    Core.log(`Imported ${scenes.length} scenes from script`);
                }
            }
        };


        /* ═══════════════════════════════════════════════════════════════════════
           PRODUCTION CRM MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const ProdCRM = {
            draggedLead: null,

            renderPipeline() {
                if (!Core.data.crm) Core.data.crm = { leads: [], ledger: [] };
                const board = document.getElementById('prod-kanban-board');
                if (!board) return;
                
                board.innerHTML = CRM_STAGES.map(stage => {
                    const leads = (Core.data.crm.leads || []).filter(l => l.status === stage.id);
                    return `
                        <div class="kanban-column" data-stage="${stage.id}">
                            <div class="kanban-column-header">
                                <span class="kanban-column-title">${stage.name}</span>
                                <span class="kanban-column-count">${leads.length}</span>
                            </div>
                            <div class="kanban-column-body" ondragover="ProdCRM.allowDrop(event)" ondrop="ProdCRM.drop(event, '${stage.id}')">
                                ${leads.map(l => this.renderLeadCard(l)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            },

            renderLeadCard(lead) {
                const interestClass = {
                    'Talent': 'interest-talent',
                    'Vendor': 'interest-vendor',
                    'Sponsor': 'interest-sponsor',
                    'Investor': 'interest-investor'
                }[lead.interest] || 'interest-custom';
                
                return `
                    <div class="kanban-card ${interestClass}" draggable="true" ondragstart="ProdCRM.dragStart(event, ${lead.id})" data-id="${lead.id}">
                        <div class="kanban-card-actions">
                            <button class="kanban-card-btn call" onclick="ProdCRM.loadToDialer(${lead.id}); event.stopPropagation();" title="Load to Dialer">📞</button>
                            <button class="kanban-card-btn" onclick="ProdCRM.editLead(${lead.id}); event.stopPropagation();" title="Edit">✎</button>
                            <button class="kanban-card-btn del" onclick="ProdCRM.deleteLead(${lead.id}); event.stopPropagation();" title="Delete">×</button>
                        </div>
                        <div class="kanban-card-name">${lead.name}</div>
                        <div class="kanban-card-phone">${lead.phone || 'No phone'}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                            <span class="tag tag-${interestClass === 'interest-talent' ? 'pink' : interestClass === 'interest-vendor' ? 'cyan' : interestClass === 'interest-sponsor' ? 'gold' : interestClass === 'interest-investor' ? 'emerald' : 'violet'}">${lead.interest}</span>
                            <span class="kanban-card-value">$${Number(lead.value || 0).toLocaleString()}</span>
                        </div>
                    </div>
                `;
            },

            dragStart(e, id) {
                this.draggedLead = id;
                e.target.classList.add('dragging');
            },

            allowDrop(e) { 
                e.preventDefault(); 
            },

            drop(e, newStatus) {
                e.preventDefault();
                if (this.draggedLead) {
                    const lead = Core.data.crm.leads.find(l => l.id === this.draggedLead);
                    if (lead) {
                        lead.status = newStatus;
                        Core.save();
                        this.renderPipeline();
                        Core.log(`Contact "${lead.name}" moved to ${newStatus}`);
                    }
                }
                this.draggedLead = null;
                document.querySelectorAll('.kanban-card').forEach(card => card.classList.remove('dragging'));
            },

            loadToDialer(id) {
                Core.navigate('prod-dialer');
                // The dialer will show all contacts
            },

            renderDialer() {
                const leads = Core.data.crm?.leads || [];
                const container = document.getElementById('prod-dialer-queue');
                
                if (!container) return;
                
                if (leads.length === 0) {
                    container.innerHTML = '<div class="text-muted" style="text-align: center; padding: var(--space-2xl);">No contacts to call</div>';
                    return;
                }
                
                container.innerHTML = leads.map((lead, i) => `
                    <div style="background: var(--surface-3); padding: var(--space-md); border-radius: 6px; margin-bottom: var(--space-sm); display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 700;">${lead.name}</div>
                            <div style="font-size: 12px; color: var(--text-50);">${lead.interest || 'No type'}</div>
                            ${lead.notes ? `<div style="font-size: 11px; color: var(--neon-cyan); margin-top: 4px;">📝 ${lead.notes.substring(0, 50)}${lead.notes.length > 50 ? '...' : ''}</div>` : ''}
                        </div>
                        <div style="display: flex; gap: var(--space-sm); align-items: center;">
                            ${lead.phone ? `<a href="tel:${lead.phone}" class="btn btn-sm btn-primary">📞 Call</a>` : ''}
                            ${lead.email ? `<a href="mailto:${lead.email}" class="btn btn-sm">✉ Email</a>` : ''}
                            <select class="form-select" style="width: auto; padding: 4px 8px;" onchange="ProdCRM.updateStatus(${i}, this.value)">
                                <option value="Pending" ${lead.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                <option value="Contacted" ${lead.status === 'Contacted' ? 'selected' : ''}>Contacted</option>
                                <option value="Confirmed" ${lead.status === 'Confirmed' ? 'selected' : ''}>Confirmed</option>
                                <option value="Declined" ${lead.status === 'Declined' ? 'selected' : ''}>Declined</option>
                            </select>
                        </div>
                    </div>
                `).join('');
            },

            renderIntel() {
                const leads = Core.data.crm?.leads || [];
                const ledger = Core.data.crm?.ledger || [];
                
                const totalValue = leads.reduce((sum, l) => sum + (Number(l.value) || 0), 0);
                const confirmed = leads.filter(l => l.status === 'Confirmed');
                const confirmedValue = confirmed.reduce((sum, l) => sum + (Number(l.value) || 0), 0);
                const totalIncome = ledger.reduce((sum, t) => sum + (Number(t.amount) || 0), 0);
                const conversion = leads.length > 0 ? ((confirmed.length / leads.length) * 100).toFixed(0) : 0;
                
                const pipelineEl = document.getElementById('prod-intel-pipeline');
                const revenueEl = document.getElementById('prod-intel-revenue');
                const conversionEl = document.getElementById('prod-intel-conversion');
                
                if (pipelineEl) pipelineEl.textContent = '$' + totalValue.toLocaleString();
                if (revenueEl) revenueEl.textContent = '$' + confirmedValue.toLocaleString();
                if (conversionEl) conversionEl.textContent = conversion + '%';
                
                const tbody = document.getElementById('prod-table-ledger');
                if (!tbody) return;
                
                if (ledger.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="table-empty">No transactions</td></tr>';
                } else {
                    tbody.innerHTML = ledger.map((t, i) => `
                        <tr>
                            <td class="font-mono">${t.date || ''}</td>
                            <td>${t.source}</td>
                            <td>${t.type || 'Income'}</td>
                            <td class="font-mono font-bold" style="color: var(--neon-emerald);">$${Number(t.amount).toLocaleString()}</td>
                            <td><button class="delete-btn" onclick="ProdCRM.deleteIncome(${i})">×</button></td>
                        </tr>
                    `).join('');
                }
            },

            showLeadModal(id = null) {
                document.getElementById('modal-prod-lead').classList.add('active');
                document.getElementById('prod-lead-modal-title').textContent = id ? 'Edit Contact' : 'Add Contact';
                document.getElementById('prod-lead-id').value = id || '';
                
                if (id) {
                    const lead = Core.data.crm.leads.find(l => l.id === id);
                    if (lead) {
                        document.getElementById('prod-lead-name').value = lead.name || '';
                        document.getElementById('prod-lead-phone').value = lead.phone || '';
                        document.getElementById('prod-lead-email').value = lead.email || '';
                        
                        const standardTypes = ['Talent', 'Vendor', 'Sponsor', 'Investor'];
                        if (standardTypes.includes(lead.interest)) {
                            document.getElementById('prod-lead-interest').value = lead.interest;
                            document.getElementById('prod-custom-interest-group').classList.add('hidden');
                        } else {
                            document.getElementById('prod-lead-interest').value = 'Custom';
                            document.getElementById('prod-lead-custom-interest').value = lead.interest || '';
                            document.getElementById('prod-custom-interest-group').classList.remove('hidden');
                        }
                        
                        document.getElementById('prod-lead-value').value = lead.value || '';
                        document.getElementById('prod-lead-notes').value = lead.notes || '';
                    }
                } else {
                    document.getElementById('prod-lead-name').value = '';
                    document.getElementById('prod-lead-phone').value = '';
                    document.getElementById('prod-lead-email').value = '';
                    document.getElementById('prod-lead-interest').value = 'Talent';
                    document.getElementById('prod-lead-custom-interest').value = '';
                    document.getElementById('prod-custom-interest-group').classList.add('hidden');
                    document.getElementById('prod-lead-value').value = '';
                    document.getElementById('prod-lead-notes').value = '';
                }
            },

            editLead(id) { 
                this.showLeadModal(id); 
            },

            toggleCustomInterest() {
                const select = document.getElementById('prod-lead-interest');
                const customGroup = document.getElementById('prod-custom-interest-group');
                if (select.value === 'Custom') {
                    customGroup.classList.remove('hidden');
                } else {
                    customGroup.classList.add('hidden');
                }
            },

            saveLead() {
                const id = document.getElementById('prod-lead-id').value;
                const name = document.getElementById('prod-lead-name').value.trim();
                if (!name) { alert('Name is required'); return; }
                
                let interest = document.getElementById('prod-lead-interest').value;
                if (interest === 'Custom') {
                    interest = document.getElementById('prod-lead-custom-interest').value.trim() || 'Other';
                }
                
                const leadData = {
                    name,
                    phone: document.getElementById('prod-lead-phone').value.trim(),
                    email: document.getElementById('prod-lead-email').value.trim(),
                    interest,
                    value: document.getElementById('prod-lead-value').value,
                    notes: document.getElementById('prod-lead-notes').value.trim()
                };
                
                if (id) {
                    // Edit existing lead
                    const lead = Core.data.crm.leads.find(l => l.id === parseInt(id));
                    if (lead) {
                        Object.assign(lead, leadData);
                        Core.log(`Updated contact: ${name}`);
                    }
                } else {
                    // Add new lead
                    Core.data.crm.leads.push({ 
                        id: Date.now(), 
                        status: 'new', 
                        ...leadData 
                    });
                    Core.log(`Added contact: ${name}`);
                }
                
                Core.save();
                this.hideModals();
                this.renderPipeline();
                this.renderDialer();
                this.renderIntel();
            },

            deleteLead(id) {
                if (confirm('Delete this contact?')) {
                    const index = Core.data.crm.leads.findIndex(l => l.id === id);
                    if (index !== -1) {
                        Core.data.crm.leads.splice(index, 1);
                        Core.save();
                        this.renderPipeline();
                        this.renderDialer();
                        this.renderIntel();
                    }
                }
            },

            updateStatus(id, status) {
                const lead = Core.data.crm.leads.find(l => l.id === id);
                if (lead) {
                    lead.status = status;
                    Core.save();
                    this.renderPipeline();
                    this.renderIntel();
                }
            },

            showIncomeModal() {
                document.getElementById('prod-income-source').value = '';
                document.getElementById('prod-income-amount').value = '';
                document.getElementById('prod-income-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('modal-prod-income').classList.add('active');
            },

            saveIncome() {
                const source = document.getElementById('prod-income-source').value.trim();
                const amount = document.getElementById('prod-income-amount').value;
                const date = document.getElementById('prod-income-date').value;
                
                if (!source || !amount) { alert('Source and amount required'); return; }
                
                if (!Core.data.crm.ledger) Core.data.crm.ledger = [];
                Core.data.crm.ledger.unshift({ source, amount, date });
                Core.save();
                this.hideModals();
                this.renderIntel();
                Core.log(`Income recorded: $${amount} from ${source}`);
            },

            deleteIncome(index) {
                if (confirm('Delete this transaction?')) {
                    Core.data.crm.ledger.splice(index, 1);
                    Core.save();
                    this.renderIntel();
                }
            },

            hideModals() {
                document.getElementById('modal-prod-lead').classList.remove('active');
                document.getElementById('modal-prod-income').classList.remove('active');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           BUSINESS CRM MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const BizCRM = {
            draggedLead: null,

            renderPipeline() {
                if (!Core.bizData) Core.bizData = { leads: [], ledger: [] };
                const board = document.getElementById('biz-kanban-board');
                if (!board) return;
                
                board.innerHTML = CRM_STAGES.map(stage => {
                    const leads = (Core.bizData.leads || []).filter(l => l.status === stage.id);
                    return `
                        <div class="kanban-column" data-stage="${stage.id}">
                            <div class="kanban-column-header">
                                <span class="kanban-column-title">${stage.name}</span>
                                <span class="kanban-column-count">${leads.length}</span>
                            </div>
                            <div class="kanban-column-body" ondragover="BizCRM.allowDrop(event)" ondrop="BizCRM.drop(event, '${stage.id}')">
                                ${leads.map(l => this.renderLeadCard(l)).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            },

            renderLeadCard(lead) {
                const interestClass = {
                    'Cinema': 'interest-cinema',
                    'VR': 'interest-vr',
                    'General Video': 'interest-video',
                    'Cyber': 'interest-cyber'
                }[lead.interest] || 'interest-custom';
                
                return `
                    <div class="kanban-card ${interestClass}" draggable="true" ondragstart="BizCRM.dragStart(event, ${lead.id})" data-id="${lead.id}">
                        <div class="kanban-card-actions">
                            <button class="kanban-card-btn call" onclick="BizCRM.loadToDialer(${lead.id}); event.stopPropagation();" title="Load to Dialer">📞</button>
                            <button class="kanban-card-btn" onclick="BizCRM.editLead(${lead.id}); event.stopPropagation();" title="Edit">✎</button>
                            <button class="kanban-card-btn del" onclick="BizCRM.deleteLead(${lead.id}); event.stopPropagation();" title="Delete">×</button>
                        </div>
                        <div class="kanban-card-name">${lead.name}</div>
                        <div class="kanban-card-phone">${lead.phone || 'No phone'}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                            <span class="tag tag-${interestClass === 'interest-cinema' ? 'pink' : interestClass === 'interest-vr' ? 'cyan' : interestClass === 'interest-video' ? 'emerald' : interestClass === 'interest-cyber' ? 'violet' : 'gold'}">${lead.interest}</span>
                            <span class="kanban-card-value">$${Number(lead.value || 0).toLocaleString()}</span>
                        </div>
                    </div>
                `;
            },

            dragStart(e, id) {
                this.draggedLead = id;
                e.target.classList.add('dragging');
            },

            allowDrop(e) { 
                e.preventDefault(); 
            },

            drop(e, newStatus) {
                e.preventDefault();
                if (this.draggedLead) {
                    const lead = Core.bizData.leads.find(l => l.id === this.draggedLead);
                    if (lead) {
                        lead.status = newStatus;
                        Core.saveBizData();
                        this.renderPipeline();
                        Core.log(`Lead "${lead.name}" moved to ${newStatus}`);
                    }
                }
                this.draggedLead = null;
                document.querySelectorAll('.kanban-card').forEach(card => card.classList.remove('dragging'));
            },

            loadToDialer(id) {
                Core.navigate('biz-dialer');
                // The dialer will show all leads
            },

            renderDialer() {
                const leads = Core.bizData?.leads || [];
                const container = document.getElementById('biz-dialer-queue');
                
                if (!container) return;
                
                if (leads.length === 0) {
                    container.innerHTML = '<div class="text-muted" style="text-align: center; padding: var(--space-2xl);">No leads to call</div>';
                    return;
                }
                
                container.innerHTML = leads.map((lead, i) => `
                    <div style="background: var(--surface-3); padding: var(--space-md); border-radius: 6px; margin-bottom: var(--space-sm); display: flex; justify-content: space-between; align-items: center; border-left: 3px solid var(--neon-gold);">
                        <div>
                            <div style="font-weight: 700;">${lead.name}</div>
                            <div style="font-size: 12px; color: var(--text-50);">${lead.interest || 'No interest'}</div>
                            ${lead.notes ? `<div style="font-size: 11px; color: var(--neon-gold); margin-top: 4px;">📝 ${lead.notes.substring(0, 50)}${lead.notes.length > 50 ? '...' : ''}</div>` : ''}
                        </div>
                        <div style="display: flex; gap: var(--space-sm); align-items: center;">
                            ${lead.phone ? `<a href="tel:${lead.phone}" class="btn btn-sm btn-gold">📞 Call</a>` : ''}
                            ${lead.email ? `<a href="mailto:${lead.email}" class="btn btn-sm">✉ Email</a>` : ''}
                            <select class="form-select" style="width: auto; padding: 4px 8px;" onchange="BizCRM.updateStatus(${i}, this.value)">
                                <option value="New" ${lead.status === 'New' ? 'selected' : ''}>New</option>
                                <option value="Contacted" ${lead.status === 'Contacted' ? 'selected' : ''}>Contacted</option>
                                <option value="Proposal" ${lead.status === 'Proposal' ? 'selected' : ''}>Proposal</option>
                                <option value="Won" ${lead.status === 'Won' ? 'selected' : ''}>Won</option>
                                <option value="Lost" ${lead.status === 'Lost' ? 'selected' : ''}>Lost</option>
                            </select>
                        </div>
                    </div>
                `).join('');
            },

            renderIntel() {
                const leads = Core.bizData?.leads || [];
                const ledger = Core.bizData?.ledger || [];
                
                const totalValue = leads.reduce((sum, l) => sum + (Number(l.value) || 0), 0);
                const won = leads.filter(l => l.status === 'Won');
                const wonValue = won.reduce((sum, l) => sum + (Number(l.value) || 0), 0);
                const totalIncome = ledger.reduce((sum, t) => sum + (Number(t.amount) || 0), 0);
                const conversion = leads.length > 0 ? ((won.length / leads.length) * 100).toFixed(0) : 0;
                
                const pipelineEl = document.getElementById('biz-intel-pipeline');
                const revenueEl = document.getElementById('biz-intel-revenue');
                const conversionEl = document.getElementById('biz-intel-conversion');
                
                if (pipelineEl) pipelineEl.textContent = '$' + totalValue.toLocaleString();
                if (revenueEl) revenueEl.textContent = '$' + wonValue.toLocaleString();
                if (conversionEl) conversionEl.textContent = conversion + '%';
                
                const tbody = document.getElementById('biz-table-ledger');
                if (!tbody) return;
                
                if (ledger.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" class="table-empty">No transactions</td></tr>';
                } else {
                    tbody.innerHTML = ledger.map((t, i) => `
                        <tr>
                            <td class="font-mono">${t.date || ''}</td>
                            <td>${t.source}</td>
                            <td>${t.type || 'Income'}</td>
                            <td class="font-mono font-bold" style="color: var(--neon-gold);">$${Number(t.amount).toLocaleString()}</td>
                            <td><button class="delete-btn" onclick="BizCRM.deleteIncome(${i})">×</button></td>
                        </tr>
                    `).join('');
                }
            },

            showLeadModal(id = null) {
                document.getElementById('modal-biz-lead').classList.add('active');
                document.getElementById('biz-lead-modal-title').textContent = id ? 'Edit Lead' : 'Add Lead';
                document.getElementById('biz-lead-id').value = id || '';
                
                if (id) {
                    const lead = Core.bizData.leads.find(l => l.id === id);
                    if (lead) {
                        document.getElementById('biz-lead-name').value = lead.name || '';
                        document.getElementById('biz-lead-phone').value = lead.phone || '';
                        document.getElementById('biz-lead-email').value = lead.email || '';
                        
                        const standardInterests = ['Cinema', 'VR', 'General Video', 'Cyber'];
                        if (standardInterests.includes(lead.interest)) {
                            document.getElementById('biz-lead-interest').value = lead.interest;
                            document.getElementById('biz-custom-interest-group').classList.add('hidden');
                        } else {
                            document.getElementById('biz-lead-interest').value = 'Custom';
                            document.getElementById('biz-lead-custom-interest').value = lead.interest || '';
                            document.getElementById('biz-custom-interest-group').classList.remove('hidden');
                        }
                        
                        document.getElementById('biz-lead-value').value = lead.value || '';
                        document.getElementById('biz-lead-notes').value = lead.notes || '';
                    }
                } else {
                    document.getElementById('biz-lead-name').value = '';
                    document.getElementById('biz-lead-phone').value = '';
                    document.getElementById('biz-lead-email').value = '';
                    document.getElementById('biz-lead-interest').value = 'Cinema';
                    document.getElementById('biz-lead-custom-interest').value = '';
                    document.getElementById('biz-custom-interest-group').classList.add('hidden');
                    document.getElementById('biz-lead-value').value = '';
                    document.getElementById('biz-lead-notes').value = '';
                }
            },

            editLead(id) { 
                this.showLeadModal(id); 
            },

            toggleCustomInterest() {
                const select = document.getElementById('biz-lead-interest');
                const customGroup = document.getElementById('biz-custom-interest-group');
                if (select.value === 'Custom') {
                    customGroup.classList.remove('hidden');
                } else {
                    customGroup.classList.add('hidden');
                }
            },

            saveLead() {
                const id = document.getElementById('biz-lead-id').value;
                const name = document.getElementById('biz-lead-name').value.trim();
                if (!name) { alert('Name is required'); return; }
                
                let interest = document.getElementById('biz-lead-interest').value;
                if (interest === 'Custom') {
                    interest = document.getElementById('biz-lead-custom-interest').value.trim() || 'Other';
                }
                
                const leadData = {
                    name,
                    phone: document.getElementById('biz-lead-phone').value.trim(),
                    email: document.getElementById('biz-lead-email').value.trim(),
                    interest,
                    value: document.getElementById('biz-lead-value').value,
                    notes: document.getElementById('biz-lead-notes').value.trim()
                };
                
                if (id) {
                    // Edit existing lead
                    const lead = Core.bizData.leads.find(l => l.id === parseInt(id));
                    if (lead) {
                        Object.assign(lead, leadData);
                        Core.log(`Updated lead: ${name}`);
                    }
                } else {
                    // Add new lead
                    if (!Core.bizData.leads) Core.bizData.leads = [];
                    Core.bizData.leads.push({ 
                        id: Date.now(), 
                        status: 'new', 
                        ...leadData 
                    });
                    Core.log(`Added lead: ${name}`);
                }
                
                Core.saveBizData();
                this.hideModals();
                this.renderPipeline();
                this.renderDialer();
                this.renderIntel();
            },

            deleteLead(id) {
                if (confirm('Delete this lead?')) {
                    const index = Core.bizData.leads.findIndex(l => l.id === id);
                    if (index !== -1) {
                        Core.bizData.leads.splice(index, 1);
                        Core.saveBizData();
                        this.renderPipeline();
                        this.renderDialer();
                        this.renderIntel();
                    }
                }
            },

            updateStatus(id, status) {
                const lead = Core.bizData.leads.find(l => l.id === id);
                if (lead) {
                    lead.status = status;
                    Core.saveBizData();
                    this.renderPipeline();
                    this.renderIntel();
                }
            },

            showIncomeModal() {
                document.getElementById('biz-income-source').value = '';
                document.getElementById('biz-income-amount').value = '';
                document.getElementById('biz-income-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('modal-biz-income').classList.add('active');
            },

            saveIncome() {
                const source = document.getElementById('biz-income-source').value.trim();
                const amount = document.getElementById('biz-income-amount').value;
                const date = document.getElementById('biz-income-date').value;
                
                if (!source || !amount) { alert('Source and amount required'); return; }
                
                if (!Core.bizData.ledger) Core.bizData.ledger = [];
                Core.bizData.ledger.unshift({ source, amount, date });
                Core.saveBizData();
                this.hideModals();
                this.renderIntel();
                Core.log(`Business income recorded: $${amount} from ${source}`);
            },

            deleteIncome(index) {
                if (confirm('Delete this transaction?')) {
                    Core.bizData.ledger.splice(index, 1);
                    Core.saveBizData();
                    this.renderIntel();
                }
            },

            hideModals() {
                document.getElementById('modal-biz-lead').classList.remove('active');
                document.getElementById('modal-biz-income').classList.remove('active');
            }
        };


        /* ═══════════════════════════════════════════════════════════════════════
           GANTT MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Gantt = {
            currentType: 'production',

            render() {
                if (!Core.data.gantt) Core.data.gantt = { production: [], global: [] };
                this.renderChart('production');
                this.renderChart('global');
            },

            switchType(type) {
                this.currentType = type;
                document.querySelectorAll('.gantt-tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`.gantt-tab[onclick*="${type}"]`).classList.add('active');
                
                document.getElementById('gantt-production').style.display = type === 'production' ? 'block' : 'none';
                document.getElementById('gantt-global').style.display = type === 'global' ? 'block' : 'none';
            },

            renderChart(type) {
                const tasks = Core.data.gantt?.[type] || [];
                const container = document.getElementById(`gantt-${type}-chart`);
                
                if (tasks.length === 0) {
                    container.innerHTML = `<div class="text-muted" style="text-align: center; padding: var(--space-2xl);">No tasks in ${type} Gantt chart</div>`;
                    return;
                }

                const allDates = tasks.flatMap(t => [new Date(t.start), new Date(t.end)]);
                const minDate = new Date(Math.min(...allDates));
                const maxDate = new Date(Math.max(...allDates));
                const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)) + 1;

                const phaseColors = {
                    development: 'var(--neon-violet)',
                    preproduction: 'var(--neon-cyan)',
                    production: 'var(--neon-emerald)',
                    postproduction: 'var(--neon-amber)',
                    distribution: 'var(--neon-rose)'
                };

                let html = `
                    <div class="gantt-header">
                        <div class="gantt-task-col">Task</div>
                        <div class="gantt-timeline">
                            ${this.generateTimelineHeader(minDate, totalDays)}
                        </div>
                    </div>
                `;

                tasks.forEach((task, i) => {
                    const startOffset = Math.ceil((new Date(task.start) - minDate) / (1000 * 60 * 60 * 24));
                    const duration = Math.ceil((new Date(task.end) - new Date(task.start)) / (1000 * 60 * 60 * 24)) + 1;
                    const leftPercent = (startOffset / totalDays) * 100;
                    const widthPercent = (duration / totalDays) * 100;
                    const color = phaseColors[task.phase] || 'var(--neon-cyan)';

                    html += `
                        <div class="gantt-row">
                            <div class="gantt-task-col">
                                <div class="gantt-task-name">${task.name}</div>
                                <div class="gantt-task-owner">${task.owner || ''}</div>
                            </div>
                            <div class="gantt-timeline">
                                <div class="gantt-bar" style="left: ${leftPercent}%; width: ${widthPercent}%; background: ${color};" title="${task.name}: ${task.start} to ${task.end}">
                                    <span class="gantt-bar-label">${task.name}</span>
                                </div>
                            </div>
                            <button class="delete-btn" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%);" onclick="Gantt.deleteTask('${type}', ${i})">×</button>
                        </div>
                    `;
                });

                container.innerHTML = html;
            },

            generateTimelineHeader(startDate, totalDays) {
                let html = '';
                const months = {};
                
                for (let i = 0; i < totalDays; i++) {
                    const date = new Date(startDate);
                    date.setDate(date.getDate() + i);
                    const monthKey = date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
                    if (!months[monthKey]) months[monthKey] = 0;
                    months[monthKey]++;
                }

                for (const [month, days] of Object.entries(months)) {
                    const widthPercent = (days / totalDays) * 100;
                    html += `<div class="gantt-month" style="width: ${widthPercent}%;">${month}</div>`;
                }

                return html;
            },

            showModal(type) {
                this.currentType = type;
                document.getElementById('gantt-task-name').value = '';
                document.getElementById('gantt-task-owner').value = '';
                document.getElementById('gantt-task-phase').value = type === 'production' ? 'production' : 'development';
                document.getElementById('gantt-task-start').value = '';
                document.getElementById('gantt-task-end').value = '';
                document.getElementById('modal-gantt-task').classList.add('active');
            },

            hideModal() {
                document.getElementById('modal-gantt-task').classList.remove('active');
            },

            saveTask() {
                const name = document.getElementById('gantt-task-name').value.trim();
                const owner = document.getElementById('gantt-task-owner').value.trim();
                const phase = document.getElementById('gantt-task-phase').value;
                const start = document.getElementById('gantt-task-start').value;
                const end = document.getElementById('gantt-task-end').value;

                if (!name || !start || !end) {
                    alert('Task name, start date, and end date are required');
                    return;
                }

                if (new Date(end) < new Date(start)) {
                    alert('End date must be after start date');
                    return;
                }

                if (!Core.data.gantt) Core.data.gantt = { production: [], global: [] };
                if (!Core.data.gantt[this.currentType]) Core.data.gantt[this.currentType] = [];

                Core.data.gantt[this.currentType].push({ name, owner, phase, start, end });
                Core.save();
                this.hideModal();
                this.render();
                Core.log(`Gantt task added: ${name}`);
            },

            deleteTask(type, index) {
                if (confirm('Delete this task?')) {
                    Core.data.gantt[type].splice(index, 1);
                    Core.save();
                    this.render();
                }
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           CALENDAR MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Calendar = {
            currentDate: new Date(),

            render() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();
                
                document.getElementById('calendar-month-year').textContent = 
                    this.currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startPadding = firstDay.getDay();
                const totalDays = lastDay.getDate();
                
                const shootDays = (Core.data.days || []).map(d => d.date);
                const ganttDates = this.getGanttDates();
                
                let html = '';
                
                for (let i = 0; i < startPadding; i++) {
                    html += '<div class="calendar-day empty"></div>';
                }
                
                for (let day = 1; day <= totalDays; day++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const isShootDay = shootDays.some(d => d === dateStr);
                    const ganttPhase = ganttDates[dateStr];
                    const isToday = new Date().toDateString() === new Date(year, month, day).toDateString();
                    
                    let classes = 'calendar-day';
                    if (isToday) classes += ' today';
                    if (isShootDay) classes += ' shoot-day';
                    if (ganttPhase) classes += ` gantt-${ganttPhase}`;
                    
                    html += `
                        <div class="${classes}">
                            <span class="calendar-day-number">${day}</span>
                            ${isShootDay ? '<span class="calendar-indicator shoot">🎬</span>' : ''}
                            ${ganttPhase ? `<span class="calendar-indicator phase">${ganttPhase.substring(0, 3).toUpperCase()}</span>` : ''}
                        </div>
                    `;
                }
                
                document.getElementById('calendar-grid').innerHTML = html;
            },

            getGanttDates() {
                const dates = {};
                const tasks = [...(Core.data.gantt?.production || []), ...(Core.data.gantt?.global || [])];
                
                tasks.forEach(task => {
                    const start = new Date(task.start);
                    const end = new Date(task.end);
                    
                    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                        const dateStr = d.toISOString().split('T')[0];
                        if (!dates[dateStr]) dates[dateStr] = task.phase;
                    }
                });
                
                return dates;
            },

            prevMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                this.render();
            },

            nextMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                this.render();
            },

            today() {
                this.currentDate = new Date();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NOTES MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Notes = {
            load() {
                document.getElementById('notes-textarea').value = Core.data.notes || '';
            },

            save() {
                Core.data.notes = document.getElementById('notes-textarea').value;
                Core.save();
                Core.log('Notes saved');
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           WEATHER MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const Weather = {
            async fetch() {
                const location = document.getElementById('weather-location').value.trim();
                if (!location) { alert('Please enter a location'); return; }
                
                const container = document.getElementById('weather-results');
                container.innerHTML = '<div class="text-muted" style="text-align: center; padding: var(--space-xl);">Loading weather data...</div>';
                
                try {
                    const geoRes = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(location)}&count=1`);
                    const geoData = await geoRes.json();
                    
                    if (!geoData.results || geoData.results.length === 0) {
                        container.innerHTML = '<div class="text-muted" style="text-align: center; padding: var(--space-xl);">Location not found</div>';
                        return;
                    }
                    
                    const { latitude, longitude, name, country } = geoData.results[0];
                    
                    const weatherRes = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=temperature_2m_max,temperature_2m_min,precipitation_probability_max,weathercode&timezone=auto&forecast_days=7`);
                    const weatherData = await weatherRes.json();
                    
                    const weatherCodes = {
                        0: { icon: '☀️', desc: 'Clear' },
                        1: { icon: '🌤️', desc: 'Mostly Clear' },
                        2: { icon: '⛅', desc: 'Partly Cloudy' },
                        3: { icon: '☁️', desc: 'Overcast' },
                        45: { icon: '🌫️', desc: 'Foggy' },
                        48: { icon: '🌫️', desc: 'Rime Fog' },
                        51: { icon: '🌧️', desc: 'Light Drizzle' },
                        53: { icon: '🌧️', desc: 'Drizzle' },
                        55: { icon: '🌧️', desc: 'Heavy Drizzle' },
                        61: { icon: '🌧️', desc: 'Light Rain' },
                        63: { icon: '🌧️', desc: 'Rain' },
                        65: { icon: '🌧️', desc: 'Heavy Rain' },
                        71: { icon: '🌨️', desc: 'Light Snow' },
                        73: { icon: '🌨️', desc: 'Snow' },
                        75: { icon: '🌨️', desc: 'Heavy Snow' },
                        80: { icon: '🌦️', desc: 'Showers' },
                        95: { icon: '⛈️', desc: 'Thunderstorm' }
                    };
                    
                    let html = `<h3 style="margin-bottom: var(--space-lg);">${name}, ${country}</h3><div class="weather-grid">`;
                    
                    weatherData.daily.time.forEach((date, i) => {
                        const code = weatherData.daily.weathercode[i];
                        const weather = weatherCodes[code] || { icon: '❓', desc: 'Unknown' };
                        const high = Math.round(weatherData.daily.temperature_2m_max[i]);
                        const low = Math.round(weatherData.daily.temperature_2m_min[i]);
                        const precip = weatherData.daily.precipitation_probability_max[i];
                        
                        html += `
                            <div class="weather-card">
                                <div class="weather-date">${new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</div>
                                <div class="weather-icon">${weather.icon}</div>
                                <div class="weather-desc">${weather.desc}</div>
                                <div class="weather-temp">${high}° / ${low}°</div>
                                <div class="weather-precip">💧 ${precip}%</div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    container.innerHTML = html;
                    Core.log(`Weather fetched for ${name}`);
                    
                } catch (error) {
                    console.error('Weather fetch error:', error);
                    container.innerHTML = '<div class="text-muted" style="text-align: center; padding: var(--space-xl);">Error fetching weather data</div>';
                }
            }
        };


        /* ═══════════════════════════════════════════════════════════════════════
           PDF EXPORT MODULE - Professional Stylized PDF Generation
           ═══════════════════════════════════════════════════════════════════════ */
        const PDFExport = {
            
            // Common PDF styling and utilities
            getStyles() {
                return `
                    @page { margin: 0.5in; size: letter; }
                    * { box-sizing: border-box; margin: 0; padding: 0; }
                    body { 
                        font-family: 'Segoe UI', Arial, sans-serif; 
                        font-size: 10pt; 
                        line-height: 1.4;
                        color: #1a1a1a;
                        background: white;
                    }
                    .page { 
                        page-break-after: always; 
                        padding: 0.25in;
                        min-height: 10in;
                    }
                    .page:last-child { page-break-after: avoid; }
                    
                    /* Header Styles */
                    .header { 
                        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                        color: white;
                        padding: 20px 24px;
                        border-radius: 8px;
                        margin-bottom: 20px;
                    }
                    .header-main { display: flex; justify-content: space-between; align-items: flex-start; }
                    .header-title { font-size: 24pt; font-weight: 700; letter-spacing: -0.5px; }
                    .header-subtitle { font-size: 11pt; opacity: 0.8; margin-top: 4px; }
                    .header-meta { text-align: right; font-size: 9pt; }
                    .header-meta div { margin-bottom: 2px; }
                    .header-badge { 
                        display: inline-block;
                        background: #00d4ff;
                        color: #1a1a2e;
                        padding: 4px 12px;
                        border-radius: 4px;
                        font-weight: 700;
                        font-size: 10pt;
                        margin-top: 8px;
                    }
                    
                    /* Section Styles */
                    .section { margin-bottom: 20px; }
                    .section-title {
                        background: #f0f4f8;
                        padding: 10px 16px;
                        font-weight: 700;
                        font-size: 11pt;
                        color: #1a1a2e;
                        border-left: 4px solid #00d4ff;
                        margin-bottom: 12px;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    
                    /* Table Styles */
                    table { width: 100%; border-collapse: collapse; margin-bottom: 16px; }
                    th { 
                        background: #1a1a2e; 
                        color: white; 
                        padding: 10px 12px; 
                        text-align: left;
                        font-size: 9pt;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }
                    td { 
                        padding: 10px 12px; 
                        border-bottom: 1px solid #e5e7eb;
                        vertical-align: top;
                    }
                    tr:nth-child(even) { background: #f9fafb; }
                    tr:hover { background: #f0f4f8; }
                    
                    /* Strip Styles for Schedule */
                    .strip {
                        display: flex;
                        align-items: center;
                        padding: 8px 12px;
                        margin-bottom: 4px;
                        border-radius: 4px;
                        font-size: 9pt;
                    }
                    .strip-day-int { background: #fef3c7; border-left: 4px solid #f59e0b; }
                    .strip-day-ext { background: #d1fae5; border-left: 4px solid #10b981; }
                    .strip-night-int { background: #dbeafe; border-left: 4px solid #3b82f6; }
                    .strip-night-ext { background: #e0e7ff; border-left: 4px solid #6366f1; }
                    .strip-daybreak { 
                        background: #1a1a2e; 
                        color: white; 
                        text-align: center;
                        font-weight: 700;
                        padding: 12px;
                    }
                    .strip-banner {
                        background: #fef2f2;
                        border: 2px dashed #ef4444;
                        text-align: center;
                        font-weight: 600;
                        color: #dc2626;
                    }
                    .strip-scene { width: 50px; font-weight: 700; font-family: monospace; }
                    .strip-intext { width: 40px; font-size: 8pt; }
                    .strip-daynight { width: 50px; font-size: 8pt; }
                    .strip-location { flex: 1; font-weight: 600; }
                    .strip-cast { width: 120px; font-size: 8pt; color: #6b7280; }
                    .strip-pages { width: 50px; text-align: right; font-family: monospace; }
                    
                    /* Breakdown Styles */
                    .breakdown-header {
                        display: grid;
                        grid-template-columns: repeat(4, 1fr);
                        gap: 12px;
                        margin-bottom: 16px;
                    }
                    .breakdown-field { 
                        background: #f9fafb;
                        padding: 8px 12px;
                        border-radius: 4px;
                        border: 1px solid #e5e7eb;
                    }
                    .breakdown-field-label { font-size: 8pt; color: #6b7280; text-transform: uppercase; }
                    .breakdown-field-value { font-weight: 600; margin-top: 2px; }
                    .breakdown-scene-header {
                        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                        color: white;
                        padding: 16px;
                        border-radius: 8px;
                        margin-bottom: 16px;
                    }
                    .breakdown-scene-number { font-size: 32pt; font-weight: 700; }
                    .breakdown-scene-info { font-size: 14pt; margin-top: 8px; }
                    .breakdown-categories {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 12px;
                    }
                    .breakdown-category {
                        background: #f9fafb;
                        border-radius: 6px;
                        padding: 12px;
                        border: 1px solid #e5e7eb;
                    }
                    .breakdown-category-title {
                        font-weight: 700;
                        font-size: 9pt;
                        color: #1a1a2e;
                        margin-bottom: 8px;
                        padding-bottom: 6px;
                        border-bottom: 2px solid #00d4ff;
                    }
                    .breakdown-element {
                        font-size: 9pt;
                        padding: 4px 0;
                        border-bottom: 1px dotted #e5e7eb;
                    }
                    
                    /* Call Sheet Styles */
                    .callsheet-info-grid {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 16px;
                        margin-bottom: 20px;
                    }
                    .callsheet-info-box {
                        background: #f0f4f8;
                        padding: 16px;
                        border-radius: 8px;
                        text-align: center;
                    }
                    .callsheet-info-label { font-size: 9pt; color: #6b7280; text-transform: uppercase; }
                    .callsheet-info-value { font-size: 18pt; font-weight: 700; color: #1a1a2e; margin-top: 4px; }
                    .callsheet-weather {
                        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                        color: white;
                        padding: 16px;
                        border-radius: 8px;
                        margin-bottom: 20px;
                    }
                    
                    /* Gantt Styles */
                    .gantt-container { margin-top: 20px; }
                    .gantt-row { 
                        display: flex; 
                        align-items: center; 
                        margin-bottom: 8px;
                        background: #f9fafb;
                        border-radius: 4px;
                        overflow: hidden;
                    }
                    .gantt-task-name { 
                        width: 180px; 
                        padding: 10px 12px;
                        font-weight: 600;
                        font-size: 9pt;
                        background: #1a1a2e;
                        color: white;
                    }
                    .gantt-bar-container { 
                        flex: 1; 
                        height: 32px;
                        position: relative;
                        background: #e5e7eb;
                    }
                    .gantt-bar {
                        position: absolute;
                        height: 100%;
                        border-radius: 2px;
                        display: flex;
                        align-items: center;
                        padding: 0 8px;
                        font-size: 8pt;
                        color: white;
                        font-weight: 600;
                        overflow: hidden;
                        white-space: nowrap;
                    }
                    .gantt-bar.development { background: #8b5cf6; }
                    .gantt-bar.preproduction { background: #00d4ff; }
                    .gantt-bar.production { background: #10b981; }
                    .gantt-bar.postproduction { background: #f59e0b; }
                    .gantt-bar.distribution { background: #ef4444; }
                    
                    /* Release Form Styles */
                    .release-form { padding: 20px; }
                    .release-title { 
                        text-align: center;
                        font-size: 18pt;
                        font-weight: 700;
                        margin-bottom: 24px;
                        padding-bottom: 16px;
                        border-bottom: 3px solid #1a1a2e;
                    }
                    .release-section { margin-bottom: 20px; }
                    .release-section-title {
                        font-weight: 700;
                        font-size: 11pt;
                        margin-bottom: 8px;
                        color: #1a1a2e;
                    }
                    .release-text { 
                        font-size: 10pt;
                        line-height: 1.6;
                        text-align: justify;
                    }
                    .release-field-row {
                        display: flex;
                        gap: 20px;
                        margin-bottom: 12px;
                    }
                    .release-field {
                        flex: 1;
                        border-bottom: 1px solid #1a1a2e;
                        padding-bottom: 4px;
                    }
                    .release-field-label {
                        font-size: 8pt;
                        color: #6b7280;
                        margin-bottom: 2px;
                    }
                    .release-field-value {
                        font-size: 11pt;
                        min-height: 20px;
                    }
                    .signature-section {
                        margin-top: 40px;
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 40px;
                    }
                    .signature-box {
                        border-top: 2px solid #1a1a2e;
                        padding-top: 8px;
                    }
                    .signature-label { font-size: 9pt; color: #6b7280; }
                    
                    /* Footer */
                    .footer {
                        position: fixed;
                        bottom: 0.5in;
                        left: 0.5in;
                        right: 0.5in;
                        text-align: center;
                        font-size: 8pt;
                        color: #9ca3af;
                        border-top: 1px solid #e5e7eb;
                        padding-top: 8px;
                    }
                    
                    /* Utility Classes */
                    .text-center { text-align: center; }
                    .text-right { text-align: right; }
                    .font-bold { font-weight: 700; }
                    .font-mono { font-family: 'Courier New', monospace; }
                    .text-sm { font-size: 9pt; }
                    .text-muted { color: #6b7280; }
                    .mb-sm { margin-bottom: 8px; }
                    .mb-md { margin-bottom: 16px; }
                    .mb-lg { margin-bottom: 24px; }
                `;
            },

            openPrintWindow(content, title) {
                const printWindow = window.open('', '_blank', 'width=900,height=700');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${title}</title>
                        <style>${this.getStyles()}</style>
                    </head>
                    <body>${content}</body>
                    </html>
                `);
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.print();
                }, 500);
                
                Core.log(`PDF generated: ${title}`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               1. SCRIPT BREAKDOWN PDF
               ═══════════════════════════════════════════════════════════════════ */
            scriptBreakdown() {
                const breakdowns = Core.data.breakdowns || [];
                if (breakdowns.length === 0) {
                    alert('No breakdown sheets to export');
                    return;
                }

                let html = '';
                
                breakdowns.forEach((bd, idx) => {
                    html += `
                        <div class="page">
                            <div class="header">
                                <div class="header-main">
                                    <div>
                                        <div class="header-title">${Core.currentProduction}</div>
                                        <div class="header-subtitle">Script Breakdown Sheet</div>
                                    </div>
                                    <div class="header-meta">
                                        <div>Sheet #${bd.sheet || idx + 1}</div>
                                        <div>Date: ${bd.date || new Date().toLocaleDateString()}</div>
                                        <div>Pages: ${bd.pages || '1'}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="breakdown-scene-header">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <div class="breakdown-scene-number">SCENE ${bd.scene || '?'}</div>
                                        <div class="breakdown-scene-info">${bd.intext || 'INT'}. ${bd.location || 'LOCATION TBD'} - ${bd.daynight || 'DAY'}</div>
                                    </div>
                                    <div class="header-badge">${bd.intext || 'INT'} / ${bd.daynight || 'DAY'}</div>
                                </div>
                            </div>
                            
                            ${bd.description ? `
                                <div class="section">
                                    <div class="section-title">Scene Description</div>
                                    <p style="padding: 12px; background: #f9fafb; border-radius: 4px;">${bd.description}</p>
                                </div>
                            ` : ''}
                            
                            <div class="breakdown-categories">
                                ${BREAKDOWN_CATEGORIES.map(cat => {
                                    const items = bd.elements?.[cat.id] || [];
                                    return `
                                        <div class="breakdown-category">
                                            <div class="breakdown-category-title">${cat.icon} ${cat.name}</div>
                                            ${items.length > 0 
                                                ? items.map(item => `<div class="breakdown-element">${item}</div>`).join('')
                                                : '<div class="text-muted text-sm">None</div>'
                                            }
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            
                            <div class="footer">
                                ${Core.currentProduction} | Breakdown Sheet ${idx + 1} of ${breakdowns.length} | Generated ${new Date().toLocaleDateString()}
                            </div>
                        </div>
                    `;
                });

                this.openPrintWindow(html, `${Core.currentProduction} - Script Breakdown`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               2. SHOOTING SCHEDULE PDF
               ═══════════════════════════════════════════════════════════════════ */
            shootingSchedule() {
                const strips = Core.data.schedule?.strips || [];
                if (strips.length === 0) {
                    alert('No scenes in schedule to export');
                    return;
                }

                const scenes = strips.filter(s => s.type === 'scene');
                const totalPages = scenes.reduce((sum, s) => sum + Schedule.parsePages(s.pages), 0);

                let html = `
                    <div class="page">
                        <div class="header">
                            <div class="header-main">
                                <div>
                                    <div class="header-title">${Core.currentProduction}</div>
                                    <div class="header-subtitle">Shooting Schedule</div>
                                </div>
                                <div class="header-meta">
                                    <div>Total Scenes: ${scenes.length}</div>
                                    <div>Total Pages: ${totalPages.toFixed(2)}</div>
                                    <div>Generated: ${new Date().toLocaleDateString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">Schedule Overview</div>
                            <div style="display: flex; gap: 16px; margin-bottom: 20px;">
                                <div style="flex: 1; background: #fef3c7; padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 8pt; color: #92400e;">DAY INT</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #92400e;">${scenes.filter(s => s.intext?.includes('INT') && (s.daynight === 'DAY' || s.daynight === 'DAWN')).length}</div>
                                </div>
                                <div style="flex: 1; background: #d1fae5; padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 8pt; color: #065f46;">DAY EXT</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #065f46;">${scenes.filter(s => s.intext === 'EXT' && (s.daynight === 'DAY' || s.daynight === 'DAWN')).length}</div>
                                </div>
                                <div style="flex: 1; background: #dbeafe; padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 8pt; color: #1e40af;">NIGHT INT</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #1e40af;">${scenes.filter(s => s.intext?.includes('INT') && (s.daynight === 'NIGHT' || s.daynight === 'DUSK')).length}</div>
                                </div>
                                <div style="flex: 1; background: #e0e7ff; padding: 12px; border-radius: 6px; text-align: center;">
                                    <div style="font-size: 8pt; color: #3730a3;">NIGHT EXT</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #3730a3;">${scenes.filter(s => s.intext === 'EXT' && (s.daynight === 'NIGHT' || s.daynight === 'DUSK')).length}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">Stripboard</div>
                `;

                strips.forEach(strip => {
                    if (strip.type === 'daybreak') {
                        html += `<div class="strip strip-daybreak">END OF DAY ${strip.dayNumber} — ${strip.scenes || 0} scenes, ${strip.totalPages || 0} pages</div>`;
                    } else if (strip.type === 'banner') {
                        html += `<div class="strip strip-banner">${strip.text} ${strip.duration ? `(${strip.duration} min)` : ''}</div>`;
                    } else {
                        const colorClass = `strip-${Schedule.getStripColorClass(strip.intext, strip.daynight).replace(/-/g, '-')}`;
                        html += `
                            <div class="strip ${colorClass}">
                                <div class="strip-scene">${strip.scene || '?'}</div>
                                <div class="strip-intext">${strip.intext || 'INT'}</div>
                                <div class="strip-daynight">${strip.daynight || 'DAY'}</div>
                                <div class="strip-location">${strip.location || 'TBD'}</div>
                                <div class="strip-cast">${strip.cast || '-'}</div>
                                <div class="strip-pages">${strip.pages || '0'}</div>
                            </div>
                        `;
                    }
                });

                html += `
                        </div>
                        <div class="footer">
                            ${Core.currentProduction} | Shooting Schedule | Generated ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                `;

                this.openPrintWindow(html, `${Core.currentProduction} - Shooting Schedule`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               3. CAST & CREW PDF
               ═══════════════════════════════════════════════════════════════════ */
            castAndCrew() {
                const cast = Object.values(Core.data.cast || {});
                const crew = Object.values(Core.data.crew || {});

                if (cast.length === 0 && crew.length === 0) {
                    alert('No cast or crew members to export');
                    return;
                }

                let html = `
                    <div class="page">
                        <div class="header">
                            <div class="header-main">
                                <div>
                                    <div class="header-title">${Core.currentProduction}</div>
                                    <div class="header-subtitle">Cast & Crew Directory</div>
                                </div>
                                <div class="header-meta">
                                    <div>Cast: ${cast.length}</div>
                                    <div>Crew: ${crew.length}</div>
                                    <div>Generated: ${new Date().toLocaleDateString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${cast.length > 0 ? `
                            <div class="section">
                                <div class="section-title">Cast</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th style="width: 60px;">ID</th>
                                            <th>Name</th>
                                            <th>Character/Role</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${cast.sort((a, b) => {
                                            const numA = parseInt(a.id.replace(/\D/g, ''));
                                            const numB = parseInt(b.id.replace(/\D/g, ''));
                                            return numA - numB;
                                        }).map(member => `
                                            <tr>
                                                <td class="font-mono font-bold">${member.id}</td>
                                                <td class="font-bold">${member.name}</td>
                                                <td>${member.role || '-'}</td>
                                                <td class="font-mono">${member.phone || '-'}</td>
                                                <td>${member.email || '-'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        ` : ''}
                        
                        ${crew.length > 0 ? `
                            <div class="section">
                                <div class="section-title">Crew</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th style="width: 60px;">ID</th>
                                            <th>Name</th>
                                            <th>Position/Department</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${crew.sort((a, b) => {
                                            const numA = parseInt(a.id.replace(/\D/g, ''));
                                            const numB = parseInt(b.id.replace(/\D/g, ''));
                                            return numA - numB;
                                        }).map(member => `
                                            <tr>
                                                <td class="font-mono font-bold">${member.id}</td>
                                                <td class="font-bold">${member.name}</td>
                                                <td>${member.position || '-'}</td>
                                                <td class="font-mono">${member.phone || '-'}</td>
                                                <td>${member.email || '-'}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        ` : ''}
                        
                        <div class="footer">
                            ${Core.currentProduction} | Cast & Crew Directory | Generated ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                `;

                this.openPrintWindow(html, `${Core.currentProduction} - Cast & Crew`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               4. TALENT RELEASE FORM PDF
               ═══════════════════════════════════════════════════════════════════ */
            talentRelease() {
                this.showTalentReleaseModal();
            },

            showTalentReleaseModal() {
                document.getElementById('tr-project').value = Core.currentProduction;
                document.getElementById('modal-talent-release').classList.add('active');
            },

            hideTalentReleaseModal() {
                document.getElementById('modal-talent-release').classList.remove('active');
            },

            generateTalentRelease() {
                const data = {
                    performer: document.getElementById('tr-performer-name').value.trim(),
                    role: document.getElementById('tr-role').value.trim(),
                    company: document.getElementById('tr-company').value.trim(),
                    project: document.getElementById('tr-project').value.trim(),
                    compensation: document.getElementById('tr-compensation').value.trim(),
                    dates: document.getElementById('tr-dates').value.trim(),
                    address: document.getElementById('tr-address').value.trim(),
                    terms: document.getElementById('tr-terms').value.trim()
                };

                const html = `
                    <div class="release-form">
                        <div class="release-title">TALENT RELEASE AGREEMENT</div>
                        
                        <div class="release-section">
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Production Company</div>
                                    <div class="release-field-value">${data.company || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">Project Title</div>
                                    <div class="release-field-value">${data.project || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Performer Name</div>
                                    <div class="release-field-value">${data.performer || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">Role/Character</div>
                                    <div class="release-field-value">${data.role || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Performer Address</div>
                                    <div class="release-field-value">${data.address || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Compensation</div>
                                    <div class="release-field-value">${data.compensation || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">Shoot Date(s)</div>
                                    <div class="release-field-value">${data.dates || '______________________'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="release-section">
                            <div class="release-section-title">Grant of Rights</div>
                            <div class="release-text">
                                For good and valuable consideration, the receipt and sufficiency of which is hereby acknowledged, I hereby grant to the Production Company, its successors, assigns, and licensees the irrevocable right and license to use my name, likeness, voice, biography, and performance in connection with the production, distribution, exhibition, advertising, and exploitation of the above-referenced project in any and all media now known or hereafter devised, throughout the universe, in perpetuity.
                            </div>
                        </div>
                        
                        <div class="release-section">
                            <div class="release-section-title">Representations and Warranties</div>
                            <div class="release-text">
                                I represent and warrant that: (a) I have the full right and authority to enter into this Agreement; (b) I am not under any obligation or disability that would prevent or restrict my performance hereunder; (c) my performance will not infringe upon or violate the rights of any third party; and (d) I will not make any claims against the Production Company or its successors based on my performance.
                            </div>
                        </div>
                        
                        <div class="release-section">
                            <div class="release-section-title">Release and Indemnification</div>
                            <div class="release-text">
                                I hereby release and discharge the Production Company from any and all claims, demands, or causes of action that I may have or may hereafter have against the Production Company arising out of or in connection with my performance or the use thereof. I agree to indemnify and hold harmless the Production Company from any claims arising from a breach of my representations and warranties herein.
                            </div>
                        </div>
                        
                        ${data.terms ? `
                            <div class="release-section">
                                <div class="release-section-title">Additional Terms</div>
                                <div class="release-text">${data.terms}</div>
                            </div>
                        ` : ''}
                        
                        <div class="release-section">
                            <div class="release-text">
                                I have read and understand this Agreement and agree to be bound by its terms. I acknowledge that I have been advised to seek independent legal counsel before signing this Agreement.
                            </div>
                        </div>
                        
                        <div class="signature-section">
                            <div>
                                <div class="signature-box">
                                    <div class="signature-label">Performer Signature</div>
                                </div>
                                <div style="margin-top: 20px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Print Name</div>
                                        <div class="release-field-value">${data.performer || ''}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Date</div>
                                        <div class="release-field-value"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="signature-box">
                                    <div class="signature-label">Production Company Representative</div>
                                </div>
                                <div style="margin-top: 20px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Print Name</div>
                                        <div class="release-field-value"></div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Date</div>
                                        <div class="release-field-value"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                this.hideTalentReleaseModal();
                this.openPrintWindow(html, `Talent Release - ${data.performer || 'Form'}`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               5. LOCATION RELEASE FORM PDF
               ═══════════════════════════════════════════════════════════════════ */
            locationRelease() {
                this.showLocationReleaseModal();
            },

            showLocationReleaseModal() {
                document.getElementById('lr-project').value = Core.currentProduction;
                document.getElementById('modal-location-release').classList.add('active');
            },

            hideLocationReleaseModal() {
                document.getElementById('modal-location-release').classList.remove('active');
            },

            generateLocationRelease() {
                const data = {
                    owner: document.getElementById('lr-owner-name').value.trim(),
                    company: document.getElementById('lr-company').value.trim(),
                    address: document.getElementById('lr-address').value.trim(),
                    description: document.getElementById('lr-description').value.trim(),
                    project: document.getElementById('lr-project').value.trim(),
                    fee: document.getElementById('lr-fee').value.trim(),
                    startDate: document.getElementById('lr-start-date').value,
                    endDate: document.getElementById('lr-end-date').value,
                    hours: document.getElementById('lr-hours').value.trim(),
                    crewSize: document.getElementById('lr-crew-size').value,
                    conditions: document.getElementById('lr-conditions').value.trim()
                };

                const html = `
                    <div class="release-form">
                        <div class="release-title">LOCATION RELEASE AGREEMENT</div>
                        
                        <div class="release-section">
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Property Owner/Authorized Representative</div>
                                    <div class="release-field-value">${data.owner || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">Production Company</div>
                                    <div class="release-field-value">${data.company || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field" style="flex: 2;">
                                    <div class="release-field-label">Location Address</div>
                                    <div class="release-field-value">${data.address || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field" style="flex: 2;">
                                    <div class="release-field-label">Location Description</div>
                                    <div class="release-field-value">${data.description || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Project Title</div>
                                    <div class="release-field-value">${data.project || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">Fee/Compensation</div>
                                    <div class="release-field-value">${data.fee || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Start Date</div>
                                    <div class="release-field-value">${data.startDate || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">End Date</div>
                                    <div class="release-field-value">${data.endDate || '______________________'}</div>
                                </div>
                            </div>
                            <div class="release-field-row">
                                <div class="release-field">
                                    <div class="release-field-label">Access Hours</div>
                                    <div class="release-field-value">${data.hours || '______________________'}</div>
                                </div>
                                <div class="release-field">
                                    <div class="release-field-label">Approximate Crew Size</div>
                                    <div class="release-field-value">${data.crewSize || '______________________'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="release-section">
                            <div class="release-section-title">Grant of Permission</div>
                            <div class="release-text">
                                The undersigned property owner/authorized representative hereby grants to the Production Company, its employees, agents, contractors, successors, assigns, and licensees, permission to enter upon and use the above-described property for the purpose of photographing, filming, and recording scenes for the above-referenced production, including the right to bring personnel, equipment, and vehicles onto the property.
                            </div>
                        </div>
                        
                        <div class="release-section">
                            <div class="release-section-title">Rights Granted</div>
                            <div class="release-text">
                                The Production Company shall have the right to photograph, film, and record the property and to use such photographs, films, and recordings in any manner and in any media now known or hereafter devised, throughout the universe, in perpetuity, including but not limited to theatrical exhibition, television broadcast, home video, streaming, and all forms of advertising and promotion.
                            </div>
                        </div>
                        
                        <div class="release-section">
                            <div class="release-section-title">Production Company Obligations</div>
                            <div class="release-text">
                                The Production Company agrees to: (a) restore the property to substantially the same condition as existed prior to filming; (b) maintain comprehensive general liability insurance during the filming period; (c) comply with all applicable laws and regulations; and (d) indemnify and hold harmless the property owner from any claims arising from the Production Company's use of the property, except for claims arising from the property owner's negligence or willful misconduct.
                            </div>
                        </div>
                        
                        ${data.conditions ? `
                            <div class="release-section">
                                <div class="release-section-title">Special Conditions</div>
                                <div class="release-text">${data.conditions}</div>
                            </div>
                        ` : ''}
                        
                        <div class="release-section">
                            <div class="release-text">
                                The undersigned represents and warrants that they have the authority to grant the permissions contained herein and that such grant does not violate any agreement with any third party.
                            </div>
                        </div>
                        
                        <div class="signature-section">
                            <div>
                                <div class="signature-box">
                                    <div class="signature-label">Property Owner/Representative Signature</div>
                                </div>
                                <div style="margin-top: 20px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Print Name</div>
                                        <div class="release-field-value">${data.owner || ''}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Date</div>
                                        <div class="release-field-value"></div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <div class="signature-box">
                                    <div class="signature-label">Production Company Representative</div>
                                </div>
                                <div style="margin-top: 20px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Print Name</div>
                                        <div class="release-field-value"></div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px;">
                                    <div class="release-field">
                                        <div class="release-field-label">Date</div>
                                        <div class="release-field-value"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                this.hideLocationReleaseModal();
                this.openPrintWindow(html, `Location Release - ${data.address || 'Form'}`);
            },


            /* ═══════════════════════════════════════════════════════════════════
               6. GANTT CHART PDF (Production & Global)
               ═══════════════════════════════════════════════════════════════════ */
            ganttChart(type = 'both') {
                const productionTasks = Core.data.gantt?.production || [];
                const globalTasks = Core.data.gantt?.global || [];

                if (productionTasks.length === 0 && globalTasks.length === 0) {
                    alert('No Gantt tasks to export');
                    return;
                }

                const renderGanttSection = (tasks, title, subtitle) => {
                    if (tasks.length === 0) return '';

                    const allDates = tasks.flatMap(t => [new Date(t.start), new Date(t.end)]);
                    const minDate = new Date(Math.min(...allDates));
                    const maxDate = new Date(Math.max(...allDates));
                    const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)) + 1;

                    const phaseColors = {
                        development: '#8b5cf6',
                        preproduction: '#00d4ff',
                        production: '#10b981',
                        postproduction: '#f59e0b',
                        distribution: '#ef4444'
                    };

                    let monthsHtml = '';
                    const months = {};
                    for (let i = 0; i < totalDays; i++) {
                        const date = new Date(minDate);
                        date.setDate(date.getDate() + i);
                        const monthKey = date.toLocaleDateString('en-US', { month: 'short', year: '2-digit' });
                        if (!months[monthKey]) months[monthKey] = 0;
                        months[monthKey]++;
                    }
                    for (const [month, days] of Object.entries(months)) {
                        const widthPercent = (days / totalDays) * 100;
                        monthsHtml += `<div style="width: ${widthPercent}%; text-align: center; font-size: 8pt; padding: 4px; background: #f0f4f8; border-right: 1px solid #e5e7eb;">${month}</div>`;
                    }

                    let rowsHtml = tasks.map(task => {
                        const startOffset = Math.ceil((new Date(task.start) - minDate) / (1000 * 60 * 60 * 24));
                        const duration = Math.ceil((new Date(task.end) - new Date(task.start)) / (1000 * 60 * 60 * 24)) + 1;
                        const leftPercent = (startOffset / totalDays) * 100;
                        const widthPercent = (duration / totalDays) * 100;
                        const color = phaseColors[task.phase] || '#00d4ff';

                        return `
                            <div class="gantt-row">
                                <div class="gantt-task-name">
                                    ${task.name}
                                    ${task.owner ? `<div style="font-size: 7pt; font-weight: normal; opacity: 0.8;">${task.owner}</div>` : ''}
                                </div>
                                <div class="gantt-bar-container">
                                    <div class="gantt-bar ${task.phase}" style="left: ${leftPercent}%; width: ${widthPercent}%; background: ${color};">
                                        ${task.name}
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    return `
                        <div class="section">
                            <div class="section-title">${title}</div>
                            <p style="margin-bottom: 12px; color: #6b7280; font-size: 9pt;">${subtitle}</p>
                            <div style="display: flex; margin-bottom: 8px;">
                                <div style="width: 180px; background: #1a1a2e; color: white; font-size: 8pt; padding: 4px 12px;">Task</div>
                                <div style="flex: 1; display: flex;">${monthsHtml}</div>
                            </div>
                            <div class="gantt-container">${rowsHtml}</div>
                            <div style="margin-top: 16px; display: flex; gap: 16px; flex-wrap: wrap;">
                                <div style="display: flex; align-items: center; gap: 6px; font-size: 8pt;">
                                    <div style="width: 16px; height: 16px; background: #8b5cf6; border-radius: 2px;"></div>
                                    Development
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; font-size: 8pt;">
                                    <div style="width: 16px; height: 16px; background: #00d4ff; border-radius: 2px;"></div>
                                    Pre-Production
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; font-size: 8pt;">
                                    <div style="width: 16px; height: 16px; background: #10b981; border-radius: 2px;"></div>
                                    Production
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; font-size: 8pt;">
                                    <div style="width: 16px; height: 16px; background: #f59e0b; border-radius: 2px;"></div>
                                    Post-Production
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; font-size: 8pt;">
                                    <div style="width: 16px; height: 16px; background: #ef4444; border-radius: 2px;"></div>
                                    Distribution
                                </div>
                            </div>
                        </div>
                    `;
                };

                let html = `
                    <div class="page">
                        <div class="header">
                            <div class="header-main">
                                <div>
                                    <div class="header-title">${Core.currentProduction}</div>
                                    <div class="header-subtitle">Production Timeline - Gantt Chart</div>
                                </div>
                                <div class="header-meta">
                                    <div>Production Tasks: ${productionTasks.length}</div>
                                    <div>Global Tasks: ${globalTasks.length}</div>
                                    <div>Generated: ${new Date().toLocaleDateString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${(type === 'both' || type === 'production') ? renderGanttSection(productionTasks, 'Production Gantt Chart', 'Tasks specific to this production') : ''}
                        ${(type === 'both' || type === 'global') ? renderGanttSection(globalTasks, 'Global Gantt Chart', 'Company-wide and cross-production tasks') : ''}
                        
                        <div class="footer">
                            ${Core.currentProduction} | Gantt Chart | Generated ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                `;

                this.openPrintWindow(html, `${Core.currentProduction} - Gantt Chart`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               7. CALL SHEET PDF
               ═══════════════════════════════════════════════════════════════════ */
            callSheet() {
                this.showCallSheetModal();
            },

            showCallSheetModal() {
                document.getElementById('cs-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('modal-callsheet').classList.add('active');
            },

            hideCallSheetModal() {
                document.getElementById('modal-callsheet').classList.remove('active');
            },

            generateCallSheet() {
                const data = {
                    dayNumber: document.getElementById('cs-day-number').value || '1',
                    date: document.getElementById('cs-date').value,
                    callTime: document.getElementById('cs-call-time').value || '06:00',
                    director: document.getElementById('cs-director').value.trim(),
                    ad: document.getElementById('cs-ad').value.trim(),
                    producer: document.getElementById('cs-producer').value.trim(),
                    location: document.getElementById('cs-location').value.trim(),
                    address: document.getElementById('cs-address').value.trim(),
                    weather: document.getElementById('cs-weather').value.trim(),
                    notes: document.getElementById('cs-notes').value.trim()
                };

                const strips = Core.data.schedule?.strips || [];
                const scenes = strips.filter(s => s.type === 'scene').slice(0, 8);
                const cast = Object.values(Core.data.cast || {}).slice(0, 15);
                const crew = Object.values(Core.data.crew || {}).slice(0, 15);

                const formatTime = (time) => {
                    if (!time) return '';
                    const [h, m] = time.split(':');
                    const hour = parseInt(h);
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const hour12 = hour % 12 || 12;
                    return `${hour12}:${m} ${ampm}`;
                };

                const html = `
                    <div class="page">
                        <div class="header" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);">
                            <div class="header-main">
                                <div>
                                    <div class="header-title">${Core.currentProduction}</div>
                                    <div class="header-subtitle">CALL SHEET</div>
                                </div>
                                <div class="header-meta">
                                    <div style="font-size: 24pt; font-weight: 700;">DAY ${data.dayNumber}</div>
                                    <div>${data.date ? new Date(data.date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' }) : ''}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="callsheet-info-grid">
                            <div class="callsheet-info-box" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color: white;">
                                <div class="callsheet-info-label" style="color: rgba(255,255,255,0.8);">General Call</div>
                                <div class="callsheet-info-value" style="color: white;">${formatTime(data.callTime)}</div>
                            </div>
                            <div class="callsheet-info-box">
                                <div class="callsheet-info-label">Location</div>
                                <div class="callsheet-info-value" style="font-size: 12pt;">${data.location || 'TBD'}</div>
                                <div style="font-size: 9pt; color: #6b7280; margin-top: 4px;">${data.address || ''}</div>
                            </div>
                            <div class="callsheet-info-box">
                                <div class="callsheet-info-label">Weather</div>
                                <div class="callsheet-info-value" style="font-size: 12pt;">${data.weather || 'Check forecast'}</div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
                            <div style="background: #f9fafb; padding: 12px; border-radius: 6px;">
                                <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">Director</div>
                                <div style="font-weight: 700;">${data.director || 'TBD'}</div>
                            </div>
                            <div style="background: #f9fafb; padding: 12px; border-radius: 6px;">
                                <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">1st AD</div>
                                <div style="font-weight: 700;">${data.ad || 'TBD'}</div>
                            </div>
                            <div style="background: #f9fafb; padding: 12px; border-radius: 6px;">
                                <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">Producer</div>
                                <div style="font-weight: 700;">${data.producer || 'TBD'}</div>
                            </div>
                        </div>
                        
                        ${data.notes ? `
                            <div style="background: #fef2f2; border: 1px solid #fecaca; padding: 12px; border-radius: 6px; margin-bottom: 20px;">
                                <div style="font-weight: 700; color: #dc2626; margin-bottom: 4px;">⚠️ SPECIAL NOTES</div>
                                <div style="font-size: 10pt;">${data.notes}</div>
                            </div>
                        ` : ''}
                        
                        <div class="section">
                            <div class="section-title">Shooting Schedule</div>
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">Scene</th>
                                        <th style="width: 40px;">I/E</th>
                                        <th style="width: 50px;">D/N</th>
                                        <th>Location</th>
                                        <th>Description</th>
                                        <th style="width: 100px;">Cast</th>
                                        <th style="width: 50px;">Pages</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${scenes.length > 0 ? scenes.map(s => `
                                        <tr>
                                            <td class="font-mono font-bold">${s.scene || '?'}</td>
                                            <td>${s.intext || 'INT'}</td>
                                            <td>${s.daynight || 'DAY'}</td>
                                            <td class="font-bold">${s.location || 'TBD'}</td>
                                            <td class="text-sm">${s.description || '-'}</td>
                                            <td class="text-sm">${s.cast || '-'}</td>
                                            <td class="font-mono">${s.pages || '0'}</td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="7" style="text-align: center; color: #6b7280;">No scenes scheduled</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="section">
                                <div class="section-title">Cast Call Times</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Character</th>
                                            <th>Call</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${cast.length > 0 ? cast.map(c => `
                                            <tr>
                                                <td class="font-mono">${c.id}</td>
                                                <td class="font-bold">${c.name}</td>
                                                <td>${c.role || '-'}</td>
                                                <td class="font-mono">${formatTime(data.callTime)}</td>
                                            </tr>
                                        `).join('') : '<tr><td colspan="4" style="text-align: center; color: #6b7280;">No cast</td></tr>'}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="section">
                                <div class="section-title">Crew</div>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Position</th>
                                            <th>Call</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${crew.length > 0 ? crew.map(c => `
                                            <tr>
                                                <td class="font-bold">${c.name}</td>
                                                <td>${c.position || '-'}</td>
                                                <td class="font-mono">${formatTime(data.callTime)}</td>
                                            </tr>
                                        `).join('') : '<tr><td colspan="3" style="text-align: center; color: #6b7280;">No crew</td></tr>'}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="footer">
                            ${Core.currentProduction} | Call Sheet Day ${data.dayNumber} | Generated ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                `;

                this.hideCallSheetModal();
                this.openPrintWindow(html, `${Core.currentProduction} - Call Sheet Day ${data.dayNumber}`);
            },

            /* ═══════════════════════════════════════════════════════════════════
               BONUS: DAILY PRODUCTION REPORT PDF
               ═══════════════════════════════════════════════════════════════════ */
            dailyReport() {
                this.showDailyReportModal();
            },

            showDailyReportModal() {
                document.getElementById('dr-date').value = new Date().toISOString().split('T')[0];
                document.getElementById('modal-daily-report').classList.add('active');
            },

            hideDailyReportModal() {
                document.getElementById('modal-daily-report').classList.remove('active');
            },

            generateDailyReport() {
                const data = {
                    date: document.getElementById('dr-date').value,
                    dayOf: document.getElementById('dr-day-of').value.trim(),
                    call: document.getElementById('dr-call').value,
                    firstShot: document.getElementById('dr-first-shot').value,
                    lunch: document.getElementById('dr-lunch').value.trim(),
                    wrap: document.getElementById('dr-wrap').value,
                    scenes: document.getElementById('dr-scenes').value.trim(),
                    pages: document.getElementById('dr-pages').value.trim(),
                    notes: document.getElementById('dr-notes').value.trim()
                };

                const html = `
                    <div class="page">
                        <div class="header">
                            <div class="header-main">
                                <div>
                                    <div class="header-title">${Core.currentProduction}</div>
                                    <div class="header-subtitle">Daily Production Report</div>
                                </div>
                                <div class="header-meta">
                                    <div style="font-size: 14pt; font-weight: 700;">Day ${data.dayOf || '?'}</div>
                                    <div>${data.date ? new Date(data.date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' }) : ''}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">Schedule Summary</div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
                                <div style="background: #f9fafb; padding: 16px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">Call Time</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #1a1a2e;">${data.call || '-'}</div>
                                </div>
                                <div style="background: #f9fafb; padding: 16px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">First Shot</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #1a1a2e;">${data.firstShot || '-'}</div>
                                </div>
                                <div style="background: #f9fafb; padding: 16px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">Lunch</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #1a1a2e;">${data.lunch || '-'}</div>
                                </div>
                                <div style="background: #f9fafb; padding: 16px; border-radius: 8px; text-align: center;">
                                    <div style="font-size: 8pt; color: #6b7280; text-transform: uppercase;">Wrap</div>
                                    <div style="font-size: 18pt; font-weight: 700; color: #1a1a2e;">${data.wrap || '-'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="section">
                            <div class="section-title">Production Progress</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div style="background: #d1fae5; padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 9pt; color: #065f46; text-transform: uppercase; margin-bottom: 4px;">Scenes Shot Today</div>
                                    <div style="font-size: 14pt; font-weight: 700; color: #065f46;">${data.scenes || 'None recorded'}</div>
                                </div>
                                <div style="background: #dbeafe; padding: 16px; border-radius: 8px;">
                                    <div style="font-size: 9pt; color: #1e40af; text-transform: uppercase; margin-bottom: 4px;">Pages Shot Today</div>
                                    <div style="font-size: 14pt; font-weight: 700; color: #1e40af;">${data.pages || 'None recorded'}</div>
                                </div>
                            </div>
                        </div>
                        
                        ${data.notes ? `
                            <div class="section">
                                <div class="section-title">Notes & Issues</div>
                                <div style="background: #f9fafb; padding: 16px; border-radius: 8px;">
                                    <p style="line-height: 1.6;">${data.notes}</p>
                                </div>
                            </div>
                        ` : ''}
                        
                        <div class="signature-section" style="margin-top: 40px;">
                            <div>
                                <div class="signature-box">
                                    <div class="signature-label">Production Manager</div>
                                </div>
                            </div>
                            <div>
                                <div class="signature-box">
                                    <div class="signature-label">1st Assistant Director</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="footer">
                            ${Core.currentProduction} | Daily Production Report | Generated ${new Date().toLocaleDateString()}
                        </div>
                    </div>
                `;

                this.hideDailyReportModal();
                this.openPrintWindow(html, `${Core.currentProduction} - Daily Report ${data.date}`);
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 1: BUDGET TRACKER MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const BudgetTracker = {
            init() {
                this.render();
            },
            
            getData() {
                return Core.data.budget || {
                    totalBudget: 0,
                    categories: [
                        { name: 'Above the Line', allocated: 0, spent: 0 },
                        { name: 'Below the Line', allocated: 0, spent: 0 },
                        { name: 'Post-Production', allocated: 0, spent: 0 },
                        { name: 'Marketing', allocated: 0, spent: 0 },
                        { name: 'Contingency', allocated: 0, spent: 0 }
                    ],
                    expenses: []
                };
            },
            
            saveData(data) {
                Core.data.budget = data;
                Core.save();
            },
            
            render() {
                const container = document.getElementById('view-budget');
                if (!container) return;
                
                const data = this.getData();
                const totalSpent = data.categories.reduce((sum, c) => sum + c.spent, 0);
                const totalAllocated = data.categories.reduce((sum, c) => sum + c.allocated, 0);
                const remaining = data.totalBudget - totalSpent;
                
                container.innerHTML = `
                    <div class="view-header">
                        <h1 class="view-title">BUDGET TRACKER</h1>
                        <div class="view-actions">
                            <button class="btn btn-sm btn-primary" onclick="BudgetTracker.showAddExpenseModal()">+ Add Expense</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.budgetReport()">📄 Export PDF</button>
                        </div>
                    </div>
                    
                    <div class="budget-overview">
                        <div class="stat-card">
                            <div class="stat-label">Total Budget</div>
                            <div class="stat-value" style="color: var(--neon-cyan);">$${data.totalBudget.toLocaleString()}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Spent</div>
                            <div class="stat-value" style="color: var(--neon-rose);">${totalSpent.toLocaleString()}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Remaining</div>
                            <div class="stat-value" style="color: ${remaining >= 0 ? 'var(--neon-emerald)' : 'var(--neon-rose)'};">$${remaining.toLocaleString()}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Burn Rate</div>
                            <div class="stat-value">${data.totalBudget > 0 ? Math.round((totalSpent / data.totalBudget) * 100) : 0}%</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Budget Categories</div>
                        <div class="budget-categories">
                            ${data.categories.map((cat, idx) => `
                                <div class="budget-category-card">
                                    <div class="budget-cat-header">
                                        <span class="budget-cat-name">${cat.name}</span>
                                        <span class="budget-cat-percent">${cat.allocated > 0 ? Math.round((cat.spent / cat.allocated) * 100) : 0}%</span>
                                    </div>
                                    <div class="budget-progress-bar">
                                        <div class="budget-progress-fill" style="width: ${cat.allocated > 0 ? Math.min(100, (cat.spent / cat.allocated) * 100) : 0}%; background: ${cat.spent > cat.allocated ? 'var(--neon-rose)' : 'var(--neon-cyan)'};"></div>
                                    </div>
                                    <div class="budget-cat-amounts">
                                        <span>Spent: $${cat.spent.toLocaleString()}</span>
                                        <span>Allocated: $${cat.allocated.toLocaleString()}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="section">
                        <div class="section-title">Recent Expenses</div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(data.expenses || []).slice(-10).reverse().map((exp, idx) => `
                                    <tr>
                                        <td>${exp.date}</td>
                                        <td>${exp.description}</td>
                                        <td>${exp.category}</td>
                                        <td class="font-mono">$${exp.amount.toLocaleString()}</td>
                                        <td><button class="btn btn-xs btn-danger" onclick="BudgetTracker.deleteExpense(${data.expenses.length - 1 - idx})">×</button></td>
                                    </tr>
                                `).join('') || '<tr><td colspan="5" class="text-center text-muted">No expenses recorded</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                `;
            },
            
            showAddExpenseModal() {
                const data = this.getData();
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'modal-add-expense';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="document.getElementById('modal-add-expense').remove()">×</button>
                        <h2 class="modal-title">Add Expense</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Description</label>
                                <input type="text" id="expense-desc" placeholder="Expense description">
                            </div>
                            <div class="form-group">
                                <label>Amount ($)</label>
                                <input type="number" id="expense-amount" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select id="expense-category">
                                    ${data.categories.map(c => `<option value="${c.name}">${c.name}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Date</label>
                                <input type="date" id="expense-date" value="${new Date().toISOString().split('T')[0]}">
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn" onclick="document.getElementById('modal-add-expense').remove()">Cancel</button>
                            <button class="btn btn-primary" onclick="BudgetTracker.addExpense()">Add Expense</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            
            addExpense() {
                const data = this.getData();
                const expense = {
                    description: document.getElementById('expense-desc').value,
                    amount: parseFloat(document.getElementById('expense-amount').value) || 0,
                    category: document.getElementById('expense-category').value,
                    date: document.getElementById('expense-date').value
                };
                
                if (!data.expenses) data.expenses = [];
                data.expenses.push(expense);
                
                // Update category spent amount
                const cat = data.categories.find(c => c.name === expense.category);
                if (cat) cat.spent += expense.amount;
                
                this.saveData(data);
                document.getElementById('modal-add-expense').remove();
                this.render();
                Core.log(`Added expense: ${expense.description} - $${expense.amount}`);
            },
            
            deleteExpense(idx) {
                const data = this.getData();
                if (data.expenses && data.expenses[idx]) {
                    const exp = data.expenses[idx];
                    const cat = data.categories.find(c => c.name === exp.category);
                    if (cat) cat.spent -= exp.amount;
                    data.expenses.splice(idx, 1);
                    this.saveData(data);
                    this.render();
                }
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 2: SHOT LIST MANAGER
           ═══════════════════════════════════════════════════════════════════════ */
        const ShotList = {
            init() {
                this.render();
            },
            
            getData() {
                return Core.data.shotList || [];
            },
            
            render() {
                const container = document.getElementById('view-shotlist');
                if (!container) return;
                
                const shots = this.getData();
                const shotTypes = ['Wide', 'Medium', 'Close-up', 'Insert', 'POV', 'OTS', 'Two-shot', 'Tracking', 'Dolly', 'Crane'];
                
                container.innerHTML = `
                    <div class="view-header">
                        <h1 class="view-title">SHOT LIST</h1>
                        <div class="view-actions">
                            <button class="btn btn-sm btn-primary" onclick="ShotList.showAddShotModal()">+ Add Shot</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.shotList()">📄 Export PDF</button>
                        </div>
                    </div>
                    
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-label">Total Shots</div>
                            <div class="stat-value">${shots.length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Completed</div>
                            <div class="stat-value" style="color: var(--neon-emerald);">${shots.filter(s => s.completed).length}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Remaining</div>
                            <div class="stat-value" style="color: var(--neon-gold);">${shots.filter(s => !s.completed).length}</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">Shot #</th>
                                    <th style="width: 60px;">Scene</th>
                                    <th>Description</th>
                                    <th style="width: 100px;">Type</th>
                                    <th style="width: 80px;">Size</th>
                                    <th style="width: 100px;">Movement</th>
                                    <th style="width: 80px;">Status</th>
                                    <th style="width: 80px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${shots.map((shot, idx) => `
                                    <tr class="${shot.completed ? 'row-completed' : ''}">
                                        <td class="font-mono font-bold">${shot.number || idx + 1}</td>
                                        <td class="font-mono">${shot.scene || '-'}</td>
                                        <td>${shot.description || '-'}</td>
                                        <td>${shot.type || '-'}</td>
                                        <td>${shot.size || '-'}</td>
                                        <td>${shot.movement || '-'}</td>
                                        <td>
                                            <span class="status-badge ${shot.completed ? 'status-complete' : 'status-pending'}">
                                                ${shot.completed ? '✓ Done' : 'Pending'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn btn-xs" onclick="ShotList.toggleComplete(${idx})">${shot.completed ? '↩' : '✓'}</button>
                                            <button class="btn btn-xs btn-danger" onclick="ShotList.deleteShot(${idx})">×</button>
                                        </td>
                                    </tr>
                                `).join('') || '<tr><td colspan="8" class="text-center text-muted">No shots in list</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                `;
            },
            
            showAddShotModal() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'modal-add-shot';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="document.getElementById('modal-add-shot').remove()">×</button>
                        <h2 class="modal-title">Add Shot</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Shot #</label>
                                <input type="text" id="shot-number" placeholder="1A">
                            </div>
                            <div class="form-group">
                                <label>Scene</label>
                                <input type="text" id="shot-scene" placeholder="1">
                            </div>
                            <div class="form-group full-width">
                                <label>Description</label>
                                <input type="text" id="shot-desc" placeholder="Shot description">
                            </div>
                            <div class="form-group">
                                <label>Shot Type</label>
                                <select id="shot-type">
                                    <option value="Master">Master</option>
                                    <option value="Coverage">Coverage</option>
                                    <option value="Insert">Insert</option>
                                    <option value="Cutaway">Cutaway</option>
                                    <option value="Establishing">Establishing</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Shot Size</label>
                                <select id="shot-size">
                                    <option value="EWS">Extreme Wide</option>
                                    <option value="WS">Wide</option>
                                    <option value="MWS">Medium Wide</option>
                                    <option value="MS">Medium</option>
                                    <option value="MCU">Medium Close-up</option>
                                    <option value="CU">Close-up</option>
                                    <option value="ECU">Extreme Close-up</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Camera Movement</label>
                                <select id="shot-movement">
                                    <option value="Static">Static</option>
                                    <option value="Pan">Pan</option>
                                    <option value="Tilt">Tilt</option>
                                    <option value="Dolly">Dolly</option>
                                    <option value="Tracking">Tracking</option>
                                    <option value="Crane">Crane</option>
                                    <option value="Handheld">Handheld</option>
                                    <option value="Steadicam">Steadicam</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Notes</label>
                                <textarea id="shot-notes" placeholder="Additional notes"></textarea>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn" onclick="document.getElementById('modal-add-shot').remove()">Cancel</button>
                            <button class="btn btn-primary" onclick="ShotList.addShot()">Add Shot</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            
            addShot() {
                const shots = this.getData();
                shots.push({
                    number: document.getElementById('shot-number').value,
                    scene: document.getElementById('shot-scene').value,
                    description: document.getElementById('shot-desc').value,
                    type: document.getElementById('shot-type').value,
                    size: document.getElementById('shot-size').value,
                    movement: document.getElementById('shot-movement').value,
                    notes: document.getElementById('shot-notes').value,
                    completed: false
                });
                Core.data.shotList = shots;
                Core.save();
                document.getElementById('modal-add-shot').remove();
                this.render();
            },
            
            toggleComplete(idx) {
                const shots = this.getData();
                if (shots[idx]) {
                    shots[idx].completed = !shots[idx].completed;
                    Core.data.shotList = shots;
                    Core.save();
                    this.render();
                }
            },
            
            deleteShot(idx) {
                const shots = this.getData();
                shots.splice(idx, 1);
                Core.data.shotList = shots;
                Core.save();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 3: CONTINUITY LOG
           ═══════════════════════════════════════════════════════════════════════ */
        const ContinuityLog = {
            init() {
                this.render();
            },
            
            getData() {
                return Core.data.continuity || [];
            },
            
            render() {
                const container = document.getElementById('view-continuity');
                if (!container) return;
                
                const logs = this.getData();
                
                container.innerHTML = `
                    <div class="view-header">
                        <h1 class="view-title">CONTINUITY LOG</h1>
                        <div class="view-actions">
                            <button class="btn btn-sm btn-primary" onclick="ContinuityLog.showAddLogModal()">+ Add Entry</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.continuityLog()">📄 Export PDF</button>
                        </div>
                    </div>
                    
                    <div class="continuity-grid">
                        ${logs.map((log, idx) => `
                            <div class="continuity-card">
                                <div class="continuity-header">
                                    <span class="continuity-scene">Scene ${log.scene}</span>
                                    <span class="continuity-take">Take ${log.take}</span>
                                </div>
                                <div class="continuity-body">
                                    <div class="continuity-field">
                                        <span class="field-label">Wardrobe</span>
                                        <span class="field-value">${log.wardrobe || '-'}</span>
                                    </div>
                                    <div class="continuity-field">
                                        <span class="field-label">Props</span>
                                        <span class="field-value">${log.props || '-'}</span>
                                    </div>
                                    <div class="continuity-field">
                                        <span class="field-label">Hair/Makeup</span>
                                        <span class="field-value">${log.hairMakeup || '-'}</span>
                                    </div>
                                    <div class="continuity-field">
                                        <span class="field-label">Position</span>
                                        <span class="field-value">${log.position || '-'}</span>
                                    </div>
                                    <div class="continuity-field full-width">
                                        <span class="field-label">Notes</span>
                                        <span class="field-value">${log.notes || '-'}</span>
                                    </div>
                                </div>
                                <div class="continuity-footer">
                                    <span class="continuity-time">${log.timestamp || ''}</span>
                                    <button class="btn btn-xs btn-danger" onclick="ContinuityLog.deleteLog(${idx})">Delete</button>
                                </div>
                            </div>
                        `).join('') || '<div class="empty-state">No continuity logs recorded</div>'}
                    </div>
                `;
            },
            
            showAddLogModal() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'modal-add-continuity';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="document.getElementById('modal-add-continuity').remove()">×</button>
                        <h2 class="modal-title">Add Continuity Entry</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Scene</label>
                                <input type="text" id="cont-scene" placeholder="Scene number">
                            </div>
                            <div class="form-group">
                                <label>Take</label>
                                <input type="text" id="cont-take" placeholder="Take number">
                            </div>
                            <div class="form-group full-width">
                                <label>Wardrobe Description</label>
                                <textarea id="cont-wardrobe" placeholder="Describe wardrobe details"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>Props</label>
                                <textarea id="cont-props" placeholder="List props and their positions"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>Hair/Makeup</label>
                                <textarea id="cont-hair" placeholder="Hair and makeup details"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>Actor Positions</label>
                                <textarea id="cont-position" placeholder="Blocking and position notes"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>Additional Notes</label>
                                <textarea id="cont-notes" placeholder="Any other continuity notes"></textarea>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn" onclick="document.getElementById('modal-add-continuity').remove()">Cancel</button>
                            <button class="btn btn-primary" onclick="ContinuityLog.addLog()">Add Entry</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            
            addLog() {
                const logs = this.getData();
                logs.push({
                    scene: document.getElementById('cont-scene').value,
                    take: document.getElementById('cont-take').value,
                    wardrobe: document.getElementById('cont-wardrobe').value,
                    props: document.getElementById('cont-props').value,
                    hairMakeup: document.getElementById('cont-hair').value,
                    position: document.getElementById('cont-position').value,
                    notes: document.getElementById('cont-notes').value,
                    timestamp: new Date().toLocaleString()
                });
                Core.data.continuity = logs;
                Core.save();
                document.getElementById('modal-add-continuity').remove();
                this.render();
            },
            
            deleteLog(idx) {
                const logs = this.getData();
                logs.splice(idx, 1);
                Core.data.continuity = logs;
                Core.save();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 4: RISK ASSESSMENT MODULE
           ═══════════════════════════════════════════════════════════════════════ */
        const RiskAssessment = {
            riskCategories: ['Stunts', 'Pyrotechnics', 'Water/Heights', 'Animals', 'Vehicles', 'Weather', 'Crowds', 'Equipment', 'Location', 'Health/Safety'],
            
            init() {
                this.render();
            },
            
            getData() {
                return Core.data.risks || [];
            },
            
            render() {
                const container = document.getElementById('view-risk');
                if (!container) return;
                
                const risks = this.getData();
                const highRisks = risks.filter(r => r.level === 'High').length;
                const mediumRisks = risks.filter(r => r.level === 'Medium').length;
                
                container.innerHTML = `
                    <div class="view-header">
                        <h1 class="view-title">RISK ASSESSMENT</h1>
                        <div class="view-actions">
                            <button class="btn btn-sm btn-primary" onclick="RiskAssessment.showAddRiskModal()">+ Add Risk</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.riskAssessment()">📄 Export PDF</button>
                        </div>
                    </div>
                    
                    <div class="stats-row">
                        <div class="stat-card" style="border-color: var(--neon-rose);">
                            <div class="stat-label">High Risk</div>
                            <div class="stat-value" style="color: var(--neon-rose);">${highRisks}</div>
                        </div>
                        <div class="stat-card" style="border-color: var(--neon-gold);">
                            <div class="stat-label">Medium Risk</div>
                            <div class="stat-value" style="color: var(--neon-gold);">${mediumRisks}</div>
                        </div>
                        <div class="stat-card" style="border-color: var(--neon-emerald);">
                            <div class="stat-label">Low Risk</div>
                            <div class="stat-value" style="color: var(--neon-emerald);">${risks.length - highRisks - mediumRisks}</div>
                        </div>
                    </div>
                    
                    <div class="section">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Category</th>
                                    <th>Description</th>
                                    <th>Risk Level</th>
                                    <th>Mitigation</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${risks.map((risk, idx) => `
                                    <tr>
                                        <td><span class="category-badge">${risk.category}</span></td>
                                        <td>${risk.description}</td>
                                        <td>
                                            <span class="risk-level risk-${risk.level.toLowerCase()}">${risk.level}</span>
                                        </td>
                                        <td>${risk.mitigation || '-'}</td>
                                        <td>
                                            <span class="status-badge ${risk.resolved ? 'status-complete' : 'status-pending'}">
                                                ${risk.resolved ? 'Resolved' : 'Active'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn btn-xs" onclick="RiskAssessment.toggleResolved(${idx})">${risk.resolved ? '↩' : '✓'}</button>
                                            <button class="btn btn-xs btn-danger" onclick="RiskAssessment.deleteRisk(${idx})">×</button>
                                        </td>
                                    </tr>
                                `).join('') || '<tr><td colspan="6" class="text-center text-muted">No risks identified</td></tr>'}
                            </tbody>
                        </table>
                    </div>
                `;
            },
            
            showAddRiskModal() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'modal-add-risk';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="document.getElementById('modal-add-risk').remove()">×</button>
                        <h2 class="modal-title">Add Risk Assessment</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Category</label>
                                <select id="risk-category">
                                    ${this.riskCategories.map(c => `<option value="${c}">${c}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Risk Level</label>
                                <select id="risk-level">
                                    <option value="Low">Low</option>
                                    <option value="Medium">Medium</option>
                                    <option value="High">High</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Description</label>
                                <textarea id="risk-desc" placeholder="Describe the risk"></textarea>
                            </div>
                            <div class="form-group full-width">
                                <label>Mitigation Plan</label>
                                <textarea id="risk-mitigation" placeholder="How will this risk be mitigated?"></textarea>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn" onclick="document.getElementById('modal-add-risk').remove()">Cancel</button>
                            <button class="btn btn-primary" onclick="RiskAssessment.addRisk()">Add Risk</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            
            addRisk() {
                const risks = this.getData();
                risks.push({
                    category: document.getElementById('risk-category').value,
                    level: document.getElementById('risk-level').value,
                    description: document.getElementById('risk-desc').value,
                    mitigation: document.getElementById('risk-mitigation').value,
                    resolved: false
                });
                Core.data.risks = risks;
                Core.save();
                document.getElementById('modal-add-risk').remove();
                this.render();
            },
            
            toggleResolved(idx) {
                const risks = this.getData();
                if (risks[idx]) {
                    risks[idx].resolved = !risks[idx].resolved;
                    Core.data.risks = risks;
                    Core.save();
                    this.render();
                }
            },
            
            deleteRisk(idx) {
                const risks = this.getData();
                risks.splice(idx, 1);
                Core.data.risks = risks;
                Core.save();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 5: CONTACT DIRECTORY WITH DEPARTMENTS
           ═══════════════════════════════════════════════════════════════════════ */
        const ContactDirectory = {
            departments: ['Production', 'Direction', 'Camera', 'Lighting', 'Sound', 'Art', 'Wardrobe', 'Hair/Makeup', 'Locations', 'Transportation', 'Catering', 'Post-Production'],
            
            init() {
                this.render();
            },
            
            getData() {
                return Core.data.contacts || [];
            },
            
            render() {
                const container = document.getElementById('view-contacts');
                if (!container) return;
                
                const contacts = this.getData();
                const byDept = {};
                this.departments.forEach(d => byDept[d] = []);
                contacts.forEach(c => {
                    if (byDept[c.department]) byDept[c.department].push(c);
                });
                
                container.innerHTML = `
                    <div class="view-header">
                        <h1 class="view-title">CONTACT DIRECTORY</h1>
                        <div class="view-actions">
                            <button class="btn btn-sm btn-primary" onclick="ContactDirectory.showAddContactModal()">+ Add Contact</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.contactDirectory()">📄 Export PDF</button>
                        </div>
                    </div>
                    
                    <div class="search-bar">
                        <input type="text" id="contact-search" placeholder="Search contacts..." oninput="ContactDirectory.filterContacts()">
                    </div>
                    
                    <div class="departments-grid" id="contacts-grid">
                        ${this.departments.filter(d => byDept[d].length > 0).map(dept => `
                            <div class="department-card">
                                <div class="dept-header">${dept}</div>
                                <div class="dept-contacts">
                                    ${byDept[dept].map((c, idx) => `
                                        <div class="contact-item" data-name="${c.name.toLowerCase()}">
                                            <div class="contact-name">${c.name}</div>
                                            <div class="contact-role">${c.role || ''}</div>
                                            <div class="contact-info">
                                                ${c.phone ? `<a href="tel:${c.phone}" class="contact-link">📞 ${c.phone}</a>` : ''}
                                                ${c.email ? `<a href="mailto:${c.email}" class="contact-link">✉️ ${c.email}</a>` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('') || '<div class="empty-state">No contacts added yet</div>'}
                    </div>
                `;
            },
            
            filterContacts() {
                const query = document.getElementById('contact-search').value.toLowerCase();
                document.querySelectorAll('.contact-item').forEach(item => {
                    const name = item.dataset.name;
                    item.style.display = name.includes(query) ? '' : 'none';
                });
            },
            
            showAddContactModal() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'modal-add-contact';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="document.getElementById('modal-add-contact').remove()">×</button>
                        <h2 class="modal-title">Add Contact</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Name</label>
                                <input type="text" id="contact-name" placeholder="Full name">
                            </div>
                            <div class="form-group">
                                <label>Role/Title</label>
                                <input type="text" id="contact-role" placeholder="Job title">
                            </div>
                            <div class="form-group">
                                <label>Department</label>
                                <select id="contact-dept">
                                    ${this.departments.map(d => `<option value="${d}">${d}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="contact-phone" placeholder="Phone number">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="contact-email" placeholder="Email address">
                            </div>
                            <div class="form-group">
                                <label>Emergency Contact</label>
                                <input type="text" id="contact-emergency" placeholder="Emergency phone">
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn" onclick="document.getElementById('modal-add-contact').remove()">Cancel</button>
                            <button class="btn btn-primary" onclick="ContactDirectory.addContact()">Add Contact</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            
            addContact() {
                const contacts = this.getData();
                contacts.push({
                    name: document.getElementById('contact-name').value,
                    role: document.getElementById('contact-role').value,
                    department: document.getElementById('contact-dept').value,
                    phone: document.getElementById('contact-phone').value,
                    email: document.getElementById('contact-email').value,
                    emergency: document.getElementById('contact-emergency').value
                });
                Core.data.contacts = contacts;
                Core.save();
                document.getElementById('modal-add-contact').remove();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 6: PRODUCTION TIMELINE/MILESTONES
           ═══════════════════════════════════════════════════════════════════════ */
        const Milestones = {
            phases: ['Development', 'Pre-Production', 'Production', 'Post-Production', 'Distribution'],
            
            init() {
                this.render();
            },
            
            getData() {
                return Core.data.milestones || [];
            },
            
            render() {
                const container = document.getElementById('view-milestones');
                if (!container) return;
                
                const milestones = this.getData();
                const completed = milestones.filter(m => m.completed).length;
                const progress = milestones.length > 0 ? Math.round((completed / milestones.length) * 100) : 0;
                
                container.innerHTML = `
                    <div class="view-header">
                        <h1 class="view-title">PRODUCTION MILESTONES</h1>
                        <div class="view-actions">
                            <button class="btn btn-sm btn-primary" onclick="Milestones.showAddMilestoneModal()">+ Add Milestone</button>
                            <button class="btn btn-sm btn-export" onclick="PDFExport.milestones()">📄 Export PDF</button>
                        </div>
                    </div>
                    
                    <div class="milestone-progress">
                        <div class="progress-header">
                            <span>Overall Progress</span>
                            <span>${progress}%</span>
                        </div>
                        <div class="progress-bar-large">
                            <div class="progress-fill" style="width: ${progress}%;"></div>
                        </div>
                        <div class="progress-stats">
                            <span>${completed} of ${milestones.length} milestones completed</span>
                        </div>
                    </div>
                    
                    <div class="timeline">
                        ${milestones.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate)).map((m, idx) => {
                            const isOverdue = !m.completed && new Date(m.dueDate) < new Date();
                            return `
                                <div class="timeline-item ${m.completed ? 'completed' : ''} ${isOverdue ? 'overdue' : ''}">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="timeline-header">
                                            <span class="timeline-phase">${m.phase}</span>
                                            <span class="timeline-date">${m.dueDate}</span>
                                        </div>
                                        <div class="timeline-title">${m.title}</div>
                                        <div class="timeline-desc">${m.description || ''}</div>
                                        <div class="timeline-actions">
                                            <button class="btn btn-xs" onclick="Milestones.toggleComplete(${idx})">
                                                ${m.completed ? '↩ Reopen' : '✓ Complete'}
                                            </button>
                                            <button class="btn btn-xs btn-danger" onclick="Milestones.deleteMilestone(${idx})">Delete</button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('') || '<div class="empty-state">No milestones set</div>'}
                    </div>
                `;
            },
            
            showAddMilestoneModal() {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.id = 'modal-add-milestone';
                modal.innerHTML = `
                    <div class="modal-content">
                        <button class="modal-close" onclick="document.getElementById('modal-add-milestone').remove()">×</button>
                        <h2 class="modal-title">Add Milestone</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" id="milestone-title" placeholder="Milestone title">
                            </div>
                            <div class="form-group">
                                <label>Phase</label>
                                <select id="milestone-phase">
                                    ${this.phases.map(p => `<option value="${p}">${p}</option>`).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Due Date</label>
                                <input type="date" id="milestone-date">
                            </div>
                            <div class="form-group full-width">
                                <label>Description</label>
                                <textarea id="milestone-desc" placeholder="Milestone description"></textarea>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button class="btn" onclick="document.getElementById('modal-add-milestone').remove()">Cancel</button>
                            <button class="btn btn-primary" onclick="Milestones.addMilestone()">Add Milestone</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },
            
            addMilestone() {
                const milestones = this.getData();
                milestones.push({
                    title: document.getElementById('milestone-title').value,
                    phase: document.getElementById('milestone-phase').value,
                    dueDate: document.getElementById('milestone-date').value,
                    description: document.getElementById('milestone-desc').value,
                    completed: false
                });
                Core.data.milestones = milestones;
                Core.save();
                document.getElementById('modal-add-milestone').remove();
                this.render();
            },
            
            toggleComplete(idx) {
                const milestones = this.getData();
                if (milestones[idx]) {
                    milestones[idx].completed = !milestones[idx].completed;
                    Core.data.milestones = milestones;
                    Core.save();
                    this.render();
                }
            },
            
            deleteMilestone(idx) {
                const milestones = this.getData();
                milestones.splice(idx, 1);
                Core.data.milestones = milestones;
                Core.save();
                this.render();
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           NEW FEATURE 7: ADVANCED DATA EXPORT/IMPORT
           ═══════════════════════════════════════════════════════════════════════ */
        const DataManager = {
            exportAllData() {
                const data = {
                    production: Core.currentProduction,
                    exportDate: new Date().toISOString(),
                    version: '6.0',
                    data: Core.data,
                    bizData: Core.bizData
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${Core.currentProduction}_backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                Core.log('Data exported successfully');
            },
            
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const imported = JSON.parse(event.target.result);
                            if (imported.data) {
                                Core.data = imported.data;
                                Core.save();
                                Core.renderAll();
                                Core.log('Data imported successfully');
                                alert('Data imported successfully!');
                            }
                        } catch (err) {
                            alert('Error importing data: ' + err.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            },
            
            exportToCSV(type) {
                let csv = '';
                let filename = '';
                
                switch(type) {
                    case 'schedule':
                        const strips = Core.data.schedule?.strips || [];
                        csv = 'Scene,INT/EXT,DAY/NIGHT,Location,Cast,Pages,Description\n';
                        strips.filter(s => s.type === 'scene').forEach(s => {
                            csv += `"${s.scene || ''}","${s.intext || ''}","${s.daynight || ''}","${s.location || ''}","${s.cast || ''}","${s.pages || ''}","${s.description || ''}"\n`;
                        });
                        filename = 'shooting_schedule.csv';
                        break;
                    case 'cast':
                        const cast = Object.values(Core.data.cast || {});
                        csv = 'ID,Name,Role,Phone,Email\n';
                        cast.forEach(c => {
                            csv += `"${c.id || ''}","${c.name || ''}","${c.role || ''}","${c.phone || ''}","${c.email || ''}"\n`;
                        });
                        filename = 'cast_list.csv';
                        break;
                    case 'crew':
                        const crew = Object.values(Core.data.crew || {});
                        csv = 'ID,Name,Position,Phone,Email\n';
                        crew.forEach(c => {
                            csv += `"${c.id || ''}","${c.name || ''}","${c.position || ''}","${c.phone || ''}","${c.email || ''}"\n`;
                        });
                        filename = 'crew_list.csv';
                        break;
                }
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            }
        };

        /* ═══════════════════════════════════════════════════════════════════════
           INITIALIZATION
           ═══════════════════════════════════════════════════════════════════════ */
        document.addEventListener('DOMContentLoaded', () => {
            Auth.init();
        });
    </script>
</body>
</html>
